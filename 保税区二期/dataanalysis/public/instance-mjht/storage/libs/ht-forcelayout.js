!function(j,T){"use strict";var Q="ht",B=Q+".layout.",F=j[Q]||module.parent.exports.ht,Y=F.List,n=F.DataModel,J=F.Node,b=F.Edge,k=F.Group,w=Math,L=w.sqrt,G=w.random,u=w.max,f=w.min,N=function(L){return L*L};F.Default.getInternal().addMSMap({ms_force:function(C){C._interval=50,C._stepCount=10,C._motionLimit=.01,C._edgeRepulsion=.65,C._nodeRepulsion=.65,C._damper=1,C._maxMotion=0,C._motionRatio=0,C.init=function(Z){var F=this;Z instanceof n?F.dm=Z:F.gv=Z,F._nodeMap={},F._nodes=new Y,F._edges=new Y},C.start=function(){var E=this,i=E.gv;if(!E._timer){var v=E.cdm=i?i.dm():E.dm;v.mm(E.handleDataModelChange,E),v.md(E.handleDataPropertyChange,E),i&&i.mp(E.handleGV,E),v.each(function(t){if(E.isVisible(t)&&E.isLayoutable(t)&&t instanceof J)if(E instanceof h){var p=t.p3();t.p3([p[0]+G(),p[1]+G(),p[2]+G()])}else p=t.p(),t.p(p.x+G(),p.y+G())}),E._timer=setInterval(function(){E.relax()},E._interval),E._damper=1}},C.stop=function(){var w=this;w._timer&&(w.cdm.umm(w.handleDataModelChange,w),w.cdm.umd(w.handleDataPropertyChange,w),w.gv&&w.gv.ump(w.handleGV,w),clearInterval(w._timer),delete w._timer,delete w.cdm)},C.handleGV=function(F){var s=this;if("dataModel"===F.property){var E=F.oldValue,Q=F.newValue;E&&(E.umm(s.handleDataModelChange,s),E.umd(s.handleDataPropertyChange,s)),this.cdm=Q,Q.mm(s.handleDataModelChange,s),Q.md(s.handleDataPropertyChange,s)}},C.relax=function(){var y=this;if(!(y._damper<.1&&y._maxMotion<y._motionLimit)){this.cdm.each(function(M){y.isVisible(M)&&(M instanceof b?y.addEdge(M):M instanceof J&&y.addNode(M))});for(var L,i,r=0,p=y._edges,I=y._nodes,Z=I.size();r<y._stepCount;r++){for(p.each(y.relaxEdge,y),L=0;Z>L;L++)for(i=0;Z>i;i++)y.relaxNode(I.get(L),I.get(i));y.moveNode()}y._isAdjusting=1,I.each(function(a){a.fix||(a.p?a.v.p3(a.p):a.v.p(a.x,a.y))}),delete y._isAdjusting,y._nodeMap={},I.clear(),p.clear(),y.onRelaxed()}},C.onRelaxed=function(){},C.isRunning=function(){return!!this._timer},C.isVisible=function(X){return X.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(X):!0},C.isLayoutable=function(J){if(J.s("layoutable")===!1)return!1;if(J instanceof k)return!1;var w=this;return w.gv?w.gv.isMovable(J)&&!w.gv.isSelected(J):!(w.cdm||w.dm).sm().co(J)},C.getNodeRepulsion=function(){return this._nodeRepulsion},C.setNodeRepulsion=function(W){this._nodeRepulsion=W,this._damper=1},C.getEdgeRepulsion=function(){return this._edgeRepulsion},C.setEdgeRepulsion=function($){this._edgeRepulsion=$,this._damper=1},C.getStepCount=function(){return this._stepCount},C.setStepCount=function(H){this._stepCount=H,this._damper=1},C.getInterval=function(){return this._interval},C.setInterval=function(X){var T=this;T._interval!==X&&(T._interval=X,T._timer&&(clearInterval(T._timer),T._timer=setInterval(function(){T.relax()},X)))},C.handleDataPropertyChange=function(J){!this._isAdjusting&&this.isVisible(J.data)&&(this._damper=1)},C.handleDataModelChange=function(){this._damper=1},C.damp=function(){var A=this._maxMotion,$=this._damper;this._motionRatio<=.001&&((.2>A||A>1&&.9>$)&&$>.01?this._damper-=.01:.4>A&&$>.003?this._damper-=.003:$>1e-4&&(this._damper-=1e-4)),A<this._motionLimit&&(this._damper=0)}}}),F.layout.ForceLayout=function(U){this.init(U)},F.Default.def(B+"ForceLayout",T,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(E){this._limitBounds=E,this._damper=1},getNodeSize:function(T){var r=this.gv;return r&&r.getDataUIBounds?r.getDataUIBounds(T):T.getRect()},addNode:function(n){var j=this,Z=j._nodeMap[n._id];if(Z)return Z;var B=n.p();Z={v:n,x:B.x,y:B.y,dx:0,dy:0,fix:!j.isLayoutable(n),s:j.getNodeSize(n)};var F=Z.s,a=L(N(F.width)+N(F.height))*j._nodeRepulsion;return Z.r=1>a?100:a,j._nodeMap[n._id]=Z,j._nodes.add(Z),Z},addEdge:function(o){if(o._40I&&o._41I){var R=this,E=R.addNode(o._40I),Q=R.addNode(o._41I),k={s:E,t:Q};Q=Q.s,E=E.s;var Y=Q.width+E.width,r=Q.height+E.height;k.length=L(Y*Y+r*r)*R._edgeRepulsion,k.length<=0&&(k.length=100),R._edges.add(k)}},relaxEdge:function(p){var h=p.t,R=p.s,z=h.x-R.x,j=h.y-R.y,U=L(z*z+j*j),J=100*p.length,m=.25*z/J*U,u=.25*j/J*U;h.dx=h.dx-m,h.dy=h.dy-u,R.dx=R.dx+m,R.dy=R.dy+u},relaxNode:function(h,w){if(h!==w){var t=0,u=0,_=h.x-w.x,N=h.y-w.y,S=_*_+N*N;0===S?(t=G(),u=G()):36e4>S&&(t=_/S,u=N/S);var D=h.r*w.r/400;t*=D,u*=D,h.dx+=t,h.dy+=u,w.dx-=t,w.dy-=u}},moveNode:function(){var S=this,m=S._limitBounds,v=S._maxMotion,M=0,d=S._damper;S._nodes.each(function(N){if(!N.fix){var r=N.dx*d,I=N.dy*d;if(N.dx=r/2,N.dy=I/2,M=u(L(r*r+I*I),M),N.x+=u(-40,f(40,r)),N.y+=u(-40,f(40,I)),m){N.x<m.x&&(N.x=m.x,S.adjust(1,0)),N.y<m.y&&(N.y=m.y,S.adjust(0,1));var X=N.s;N.x+X.width>m.x+m.width&&(N.x=m.x+m.width-X.width,S.adjust(-1,0)),N.y+X.height>m.y+m.height&&(N.y=m.y+m.height-X.height,S.adjust(0,-1))}}}),S._maxMotion=M,S._motionRatio=M>0?v/M-1:0,S.damp()},adjust:function(h,P){var z=this._limitBounds;this._nodes.each(function(o){h>0?(!z||o.x+o.s.width+h<z.x+z.width)&&(o.x+=h):(!z||o.x+h>z.x)&&(o.x+=h),P>0?(!z||o.y+o.s.height+P<z.y+z.height)&&(o.y+=P):(!z||o.y+P>z.y)&&(o.y+=P)})}});var h=F.layout.Force3dLayout=function(W){this.init(W)};F.Default.def(B+"Force3dLayout",T,{ms_force:1,getNodeSize3d:function(d){return d.s3()},addNode:function(z){var v=this,c=v._nodeMap[z._id];if(c)return c;c={v:z,p:z.p3(),d:[0,0,0],fix:!v.isLayoutable(z),s:v.getNodeSize3d(z)};var R=c.s,$=F.Default.getDistance(R)*v._nodeRepulsion;return c.r=1>$?100:$,v._nodeMap[z._id]=c,v._nodes.add(c),c},addEdge:function(I){if(I._40I&&I._41I){var s=this,O=s.addNode(I._40I),x=s.addNode(I._41I),B={s:O,t:x};x=x.s,O=O.s,B.length=L(N(x[0]+O[0])+N(x[1]+O[1])+N(x[2]+O[2]))*s._edgeRepulsion,B.length<=0&&(B.length=100),s._edges.add(B)}},relaxEdge:function(K){var k=K.t.p,U=K.s.p,W=K.t.d,M=K.s.d,X=k[0]-U[0],V=k[1]-U[1],f=k[2]-U[2],j=L(X*X+V*V+f*f),d=100*K.length,G=.25*X/d*j,v=.25*V/d*j,q=.25*f/d*j;W[0]-=G,W[1]-=v,W[2]-=q,M[0]+=G,M[1]+=v,M[2]+=q},relaxNode:function(W,z){if(W!==z){var v=W.p,J=z.p,o=0,X=0,C=0,e=v[0]-J[0],B=v[1]-J[1],g=v[2]-J[2],t=e*e+B*B+g*g;0===t?(o=G(),X=G(),C=G()):216e6>t&&(o=e/t,X=B/t,C=g/t);var V=W.r*z.r/400,A=W.d,R=z.d;o*=V,X*=V,C*=V,A[0]+=o,A[1]+=X,A[2]+=C,R[0]-=o,R[1]-=X,R[2]-=C}},moveNode:function(){var y=this,i=y._maxMotion,l=0,X=y._damper;y._nodes.each(function(q){if(!q.fix){var F=q.p,p=q.d,U=p[0]*X,N=p[1]*X,R=p[2]*X;p[0]=U/2,p[1]=N/2,p[2]=R/2,l=u(L(U*U+N*N+R*R),l),F[0]+=u(-40,f(40,U)),F[1]+=u(-40,f(40,N)),F[2]+=u(-40,f(40,R))}}),y._maxMotion=l,y._motionRatio=l>0?i/l-1:0,y.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);