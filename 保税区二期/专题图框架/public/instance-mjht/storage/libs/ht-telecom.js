!function(g,i){"use strict";var U=ht.AlarmSeverity=function(L,O,c,s,A){this.value=L,this.name=O,this.nickName=c,this.color=s,this.displayName=A};ht.Default.def("ht.AlarmSeverity",i,{toString:function(){return this.displayName||this.name}}),function(){U.severities=new ht.List,U._vm={},U._nm={},U._cp=function(v,F){if(v&&F){var y=v.value-F.value;return y>0?1:0>y?-1:0}return v&&!F?1:!v&&F?-1:0},U.each=function(l,O){U.severities.each(l,O)},U.getSortFunction=function(){return U._cp},U.setSortFunction=function(u){U._cp=u,U.severities.sort(u)},U.add=function(B,M,u,h,K){var O=new U(B,M,u,h,K);return U._vm[B]=O,U._nm[M]=O,U.severities.add(O),U.severities.sort(U._cp),O},U.remove=function(K){var k=U._nm[K];return k&&(delete U._nm[K],delete U._vm[k.value],U.severities.remove(k)),k},U.CRITICAL=U.add(500,"Critical","C","#FF0000"),U.MAJOR=U.add(400,"Major","M","#FFA000"),U.MINOR=U.add(300,"Minor","m","#FFFF00"),U.WARNING=U.add(200,"Warning","W","#00FFFF"),U.INDETERMINATE=U.add(100,"Indeterminate","N","#C800FF"),U.CLEARED=U.add(0,"Cleared","R","#00FF00"),U.isClearedAlarmSeverity=function(g){return g?0===g.value:!1},U.getByName=function(p){return U._nm[p]},U.getByValue=function(b){return U._vm[b]},U.clear=function(){U.severities.clear(),U._vm={},U._nm={}},U.compare=function(B,b){return U._cp(B,b)}}();var Q=ht.AlarmState=function(g){this._d=g,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",i,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var B=null;for(var k in this._am)k=U.getByName(k),U.isClearedAlarmSeverity(k)||0!==this.getAcknowledgedAlarmCount(k)&&(B=B?U.compare(B,k)>0?B:k:k);this._haa=B},_c2:function(){var s=null;for(var P in this._nm)P=U.getByName(P),U.isClearedAlarmSeverity(P)||0!==this.getNewAlarmCount(P)&&(s=s?U.compare(s,P)>0?s:P:P);this._hna=s},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var s in this._nm)if(s=U.getByName(s),!U.isClearedAlarmSeverity(s)&&0!==this.getNewAlarmCount(s)&&U.compare(this._hna,s)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var N=this._haa,c=this._hna,f=this._ps;this._hoa=N,U.compare(c,this._hoa)>0&&(this._hoa=c),U.compare(f,this._hoa)>0&&(this._hoa=f)},_c5:function(){var u=this._haa,a=this._hna;this._hta=u,U.compare(a,this._hta)>0&&(this._hta=a)},increaseAcknowledgedAlarm:function(V,j){if(0!==j){j=j||1;var h=this._am[V.name]||0;h+=j,this._am[V.name]=h,this._f()}},increaseNewAlarm:function(P,h){if(0!==h){h=h||1;var p=this._nm[P.name]||0;p+=h,this._nm[P.name]=p,this._f()}},decreaseAcknowledgedAlarm:function(d,B){if(0!==B){B||(B=1);var l=this._am[d.name]||0;if(l-=B,0>l)throw"Alarm count can not be negative";this._am[d.name]=l,this._f()}},decreaseNewAlarm:function(H,k){if(0!==k){k||(k=1);var R=this._nm[H.name]||0;if(R-=k,0>R)throw"Alarm count can not be negative";this._nm[H.name]=R,this._f()}},acknowledgeAlarm:function(f){this.decreaseNewAlarm(f,1),this.increaseAcknowledgedAlarm(f,1)},acknowledgeAllAlarms:function(b){if(b){var K=this.getNewAlarmCount(b);this.decreaseNewAlarm(b,K),this.increaseAcknowledgedAlarm(b,K)}else for(var N in this._nm)this.acknowledgeAllAlarms(U.getByName(N))},_c6:function(){this._aac=0;for(var S in this._am)S=U.getByName(S),this._aac+=this.getAcknowledgedAlarmCount(S)},getAcknowledgedAlarmCount:function(v){return v?this._am[v.name]||0:this._aac},getAlarmCount:function(C){return this.getAcknowledgedAlarmCount(C)+this.getNewAlarmCount(C)},_c7:function(){this._nac=0;for(var W in this._nm)this._nac+=this.getNewAlarmCount(U.getByName(W))},getNewAlarmCount:function(Y){return Y?this._nm[Y.name]||0:this._nac},setNewAlarmCount:function(r,v){this._nm[r.name]=v,this._f()},removeAllNewAlarms:function(a){a?delete this._nm[a]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(F,a){this._am[F.name]=a,this._f()},removeAllAcknowledgedAlarms:function(c){c?delete this._am[c.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(O){if(this._ep||(O=null),this._ps!==O){var D=this._ps;this._ps=O,this._f(),this._d.fp("propagateSeverity",D,O)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(d){var a=this._ep;this._ep=d,this._d.fp("enablePropagation",a,d)&&(d||this.setPropagateSeverity(null))}});var B=ht.AlarmStatePropagator=function(T){this._dataModel=T,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",i,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(I){this._enable!==I&&(this._enable=I,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(H){this.propagate(H)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(f){f.data&&this.propagate(f.data)},handleDataPropertyChange:function(r){if("alarmState"===r.property||"enablePropagation"===r.property)this.propagate(r.data);else if("parent"===r.property){var W=r.oldValue;W&&this.propagate(W),this.propagate(r.data)}},propagate:function(p){p&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(p),this._isPropagating=!1)},propagateToTop:function(S){for(this.propagateToParent(null,S);S&&S.getParent();)this.propagateToParent(S,S.getParent()),S=S.getParent()},propagateToParent:function(E,h){var Y=null;h.getChildren().each(function(z){var s=z.getAlarmState().getHighestOverallAlarmSeverity();U.compare(s,Y)>0&&(Y=s)}),h.getAlarmState().setPropagateSeverity(Y)}}),ht.AlarmStateStatistics=function(j){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(j)},ht.Default.def("ht.AlarmStateStatistics",i,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(z){var n=this._dataModel;n!==z&&(n&&(n.umd(this.handleDataPropertyChange,this),n.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=z,this.reset(),z.md(this.handleDataPropertyChange,this),z.mm(this.handleDataModelChange,this),this.fp("dataModel",n,z))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(J){"alarmState"===J.property&&(this.increase(J.data),this.fireAlarmStateChange())},handleDataModelChange:function(v){"add"===v.kind?(this.increase(v.data),this.fireAlarmStateChange()):"remove"===v.kind?(this.decrease(v.data),this.fireAlarmStateChange()):"clear"===v.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,U.each(function(y){var U=this.getSumInfo(y);this.sumAcked+=U.ackedCount,this.sumNew+=U.newCount,this.sumTotal+=U.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(P){if(!P)return this.sumNew;var v=this.getSumInfo(P);return v.newCount},getAcknowledgedAlarmCount:function(B){if(!B)return this.sumAcked;var c=this.getSumInfo(B);return c.ackedCount},getTotalAlarmCount:function(J){if(!J)return this.sumTotal;var s=this.getSumInfo(J);return s.totalCount},getSumInfo:function(W){var F=this.severtiyMap[W.name];return F||(F={},F.newCount=0,F.ackedCount=0,F.totalCount=0,this.severtiyMap[W.name]=F),F},decrease:function(i){var q=this.dataMap[i.getId()];q&&(delete this.dataMap[i.getId()],U.each(function(K){var s=q[K.name],f=this.getSumInfo(K);f.newCount=f.newCount-s.newCount,f.ackedCount=f.ackedCount-s.ackedCount,f.totalCount=f.totalCount-s.totalCount},this))},increase:function(r){if(this.decrease(r),!this._filterFunc||this._filterFunc(r)){var R={},u=r.getAlarmState();this.dataMap[r.getId()]=R,U.each(function(K){var l={};l.newCount=u.getNewAlarmCount(K),l.ackedCount=u.getAcknowledgedAlarmCount(K),l.totalCount=u.getAlarmCount(K),R[K.name]=l;var S=this.getSumInfo(K);S.newCount=S.newCount+l.newCount,S.ackedCount=S.ackedCount+l.ackedCount,S.totalCount=S.totalCount+l.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(h){var Y=this._filterFunc;this._filterFunc=h,this.reset(),this.fp("filterFunc",Y,h)},getFilterFunc:function(){return this._filterFunc}});var j=ht.Data.prototype;j.getAlarmState=function(){return this._alarmState||(this._alarmState=new Q(this))},j=ht.DataModel.prototype,j.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},j.setEnableAlarmStatePropagator=function(D){D!=this.isEnableAlarmStatePropagator()&&(D?(this._alarmStatePropagator=new B(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},j=ht.graph.GraphView.prototype,j.getNote2=function(F){var l=F.getAlarmState().getHighestNewAlarmSeverity();if(l){var z=F.getAlarmState().getNewAlarmCount(l)+l.nickName;return F.getAlarmState().hasLessSevereNewAlarms()&&(z+="+"),z}return F.s("note2")},j.getNote2Background=function(U){var K=U.getAlarmState().getHighestNewAlarmSeverity();return K?K.color:U.s("note2.background")},j.getBodyColor=function(E){var h=E.getAlarmState().getHighestNativeAlarmSeverity();return h?h.color:E.s("body.color")},j.getBorderColor=function(d){var o=d.getAlarmState().getPropagateSeverity();return o?o.color:d.s("border.color")},j=ht.widget.TreeView.prototype,j.getBorderColor=function(h){var n=h.getAlarmState().getPropagateSeverity();return n?n.color:h.s("border.color")},j.getIcon=function(b){return b.getIcon()?"__alarmIcon__":null},j=ht.widget.TreeTableView.prototype,j.getBorderColor=function(p){var n=p.getAlarmState().getPropagateSeverity();return n?n.color:p.s("border.color")},j.getIcon=function(g){return g.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(z){return z.getIcon()}},color:{func:function(w){var P=w.getAlarmState().getHighestNativeAlarmSeverity();return P?P.color:w.s("body.color")}},rect:[0,0,16,16]}]});var v=ht.Style;v["note2.expanded"]=!0,v["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);