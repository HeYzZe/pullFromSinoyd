!function(l,J,Y){"use strict";var C=l.ht;C.Astar={},function(k){var L=k();l.AStar=L.astar,l.AStar.Graph=L.Graph}(function(){function w(f){for(var u=f,o=[];u.parent;)o.unshift(u),u=u.parent;return o}function h(){return new m(function(C){return C.f})}function x(G,z){z=z||{},this.nodes=[],this.diagonal=!!z.diagonal,this.grid=[];for(var X=0;X<G.length;X++){this.grid[X]=[];for(var c=0,B=G[X];c<B.length;c++){var p=new n(X,c,B[c]);this.grid[X][c]=p,this.nodes.push(p)}}this.$13x()}function n(O,o,w){this.x=O,this.y=o,this.weight=w}function m(u){this.content=[],this.scoreFunction=u}var S={search:function(p,C,I,o){p.$6x(),o=o||{};var f=o.heuristic;f||(f=p.diagonal?S.$4x.diagonal:S.$4x.manhattan);var l=o.closest||!1,W=o.punish,G=h(),K=C;for(C.h=f(C,I),p.$7x(C),G.push(C);G.size()>0;){var U=G.pop();if(U===I)return w(U);U.closed=!0;for(var d=p.neighbors(U),z=0,s=d.length;s>z;++z){var k=d[z];if(!k.closed&&!k.$9x()){var M=U.g+k.getCost(U,W),j=k.visited;(!j||M<k.g)&&(k.visited=!0,k.parent=U,k.h=k.h||f(k,I),k.g=M,k.f=k.g+k.h,p.$7x(k),l&&(k.h<K.h||k.h===K.h&&k.g<K.g)&&(K=k),j?G.$10x(k):G.push(k))}}}return l?w(K):[]},$4x:{manhattan:function(k,W){var O=Math.abs(W.x-k.x),Q=Math.abs(W.y-k.y);return O+Q},diagonal:function(y,A){var Y=1,m=Math.sqrt(2),B=Math.abs(A.x-y.x),W=Math.abs(A.y-y.y);return Y*(B+W)+(m-2*Y)*Math.min(B,W)}},$5x:function(Z){Z.f=0,Z.g=0,Z.h=0,Z.visited=!1,Z.closed=!1,Z.parent=null}};return x.prototype.$13x=function(){this.dirtyNodes=[];for(var E=0;E<this.nodes.length;E++)S.$5x(this.nodes[E])},x.prototype.$6x=function(){for(var g=0;g<this.dirtyNodes.length;g++)S.$5x(this.dirtyNodes[g]);this.dirtyNodes=[]},x.prototype.$7x=function(r){this.dirtyNodes.push(r)},x.prototype.neighbors=function(H){var U=[],T=H.x,h=H.y,X=this.grid;return X[T-1]&&X[T-1][h]&&U.push(X[T-1][h]),X[T+1]&&X[T+1][h]&&U.push(X[T+1][h]),X[T]&&X[T][h-1]&&U.push(X[T][h-1]),X[T]&&X[T][h+1]&&U.push(X[T][h+1]),this.diagonal&&(X[T-1]&&X[T-1][h-1]&&U.push(X[T-1][h-1]),X[T+1]&&X[T+1][h-1]&&U.push(X[T+1][h-1]),X[T-1]&&X[T-1][h+1]&&U.push(X[T-1][h+1]),X[T+1]&&X[T+1][h+1]&&U.push(X[T+1][h+1])),U},x.prototype.toString=function(){for(var z=[],V=this.grid,Z=0;Z<V.length;Z++){for(var h=[],x=V[Z],b=0;b<x.length;b++)h.push(x[b].weight);z.push(h.join(" "))}return z.join("\n")},n.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},n.prototype.getCost=function(L,J){var G;if(G=L&&L.x!=this.x&&L.y!=this.y?1.41421*this.weight:this.weight,J){var D=L;if(!D)return G;var v=D.parent;return v?Math.abs(v.x+this.x-2*D.x)>1e-5?G+J:Math.abs(v.y+this.y-2*D.y)>1e-5?G+J:G:G}},n.prototype.$9x=function(){return 0===this.weight},m.prototype={push:function(h){this.content.push(h),this.$11x(this.content.length-1)},pop:function(){var q=this.content[0],m=this.content.pop();return this.content.length>0&&(this.content[0]=m,this.$12x(0)),q},remove:function(I){var O=this.content.indexOf(I),S=this.content.pop();O!==this.content.length-1&&(this.content[O]=S,this.scoreFunction(S)<this.scoreFunction(I)?this.$11x(O):this.$12x(O))},size:function(){return this.content.length},$10x:function(Y){this.$11x(this.content.indexOf(Y))},$11x:function(l){for(var f=this.content[l];l>0;){var Z=(l+1>>1)-1,L=this.content[Z];if(!(this.scoreFunction(f)<this.scoreFunction(L)))break;this.content[Z]=f,this.content[l]=L,l=Z}},$12x:function(P){for(var E=this.content.length,n=this.content[P],K=this.scoreFunction(n);;){var O,W=P+1<<1,J=W-1,S=null;if(E>J){var z=this.content[J];O=this.scoreFunction(z),K>O&&(S=J)}if(E>W){var N=this.content[W],F=this.scoreFunction(N);(null===S?K:O)>F&&(S=W)}if(null===S)break;this.content[P]=this.content[S],this.content[S]=n,P=S}}},{astar:S,Graph:x}});var N=C.Astar.Finder=function(v,D){var x=this;x.gv=v,x.$13x(D),x.refreshMap()};N.prototype={},N.prototype.constructor=N,J.defineProperties(N.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(p){this.gv._astarDebugInfo=p}}}),N.prototype.$13x=function(K){var Q=this,D=Q.$14x={};K=K||{};var P=K.gridSize||10;D.gridSizeX=K.gridSizeX||P,D.gridSizeY=K.gridSizeY||P,D.rect=K.rect,D.filter=K.filter,D.extendBlocks=K.extendBlocks||3,D.fastOverlap=K.fastOverlap===Y?!0:K.fastOverlap,D.nodeRectExtend=K.nodeRectExtend||0,D.diagonal=K.diagonal===Y?!0:K.diagonal,D.turnPunish=K.turnPunish===Y?.1:K.turnPunish,D.simplify=K.simplify===Y?!0:K.simplify,D.toGridCenter=K.toGridCenter===Y?!1:K.toGridCenter,D.closest=K.closest===Y?!0:K.closest},N.prototype.refreshMap=function(){var G,B=this,b=B.$14x,n=b.gridSizeX,w=b.gridSizeY,r=b.extendBlocks;b.rect?G=b.rect:(G=B.$15x(),C.Default.grow(G,n*r,w*r)),C.Default.grow(G,n,w);var e=Math.floor(G.x/n)*n,p=Math.floor(G.y/w)*w,T=Math.ceil(G.width/n),W=Math.ceil(G.height/w),H=T*n,g=W*w;B.$16x={x:e,y:p,w:H,h:g,gridX:n,gridY:w,xLen:T,yLen:W},B.$17x(),B.$21x()},N.prototype.$15x=function(){var Z=this.gv;if(Z instanceof C.graph.GraphView)return Z.getContentRect();var W,c=C.Default.unionRect;return Z.dm().each(function(v){Z.isVisible(v)&&v.getRect&&(W=c(W,v.getRect()))}),W},N.prototype.$17x=function(){var K,L,l,O,H=this,s=H.$16x,I=s.xLen,i=s.yLen;for(K=new Array(I),l=0;I>l;l++)for(K[l]=L=new Array(i),O=i;O--;)L[O]=1;var Q=H.$14x.filter;for(H.gv.dm().each(function(Z){Q&&Q(Z)===!1||(!H._debugInfo||Z!==H._debugInfo.grid&&Z!=H._debugInfo.path)&&H.$1cw(K,Z)}),l=0;I>l;l++)K[l][0]=1,K[l][i-1]=1;for(O=0;i>O;O++)K[0][O]=1,K[I-1][O]=1;H.grid=K;var a=new AStar.Graph(K,{diagonal:H.$14x.diagonal});H.graph=a},N.prototype.$18x=function(H,L,I,Q,B,D,M,T){var q=this.$19x,t=q(I-H,B-M,Q-L,D-T);if(1e-6>=t&&t>=-1e-6)return!1;var d=q(B-H,B-M,D-L,D-T)/t;if(0>d||d>1)return!1;var O=q(I-H,B-H,Q-L,D-L)/t;return 0>O||O>1?!1:!0},N.prototype.$19x=function(m,a,U,M){return m*M-a*U},N.prototype.$1aw=function(U,J,Q,n){for(var m=[-(J[1]-U[1]),J[0]-U[0]],r=m[0]*(Q[0]-U[0])+m[1]*(Q[1]-U[1])>=0,Y=0,V=n.length;V>Y;Y+=2)if(m[0]*(n[Y]-U[0])+m[1]*(n[Y+1]-U[1])>=0===r)return!1;return!0},N.prototype.$1bw=function(W,j){for(var o,q,v=this,f=0,B=W.length;B>f;f+=2)if(o=f===B-2?0:f+2,q=o===B-2?0:o+2,v.$1aw([W[f],W[f+1]],[W[o],W[o+1]],[W[q],W[q+1]],j))return!1;for(var f=0,B=j.length;B>f;f+=2)if(o=f===B-2?0:f+2,q=o===B-2?0:o+2,v.$1aw([j[f],j[f+1]],[j[o],j[o+1]],[j[q],j[q+1]],W))return!1;return!0},N.prototype.$1cw=function(Z,D){if(D.getRect){var q=this,E=D.getRect();C.Default.grow(E,q.$14x.nodeRectExtend);var B,A,U,O,G,J,w,d,n,F,f,P=q.$1dw({x:E.x,y:E.y}),m=q.$1dw({x:E.x+E.width,y:E.y+E.height}),u=q.$14x.fastOverlap;if(!u){var k=D.getCorners();w=[],k.forEach(function(i){w.push(i.x,i.y)}),F=q.$14x.gridSizeX/2,f=q.$14x.gridSizeY/2}for(A=Math.max(0,P.x),U=Math.min(m.x,Z.length-1),G=Math.max(0,P.y),J=Math.min(m.y,Z.length?Z[0].length-1:-1),B=A;U>=B;B++)for(O=G;J>=O;O++)if(u)Z[B][O]=0;else{n=q.$1ew({x:B,y:O});var V=n.x-F,W=n.x+F,h=n.y-f,K=n.y+f;d=[V,h,V,K,W,K,W,h],q.$1bw(w,d)&&(Z[B][O]=0)}}},N.prototype.$1dw=function(s,Z){var f=this,n=f.$16x,x=(s.x-n.x)/n.gridX,i=(s.y-n.y)/n.gridY;return Z!==!1&&(x=Math.round(x),i=Math.round(i)),{x:x,y:i}},N.prototype.$1ew=function(M){var A=this,Z=A.$16x;return{x:M.x*Z.gridX+Z.x,y:M.y*Z.gridY+Z.y}},N.prototype.$1fw=function(C){var w=this,X=w.$16x,I=X.xLen,e=X.yLen;if(C.x>=0&&C.x<I&&C.y>=0&&C.y<e)return C;var A={x:C.x,y:C.y};return A.x<0?A.x=0:A.x>=I&&(A.x=I-1),A.y<0?A.y=0:A.y>=e&&(A.y=e-1),A},N.prototype.findPath=function(o,U){var y,K,D,Q,W=this,l=W.$1dw(o),M=W.$1dw(U);if(D=W.$1fw(l),Q=W.$1fw(M),D!==l&&Q!==M){var X=W.$16x,c=X.x-X.gridX/2,A=X.y-X.gridY/2,N=c+X.gridX*X.xLen,a=A+X.gridY*X.yLen;if(!(W.$18x(o.x,o.y,U.x,U.y,c,A,N,A)||W.$18x(o.x,o.y,U.x,U.y,N,A,N,a)||W.$18x(o.x,o.y,U.x,U.y,N,a,c,a)||W.$18x(o.x,o.y,U.x,U.y,c,a,c,A)))return[o,U]}D!==l&&(y=!0,l=D),Q!==M&&(K=!0,M=Q);var E=W.graph.grid[l.x][l.y],V=W.graph.grid[M.x][M.y],F=AStar.search(W.graph,E,V,{closest:W.$14x.closest,punish:W.$14x.turnPunish});if(!F||!F.length)return null;var k=[];k.push(o),y&&k.push(W.$1ew(F[0]));for(var m=1,w=F.length;w-1>m;m++)k.push(W.$1ew(F[m]));if(K)k.push(W.$1ew(F[w-1])),k.push(U);else{var S=F[w-1];M.x!==S.x||M.y!==S.y||W.$14x.toGridCenter?k.push(W.$1ew(S)):k.push(U)}return W.$14x.simplify&&(k=W.simplifyPath(k)),W.$20x=k,W.$21x(),k},N.prototype.debugOn=function(o){this.debugFlag=!0,this.debugSettings=o||{},this.$21x()},N.prototype.simplifyPath=function(U){var t=U.length;if(2>=t)return U;var i,W,B=[U[0],U[1]],S=B[0],q=B[1],J=1e-5;for(i=2;t>i;i++)W=U[i],Math.abs((q.x-S.x)*(W.y-S.y)-(q.y-S.y)*(W.x-S.x))<J?q=B[B.length-1]=W:(S=q,q=W,B.push(W));return B},N.prototype.$21x=function(){var S=this;if(S.$22x(),this.debugFlag){var _=S.grid;if(_){var M,k=S.gv;if(S.debugSettings.$16x!==!1){M=[];for(var w,o,e,V,v,P=[],T=S.$14x.gridSizeX/2,s=S.$14x.gridSizeY/2,G=_.length,a=G?_[0].length:0,D=1;G-1>D;D++)for(var O=1;a-1>O;O++)_[D][O]||(w=S.$1ew({x:D,y:O}),o=w.x-T,e=w.x+T,V=w.y-s,v=w.y+s,M.push({x:o,y:V},{x:o,y:v},{x:e,y:v},{x:e,y:V}),P.push(1,2,2,2,5));var B=new C.Shape;B.s("shape.border.color","rgba(50, 50, 50, 0.2)"),B.s("shape.border.width",1),B.s("shape.background","rgba(200, 50, 100, 0.2)"),B.s("2d.editable",!1),B.s("2d.selectable",!1),B.setPoints(M),B.setSegments(P),S._debugInfo={grid:B},k.dm().add(B)}S.debugSettings.path!==!1&&(M=new C.Shape,S.$20x&&(M.setPoints(S.$20x),M.s("shape.border.color","red"),M.s("shape.border.width",1),M.s("2d.editable",!1),M.s("2d.selectable",!1),M.s("shape.background",null),S._debugInfo||(S._debugInfo={}),S._debugInfo.path=M,k.dm().add(M)))}}},N.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},N.prototype.$22x=function(){var S=this;if(S._debugInfo){var b=S._debugInfo.grid,x=S._debugInfo.path,g=S.gv;b&&g.dm().remove(b),x&&g.dm().remove(x),S._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);