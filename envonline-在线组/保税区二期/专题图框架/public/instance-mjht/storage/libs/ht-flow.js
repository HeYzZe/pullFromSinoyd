!function(m){"use strict";var A="ht",j=m[A],S=j.Default,b=Math,W=b.PI,q=2*W,F=b.sin,o=b.cos,B=b.atan2,v=b.sqrt,z=b.max,O=b.floor,Z=(b.round,b.ceil),$=b.abs,Q=j.Shape,I=j.Edge,u=j.List,J=j.Style,L=j.graph,r=S.getInternal(),Y=r.ui(),c=null,G="__segmentLengths",N="__lineTotalLength",p="__linePoints",w="__distance0",x="flow.count",t="flow.step",h="flow.element.max",E="flow.element.count",f="flow.element.min",T="flow.element.space",V="flow.element.autorotate",d="flow.element.background",y="flow.element.shadow.max",H="flow.element.shadow.min",X="flow.element.shadow.begincolor",l="flow.element.shadow.endcolor",s="flow.element.shadow.visible",k="flow.element.image",D="flow",U="prototype",R=L.GraphView[U],n=j.Data[U],C=Y.DataUI[U],e=Y.ShapeUI[U],_=Y.EdgeUI[U],i=j.DataModel[U],P=e._80o,a=_._80o,K=i.prepareRemove,M=_._79o,g=e._79o,Sf=R.setDataModel,oi=function(j){return document.createElement(j)};R.calculatePointLength=function(l,W,M){var h=this,x=h.getDataUI(l);M==c&&(M=.1);var Y=Ue(x),g=[];if(Y){for(var A=Y.length,i=0;A>i;i++){var k=Y[i];k._as&&(k=k._as);for(var m=k[0],r=1;r<k.length;r++)g.push([m,k[r]]),m=k[r]}for(var Z=[],i=0;i<g.length;i++){var z=ao(g[i][0],g[i][1],W);Z.push(z)}var V=Z.slice(0);V.sort(function(D,j){return D.z>j.z?1:D.z<j.z?-1:0});var w=V[0];if(w.z<M){for(var G=Z.indexOf(w),v=0,i=0;G>=i;i++)v+=G>i?S.getDistance(g[i][0],g[i][1]):S.getDistance(g[i][0],w);return v}}},S.calculatePointLength=function(f,B,v,h){h==c&&(h=.1);var a=Ue(c,f,B),B=[];if(a){for(var Z=a.length,J=0;Z>J;J++){var T=a[J];T._as&&(T=T._as);for(var l=T[0],x=1;x<T.length;x++)B.push([l,T[x]]),l=T[x]}for(var q=[],J=0;J<B.length;J++){var t=ao(B[J][0],B[J][1],v);q.push(t)}var X=q.slice(0);X.sort(function(i,c){return i.z>c.z?1:i.z<c.z?-1:0});var Y=X[0];if(Y.z<h){for(var n=q.indexOf(Y),D=0,J=0;n>=J;J++)D+=n>J?S.getDistance(B[J][0],B[J][1]):S.getDistance(B[J][0],Y);return D}}},R.calculateClosestPoint=function(m,E){var G=this,T=G.getDataUI(m),H=Ue(T),o=[];if(H){for(var p=H.length,s=0;p>s;s++){var W=H[s];W._as&&(W=W._as);for(var l=W[0],N=1;N<W.length;N++)o.push([l,W[N]]),l=W[N]}for(var Q=[],s=0;s<o.length;s++){var I=ao(o[s][0],o[s][1],E);Q.push(I)}return Q.sort(function(I,Z){return I.z>Z.z?1:I.z<Z.z?-1:0}),Q[0]}},S.calculateClosestPoint=function(k,v,J){var G=Ue(c,k,v),v=[];if(G){for(var y=G.length,K=0;y>K;K++){var B=G[K];B._as&&(B=B._as);for(var u=B[0],E=1;E<B.length;E++)v.push([u,B[E]]),u=B[E]}for(var h=[],K=0;K<v.length;K++){var q=ao(v[K][0],v[K][1],J);h.push(q)}return h.sort(function(v,U){return v.z>U.z?1:v.z<U.z?-1:0}),h[0]}},R.getPercentAngle=function(Z,M){var e=this,N=e.getDataUI(Z),g=Z.getRotation?Z.getRotation():0,H=Ue(N);if(H)if(0===M){var S=H[0][0],w=H[0][1];g+=B(w.y-S.y,w.x-S.x)}else if(100===M){H=H[H.length-1];var S=H[H.length-2],w=H[H.length-1];g+=B(w.y-S.y,w.x-S.x)}else{for(var s=0,Q=[],j=H.length,T=0;j>T;T++){var i=H[T],L=wd(i);s+=L,Q.push(L)}for(var o=s*M/100,y=Lc(o,Q),k=0,r=0;y>r;r++)k+=Q[r];o-=k;for(var W=Ti(H[y],o),l=H[y],X=0,f=0,z=0;z<l.length-1;z++){var n=l[z],U=l[z+1],I=U.x-n.x,h=U.y-n.y,u=v(I*I+h*h);if(X+=u,X>o){f=z;break}}var x=l[f];g+=B(W.y-x.y,W.x-x.x)}return g},S.getPercentAngle=function(C,P,u){var a=0,i=Ue(c,C,P);if(i)if(0===u){var Q=i[0][0],h=i[0][1];a+=B(h.y-Q.y,h.x-Q.x)}else if(100===u){i=i[i.length-1];var Q=i[i.length-2],h=i[i.length-1];a+=B(h.y-Q.y,h.x-Q.x)}else{for(var $=0,O=[],E=i.length,e=0;E>e;e++){var Y=i[e],T=wd(Y);$+=T,O.push(T)}for(var x=$*u/100,D=Lc(x,O),k=0,V=0;D>V;V++)k+=O[V];x-=k;for(var y=Ti(i[D],x),W=i[D],X=0,t=0,s=0;s<W.length-1;s++){var q=W[s],p=W[s+1],F=p.x-q.x,G=p.y-q.y,M=v(F*F+G*G);if(X+=M,X>x){t=s;break}}var S=W[t];a+=B(y.y-S.y,y.x-S.x)}return a},R.calculateLength=function(G){var O=this,m=O.getDataUI(G),w=Ue(m),C=0;if(w)if(Array.isArray(w[0]))for(var a=w.length,p=0;a>p;p++){var L=w[p],j=wd(L);C+=j}else C=wd(w);return C},S.calculateLength=function(J,E){var J=Ue(c,J,E),I=0;if(J)if(Array.isArray(J[0]))for(var t=J.length,N=0;t>N;N++){var a=J[N],P=wd(a);I+=P}else I=wd(J);return I};var ao=S.calculateClosestPointOnLine=function(q,H,s){var C=q.x,t=q.y,T=H.x,e=H.y,y=s.x,E=s.y,f={},a=T-C,u=e-t,R=Math.sqrt(a*a+u*u),N=a/R,P=u/R,z=(-C+y)*N+(-t+E)*P;return f.x=C+z*N,f.y=t+z*P,lk(f,q,H)||(f.x=Math.abs(f.x-q.x)<Math.abs(f.x-H.x)?q.x:H.x,f.y=Math.abs(f.y-q.y)<Math.abs(f.y-H.y)?q.y:H.y),a=y-f.x,u=E-f.y,f.z=Math.sqrt(a*a+u*u),f},lk=function(m,A,K){return m.x>=Math.min(A.x,K.x)&&m.x<=Math.max(A.x,K.x)&&m.y>=Math.min(A.y,K.y)&&m.y<=Math.max(A.y,K.y)},wd=function(y){for(var T=0,$=y.length-1,i=0;$>i;i++){var M=y[i],P=y[i+1],w=P.x-M.x,g=P.y-M.y,u=v(w*w+g*g);T+=u}return T},Ti=function(p,D){for(var H=0,r=0,T=0,x=p.length-1,K=0;x>K;K++){var E=p[K],S=p[K+1],w=S.x-E.x,R=S.y-E.y;if(T=v(w*w+R*R),H+=T,H>D){H-=T,r=K;break}}var y=p[r],$=p[r+1],M=B($.y-y.y,$.x-y.x),h=D-H,R=F(M)*h,w=o(M)*h;return{x:y.x+w,y:y.y+R}},Ad=function(j,L,D,m){var l=o(m),X=F(m),Y=l*L-X*D,H=X*L+l*D;return j?{x:j.x+Y,y:j.y+H}:{x:Y,y:H}},$q=function(Z,m){Z[G]=Z[N]=Z[p]=m[w]=c},zk=function(D,h,j,R,J,N){var p,l,K,b,u,H,e,O,w,m,T,Q=[];if($(R)>q&&(R=q),u=Z($(R)/(W/4)),p=R/u,l=-p,K=-j,u>0){H=D+o(j)*J,e=h+F(-j)*N,Q.push({x:H,y:e});for(var C=0;u>C;C++)K+=l,b=K-l/2,O=D+o(K)*J,w=h+F(K)*N,m=D+o(b)*(J/o(l/2)),T=h+F(b)*(N/o(l/2)),Q.push({x:m,y:T}),Q.push({x:O,y:w})}return Q},Ue=function(D,w,l){if(w==c){var N=D._data;if(N instanceof Q){if(w=N.getPoints(),l=N.getSegments(),(!l||0===l.size())&&w){l=new j.List([1]);for(var R=1;R<w.size();R++)l.add(2)}}else if(N instanceof I){var a=D._78o;if(a){var C=a.type,s=a.points,y=a.segments,i=a.edgeTypeInfo;if(!C||s){var T=a.sourcePoint,L=T.x,e=T.y,A=a.targetPoint,_=A.x,K=A.y;if(C)y?(w=new u({x:L,y:e}),w.addAll(s),w.add({x:_,y:K}),l=new u(y._as)):(w=new u({x:L,y:e}),l=new u([1]),s.each(function(T){w.add(T),l.add(2)}),w.add({x:_,y:K}),l.add(2));else if(a.looped){w=new u(zk(L,e,0,q,a.radius,a.radius)),l=new u([1]);for(var R=0;R<(w.size()-1)/2;R++)l.add(3)}else w=new u,a.center?(w.add({x:a.c1.x,y:a.c1.y}),w.add({x:L,y:e}),w.add({x:_,y:K}),w.add({x:a.c2.x,y:a.c2.y}),l=new u([1,2,2,2])):(w.add({x:L,y:e}),w.add({x:_,y:K}),l=new u([1,2]))}else if(i)if(w=new u(i.points._as),i.segments)l=new u(i.segments._as);else{l=new u([1]);for(var R=1;R<i.points.size();R++)l.add(2)}}}}if(w){if(Array.isArray(w)&&(w=new u(w)),"number"==typeof w.get(0)){for(var g=new j.List,R=0;R<w.size();R+=2)g.add({x:w.get(R),y:w.get(R+1)});w=g}if(!l){l=[];for(var R=0;R<w.size();R++)0===R?l.push(1):l.push(2)}Array.isArray(l)&&(l=new u(l));for(var d=r.toPointsArray(w._as,l._as,50),t=d.length,G=[],R=0;t>R;R++){var S=d[R];S.length>1&&G.push(S)}return G}},qg=function(U){var l=U._data,b=Ue(U);if(b){l.s("flow.reverse")&&(b.reverse(),b.forEach(function(Q){Q.reverse()}));for(var Q=0,L=[],h=b.length,Z=0;h>Z;Z++){var c=b[Z],J=wd(c);Q+=J,L.push(J)}if(l[G]=L,l[N]=Q,l[p]=b,l instanceof I){var f=S.unionPoint(b),C=f.x+f.width/2,y=f.y+f.height/2;l.$10e={x:C,y:y}}zq(U,!0)}},zq=(S.getPercentPositionOnPoints=function(S,t,s){if(S){var O=Ue(c,S,t);if(O){var P;if(0===s)P=O[0][0];else if(100===s)O=O[O.length-1],P=O[O.length-1];else{for(var B=0,N=[],z=O.length,h=0;z>h;h++){var E=O[h],f=wd(E);B+=f,N.push(f)}for(var I=B*s/100,u=Lc(I,N),p=0,R=0;u>R;R++)p+=N[R];I-=p,P=Ti(O[u],I)}return P}}},R.getPercentPosition=function(A,L){var G=this,X=G.getDataUI(A),V=Ue(X);if(V){var H;if(0===L)H=V[0][0];else if(100===L)V=V[V.length-1],H=V[V.length-1];else{for(var T=0,W=[],B=V.length,l=0;B>l;l++){var v=V[l],a=wd(v);T+=a,W.push(a)}for(var m=T*L/100,U=Lc(m,W),S=0,Q=0;U>Q;Q++)S+=W[Q];m-=S,H=Ti(V[U],m)}return H}},function(O,I){var n=O._data,Q=n[N],d=n.s(x),Z=n.s(t),L=0,H=n[G],c=n.s(h),J=n.s(f),v=n.s(E),V=(c-J)/(v-1),D=[];if(H){if(1===v)D.push(c);else if(2===v)D.push(c),D.push(J);else{if(!(v>2))return;D.push(c);for(var Y=v-2;Y>0;Y--)D.push(J+V*Y);D.push(J)}var q=0,B=0;D.forEach(function(Z){v-1>q&&(B+=n.getFlowElementSpace(Z)),q++}),B+=(c+J)/2,L=(Q-d*B+B)/d;var M=O[w];for(null==M&&(M=0),I||(M+=Z);M>Q+B;){var R=O._overCount;R?R++:R=1,R>=d&&(R=null),O._overCount=R,n.s("flow.autoreverse")?R?M-=L+B:(M=0,n.s("flow.reverse",!n.s("flow.reverse"))):M-=L+B}O[w]=M}}),Li=function(p){var K=p.data,r=this.dm();if(K&&"add"===p.kind){var q=r.$3e;q&&K.s(D)&&q.indexOf(K)<0&&q.push(K)}"clear"===p.kind&&(r.$3e=[])},Em=function(i){var Y=i.property,$=i.data,t=i.newValue,V=this.dm().$3e;if(V&&"s:flow"===Y)if(t)V.indexOf($)<0&&V.push($);else for(var s=V.length,O=0;s>O;O++)if(V[O]===$){V.splice(O,1);break}},Lc=Lc=function(p,q){for(var r=0,z=q.length,G=0;z>G;G++){var h=q[G];if(r+=h,r>p)return G}return Math.min(G,z-1)},ek=function(F){var o=this,n=o._data,a=n[N],P=n[G],W=n[p],s=n.s(x),l=0,j=o[w],r=n.s(h),u=n.s(f),q=n.s(E),$=n.s(H),X=n.s(y),z=n.s(V),C=(X-$)/(q-1),i=(r-u)/(q-1),S=n.getRotation?n.getRotation():0,T=n.getPosition?n.p():n.$10e,d=[],I=[];if(j!=c){if(1===q)d.push(r);else if(2===q)d.push(r),d.push(u);else{if(!(q>2))return;d.push(r);for(var L=q-2;L>0;L--)d.push(u+i*L);d.push(u)}if(1===q)I.push(X);else if(2===q)I.push(X),I.push($);else{if(!(q>2))return;I.push(X);for(var L=q-2;L>0;L--)I.push($+C*L);I.push($)}var R=0,U=0;d.forEach(function(v){q-1>R&&(U+=n.getFlowElementSpace(v)),R++}),U+=(r+u)/2,l=(a-s*U+U)/s,F.save();for(var L=0;s>L;L++){var g=j,K=0,t=o._overCount,e=0;n.s("flow.autoreverse")&&t&&t>s-(L+1)||(g-=L*(l+U),R=0,d.forEach(function(E){var t=g-K;if(t>=0&&a>t){var w=!0,O=Lc(t,P);e=0;for(var q=0;O>q;q++)e+=P[q];if(t-=e,w){var Z=Ti(W[O],t),U=S;if(z){for(var l=W[O],m=0,h=0,b=0;b<l.length-1;b++){var u=l[b],y=l[b+1],k=y.x-u.x,D=y.y-u.y,Q=v(k*k+D*D);if(m+=Q,m>t){h=b;break}}var f=l[h];U+=B(Z.y-f.y,Z.x-f.x)}S&&(Z=Ad(T,Z.x-T.x,Z.y-T.y,S)),o.$5e(F,Z,E,I[R],U)}}K+=n.getFlowElementSpace(d[R]),R++}))}F.restore()}},Kn=function(){var m=this,W=m._data,b=W.s(h),O=!1,p=c;if(m._6I||(O=!0),p=W instanceof I?M.call(m):g.call(m),W.s(D)&&O){var e=W.s(y),j=W.s(s);j&&e>b&&(b=e),b>0&&S.grow(p,Z(b/2)),qg(m)}return!W.s(D)&&O&&$q(W,m),p};n.getFlowElementSpace=function(){return this.s(T)},e._79o=Kn,_._79o=Kn,J[h]==c&&(J[h]=7),J[f]==c&&(J[f]=0),J[x]==c&&(J[x]=1),J[t]==c&&(J[t]=3),J[E]==c&&(J[E]=10),J[T]==c&&(J[T]=3.5),J[V]==c&&(J[V]=!1),J[d]==c&&(J[d]="rgba(255, 255, 114, 0.4)"),J[X]==c&&(J[X]="rgba(255, 255, 0, 0.3)"),J[l]==c&&(J[l]="rgba(255, 255, 0, 0)"),J[s]==c&&(J[s]=1),J[y]==c&&(J[y]=22),J[H]==c&&(J[H]=4),i.prepareRemove=function(I){K.call(this,I);var h=I._dataModel,x=h.$3e;if(x)for(var V=x.length,J=0;V>J;J++)if(x[J]===I){x.splice(J,1);break}},R.setDataModel=function(u){var A=this,N=A._dataModel;if(N!==u){N&&(N.umm(Li,A),N.umd(Em,A),N.$3e=[]),u.mm(Li,A),u.md(Em,A);var l=u.$3e=[];u.each(function(t){t.s(D)&&l.indexOf(t)<0&&l.push(t)}),Sf.call(A,u)}},R.setFlowInterval=function(g){var U=this,D=U.$11e;U.$11e=g,U.fp("flowInterval",D,g),U.$7e!=c&&(clearInterval(U.$7e),delete U.$7e,U.enableFlow(g))},R.getFlowInterval=function(){return this.$11e},R.$9e=function(){var b,k,m,p=this,E=p.tx(),w=p.ty(),J=p.getZoom(),W=p.getWidth(),K=p.getHeight(),q={x:-E/J,y:-w/J,width:W/J,height:K/J},x=p.dm().$3e,P=p._56I,T=new u;if(x.forEach(function(j){P[j.getId()]&&(b=p.getDataUI(j),b&&(m=b._79o(),m&&T.add(m)))}),0!==T.size()&&(T.each(function(m){S.intersectsRect(q,m)&&(k=S.unionRect(k,m))}),k&&(k&&(S.grow(k,z(1,1/J)),k.x=O(k.x*J)/J,k.y=O(k.y*J)/J,k.width=Z(k.width*J)/J,k.height=Z(k.height*J)/J,k=S.intersection(q,k)),k))){var R=p._canvas.getContext("2d");R.save(),R.lineCap=S.lineCap,R.lineJoin=S.lineJoin,r.translateAndScale(R,E,w,J),R.beginPath(),R.rect(k.x,k.y,k.width,k.height),R.clip(),R.clearRect(k.x,k.y,k.width,k.height),p.$6e(R,k),R.restore()}},R.$6e=function(z,l){var s,X,R=this;R._93db(z),R.each(function(d){R._56I[d._id]&&(s=R.getDataUI(d),s&&(X=s._79o(),(!l||S.intersectsRect(l,X))&&s._42(z)))}),R._92db(z)},R.enableFlow=function(L){var P=this,f=P.dm(),F=f.$3e;P.$7e==c&&(F.forEach(function(J){var X=P.getDataUI(J);qg(X)}),P.$7e=setInterval(function(){f.$3e.forEach(function(G){zq(P.getDataUI(G))}),P.$9e()},L||P.$11e||50))},R.disableFlow=function(){var T=this;clearInterval(T.$7e),delete T.$7e;var R=T.dm().$3e;R&&T.$9e()},C.$5e=function(M,g,U,z,$){var Q=this,p=Q._data,t=Q.gv,I=p.s(d),m=p.s(X),Y=p.s(l),y=p.s(s),B=t.$8e,e=p.s(k);if(B==c&&(B=t.$8e={}),M.beginPath(),e!=c){var H=S.getImage(e),n=U/2;M.translate(g.x,g.y),M.rotate($),M.translate(-g.x,-g.y),S.drawImage(M,H,g.x-n,g.y-n,U,U,p),M.translate(g.x,g.y),M.rotate(-$),M.translate(-g.x,-g.y)}else M.fillStyle=I,M.arc(g.x,g.y,U/2,0,q,!0),M.fill();if(y){var _=22,W=_+"_"+m+"_"+Y,v=B[W];if(v==c){var w=oi("canvas");r.setCanvas(w,_,_);var O=w.getContext("2d"),J=_/2,C=J,R=J;r.translateAndScale(O,0,0,1),O.beginPath();var u=O.createRadialGradient(C,R,0,C,C,J);u.addColorStop(0,m),u.addColorStop(1,Y),O.fillStyle=u,O.arc(C,R,J,0,q,!0),O.fill(),v=B[W]=w}var n=z/2;S.drawImage(M,v,g.x-n,g.y-n,z,z,p)}},_._80o=function(A){a.call(this,A);var S=this,_=S._data,s=S.gv;_.s(D)&&s.$7e!=c&&ek.call(S,A)},e._80o=function(S){P.call(this,S);var m=this,l=m._data,U=m.gv;l.s(D)&&U.$7e!=c&&ek.call(m,S)}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);