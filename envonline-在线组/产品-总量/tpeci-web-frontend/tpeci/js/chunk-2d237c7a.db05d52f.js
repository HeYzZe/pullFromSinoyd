(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d237c7a"],{fd28:function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("dialog-modal",{ref:"dialog",attrs:{type:"title",size:"mini",maxScrollbar:"",title:(e.isEdit?"编辑":"新增")+"基本信息"}},[o("el-form",{ref:"form",staticClass:"item-space pad-a-xs",attrs:{rules:e.formRules,model:e.itemModel,"label-width":"90px"}},[o("el-form-item",{attrs:{label:"卡类型：","hint-down":""}},[o("el-select",{attrs:{value:"1",disabled:""}},[o("el-option",{attrs:{value:"1",label:"用户卡"}})],1)],1),o("el-form-item",{attrs:{label:"卡号：",prop:"cardCode"}},[o("el-input",{attrs:{disabled:e.isEdit},model:{value:e.itemModel.cardCode,callback:function(t){e.$set(e.itemModel,"cardCode",t)},expression:"itemModel.cardCode"}},[o("el-button",{attrs:{slot:"append",icon:"fas fa-address-card"},on:{click:e.onReadCard},slot:"append"},[e._v(" 读 卡")])],1)],1),o("el-form-item",{attrs:{label:"持卡人：",prop:"optionName"}},[o("el-input",{attrs:{clearable:""},model:{value:e.itemModel.optionName,callback:function(t){e.$set(e.itemModel,"optionName",t)},expression:"itemModel.optionName"}})],1),o("el-form-item",{attrs:{label:"联系电话：",prop:"telephone"}},[o("el-input",{attrs:{clearable:""},model:{value:e.itemModel.telephone,callback:function(t){e.$set(e.itemModel,"telephone",t)},expression:"itemModel.telephone"}})],1),o("el-form-item",{attrs:{label:"关联站点：",prop:"portId"}},[o("select-port-one",{attrs:{disabled:e.isEdit,filterable:"",options:e.select.portList,field:[{name:"psName",key:"psId"},{name:"portName",key:"id"}]},on:{change:e.onChangePort},model:{value:e.itemModel.portId,callback:function(t){e.$set(e.itemModel,"portId",t)},expression:"itemModel.portId"}})],1)],1),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary",icon:"fas fa-save",loading:e.saveLoading},on:{click:function(t){return e.onSaveCheck(e.saveCallback)}}},[e._v("保 存\n    ")]),o("el-button",{attrs:{icon:"fas fa-times"},on:{click:function(t){return e.$refs.dialog.closeDialog()}}},[e._v("关 闭")])],1)],1)},s=[],i=(o("8e6e"),o("ac6a"),o("456d"),o("768b")),a=o("bd86"),n=o("2f62"),d=o("73cb"),l=o("0069"),c=o("b7bb");function p(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function m(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?p(o,!0).forEach((function(t){Object(a["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):p(o).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var u={mixins:[d["d"]],components:{SelectPortOne:c["default"]},data:function(){return{url:"tpeci/iCUserCard",itemModel:{regionCodeId:"",regionName:"",psId:"",psName:"",portId:"",portName:"",cardCode:"",optionName:"",telephone:"",optionId:"",cardStatus:1},select:{portList:[]},formRules:{portId:[{required:!0,message:"请选择站点",trigger:["change","blur"]}],cardCode:[{required:!0,message:"请输入卡号",trigger:["change","blur"]}],optionName:[{required:!0,message:"请输入持卡人",trigger:["change","blur"]}],telephone:[{required:!0,message:"请输入联系电话",trigger:["change","blur"]},{max:15,message:"请输入合适联系电话",trigger:["change","blur"]}]},socket:"",dtoSend:{Order:"",Param:""}}},created:function(){this.init()},destroyed:function(){this.socket.close()},computed:m({},Object(n["c"])("auth",["userName"]),{isEdit:function(){return this.itemModel.id&&!0}}),methods:{init:function(){this.socket=new WebSocket("ws://127.0.0.1:10086/websocket"),this.socket.onopen=this.open,this.socket.onerror=this.error,this.socket.onmessage=this.getMessage,this.socket.onclose=this.close},open:function(){console.log("socket连接成功")},error:function(){console.log("连接错误")},getMessage:function(e){var t=JSON.parse(e.data);console.log(t),"selectCard"===t.Order&&(t.Success?this.itemModel.cardCode=t.Data.cardNum:this.$message.error(t.Message)),"initCard"===t.Order&&(t.Success?this.$message.success(t.Message):this.$message.error(t.Message))},onReadCard:function(){this.socket.readyState===WebSocket.OPEN&&(this.dtoSend.Order="selectCard",this.socket.send(JSON.stringify(this.dtoSend)))},close:function(){console.log("socket已经关闭")},onChangePort:function(e){if(e){var t=this.select.portList.filter((function(t){return t.id===e.value})),o=Object(i["a"])(t,1),r=o[0];this.itemModel.regionCodeId=r.regionCodeId,this.itemModel.regionName=r.regionName,this.itemModel.psId=r.psId,this.itemModel.psName=r.psName,this.itemModel.portName=r.portName}else this.itemModel.regionCodeId="",this.itemModel.regionName="",this.itemModel.psId="",this.itemModel.psName="",this.itemModel.portName=""},openDialog:function(e){var t=this;this.$refs.dialog.openDialog(),this.itemModel=this.setEmptyItem(e),this.getPortList(),this.$nextTick((function(){t.$refs.form.clearValidate()}))},saveCallback:function(e){if(this.socket.readyState===WebSocket.OPEN){this.dtoSend.Order="initCard";var t={ICId:e.id,CardType:"00"};this.dtoSend.Param=JSON.stringify(t),this.socket.send(JSON.stringify(this.dtoSend))}this.$refs.dialog.closeDialog(),this.$emit("query")},getPortList:function(){var e=this;this.$http.get("bas/portInfo/queryAuthority",{params:{childPortType:5,page:1,rows:1e5,portType:1,sort:"psName+,portName"}}).then((function(t){200===t.status&&t.data.success&&(e.select.portList=t.data.data)}),(function(e){var t=e.response;Object(l["a"])(t)}))},setEmptyItem:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};return e.id&&(t={id:e.id}),m({},t,{regionCodeId:e.regionCodeId||"",regionName:e.regionName||"",psId:e.psId||"",psName:e.psName||"",portId:e.portId||"",portName:e.portName||"",cardCode:e.cardCode||"",optionName:e.optionName||"",telephone:e.telephone||"",optionId:e.optionId||"",cardStatus:e.cardStatus||1})}}},h=u,f=o("2877"),g=Object(f["a"])(h,r,s,!1,null,"055d146d",null);t["default"]=g.exports}}]);