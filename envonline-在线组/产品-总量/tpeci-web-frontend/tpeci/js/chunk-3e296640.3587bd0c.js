(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3e296640"],{"1a66":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("dialog-modal",{ref:"dialog",attrs:{type:"title",width:"35%",maxScrollbar:"",title:(e.isEdit?"编辑":"新增")+"基本信息"}},[a("div",{staticClass:"title-info mar-b-xs"},[e._v("基本信息")]),a("el-form",{ref:"form",staticClass:"item-space pad-a-xs",attrs:{rules:e.formRules,model:e.itemModel,"label-width":"90px"}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"卡类型：","hint-down":"",prop:"cardType"}},[a("el-select",{model:{value:e.itemModel.cardType,callback:function(t){e.$set(e.itemModel,"cardType",t)},expression:"itemModel.cardType"}},e._l(e.$enum.get("IC_CARD_TYPE"),(function(e,t){return a("el-option",{key:t,attrs:{value:e.value,label:e.label}})})),1)],1),a("el-form-item",{attrs:{label:"卡号：",prop:"cardCode"}},[a("el-input",{attrs:{disabled:e.isEdit},model:{value:e.itemModel.cardCode,callback:function(t){e.$set(e.itemModel,"cardCode",t)},expression:"itemModel.cardCode"}},[a("el-button",{attrs:{slot:"append",icon:"fas fa-address-card"},on:{click:e.onReadCard},slot:"append"})],1)],1),a("el-form-item",{attrs:{label:"单位名称：",prop:"affiliationUnit"}},[a("el-input",{attrs:{clearable:""},model:{value:e.itemModel.affiliationUnit,callback:function(t){e.$set(e.itemModel,"affiliationUnit",t)},expression:"itemModel.affiliationUnit"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"部门名称："}},[a("el-input",{attrs:{clearable:""},model:{value:e.itemModel.department,callback:function(t){e.$set(e.itemModel,"department",t)},expression:"itemModel.department"}})],1),a("el-form-item",{attrs:{label:"持卡人：",prop:"optionName"}},[a("el-input",{attrs:{clearable:""},model:{value:e.itemModel.optionName,callback:function(t){e.$set(e.itemModel,"optionName",t)},expression:"itemModel.optionName"}})],1),a("el-form-item",{attrs:{label:"联系电话：",prop:"telephone"}},[a("el-input",{attrs:{clearable:""},model:{value:e.itemModel.telephone,callback:function(t){e.$set(e.itemModel,"telephone",t)},expression:"itemModel.telephone"}})],1)],1)],1)],1),a("div",{staticClass:"title-info mar-b-xs"},[e._v("关联站点")]),a("div",{staticClass:"pad-b-sm"},[a("div",{staticClass:"mar-l-sm mar-y-xs"},[a("el-form",{attrs:{inline:"",model:e.queryForm}},[a("el-form-item",{attrs:{label:"企业名称："}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入企业名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getPortList(t)}},model:{value:e.queryForm.psName,callback:function(t){e.$set(e.queryForm,"psName",t)},expression:"queryForm.psName"}})],1),a("el-form-item",{attrs:{label:"所属区域："}},[a("area-select",{attrs:{placeholder:"请选择"},on:{setLabel:e.getPortList},model:{value:e.queryForm.regionCodeId,callback:function(t){e.$set(e.queryForm,"regionCodeId",t)},expression:"queryForm.regionCodeId"}})],1)],1)],1),e.isShow?a("el-transfer",{directives:[{name:"loading",rawName:"v-loading",value:e.transferLoading,expression:"transferLoading"}],ref:"transfer",staticStyle:{height:"380px"},attrs:{filterable:"",titles:["待选","已选"],data:e.select.portList,props:{key:"id",label:"portName"}},model:{value:e.portIds,callback:function(t){e.portIds=t},expression:"portIds"}}):e._e()],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",icon:"fas fa-save",loading:e.saveLoading},on:{click:function(t){return e.onSaveCheck(e.saveCallback)}}},[e._v("保 存\n    ")]),a("el-button",{attrs:{icon:"fas fa-times"},on:{click:e.closeDialog}},[e._v("关 闭")])],1)],1)},o=[],i=(a("8e6e"),a("ac6a"),a("456d"),a("6762"),a("2fdb"),a("bd86")),n=a("2f62"),s=a("73cb"),l=a("0069"),c=a("c90e");function d(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function u(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?d(a,!0).forEach((function(t){Object(i["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):d(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var m={mixins:[s["d"]],components:{AreaSelect:c["a"]},data:function(){return{isShow:!1,url:"tpeci/iCManageCard",transferLoading:!1,queryForm:{cardId:"",psName:"",regionCodeId:""},itemModel:{cardCode:"",optionName:"",telephone:"",department:"",affiliationUnit:"",cardType:1,optionId:"",cardStatus:1},select:{portList:[]},portIds:[],formRules:{cardCode:[{required:!0,message:"请输入卡号",trigger:["change","blur"]}],cardType:[{required:!0,message:"请选择卡类型",trigger:["change","blur"]}],affiliationUnit:[{required:!0,message:"请输入单位名称",trigger:["change","blur"]}],optionName:[{required:!0,message:"请输入持卡人",trigger:["change","blur"]}],telephone:[{required:!0,message:"请输入联系电话",trigger:["change","blur"]},{max:15,message:"请输入合适联系电话",trigger:["change","blur"]}]},socket:{},dtoSend:{Order:"",Param:""}}},created:function(){this.init()},destroyed:function(){this.socket.close()},computed:u({},Object(n["c"])("auth",["userName"]),{isEdit:function(){return this.itemModel.id&&!0}}),methods:{init:function(){this.socket=new WebSocket("ws://127.0.0.1:10086/websocket"),this.socket.onopen=this.open,this.socket.onerror=this.error,this.socket.onmessage=this.getMessage,this.socket.onclose=this.close},open:function(){console.log("socket连接成功")},error:function(){console.log("连接错误")},getMessage:function(e){var t=JSON.parse(e.data);console.log(t),"selectCard"===t.Order&&(t.Success?this.itemModel.cardCode=t.Data.cardNum:this.$message.error(t.Message)),"initCard"===t.Order&&(t.Success?this.$message.success(t.Message):this.$message.error(t.Message))},onReadCard:function(){this.socket.readyState===WebSocket.OPEN&&(this.dtoSend.Order="selectCard",this.socket.send(JSON.stringify(this.dtoSend)))},openDialog:function(e){var t=this;this.isShow=!0,this.$refs.dialog.openDialog(),this.itemModel=this.setEmptyItem(e),this.queryForm={psName:"",regionCodeId:""},this.portIds=[],e&&e.id&&this.getItemList(),this.getPortList(),this.$nextTick((function(){t.$refs.form.clearValidate()}))},closeDialog:function(){this.isShow=!1,this.$refs.dialog.closeDialog()},saveCallback:function(e){var t=this;this.$refs.dialog.closeDialog(),this.$emit("query"),this.queryForm.cardId=this.itemModel.id;var a=this.select.portList.filter((function(e){return t.portIds.includes(e.id)})).map((function(t){return{portId:t.id,cardId:e.id,regionCodeId:t.id,regionName:t.regionName,psId:t.psId,psName:t.psName,portName:t.portName}}));if(this.setPortList(a),this.socket.readyState===WebSocket.OPEN){this.dtoSend.Order="initCard";var r={ICId:e.id,CardType:"0".concat(e.cardType)};this.dtoSend.Param=JSON.stringify(r),this.socket.send(JSON.stringify(this.dtoSend))}},getItemList:function(){var e=this;this.$http.get("tpeci/iCManageCard2Port",{params:{page:1,rows:1e6,cardId:this.queryForm.cardId}}).then((function(t){200===t.status&&t.data.success?e.portIds=t.data.data.map((function(e){return e.portId})):e.$message.warning({message:t.data.msg,duration:3e3,showClose:!0})}),(function(e){var t=e.response;Object(l["a"])(t)}))},getPortList:function(){var e=this;this.$http.get("bas/portInfo/queryAuthority",{params:{childPortType:5,page:1,rows:1e5,portType:1,psName:this.queryForm.psName,regionCodeId:this.queryForm.regionCodeId,sort:"psName+,portName"}}).then((function(t){200===t.status&&t.data.success&&(e.select.portList=t.data.data,e.queryForm.cardId&&e.getItemList())}),(function(e){var t=e.response;Object(l["a"])(t)})).finally((function(){e.transferLoading=!1}))},setPortList:function(e){var t=this;this.saveLoading=!0,this.$http.post("tpeci/iCManageCard2Port/".concat(this.queryForm.cardId),e).then((function(e){200===e.status&&e.data.success||t.$message.warning({message:e.data.msg||e.data.message,duration:3e3,showClose:!0})}),(function(e){var t=e.response;Object(l["a"])(t)})).finally((function(){t.saveLoading=!1}))},setEmptyItem:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};return e.id&&(t={id:e.id}),u({},t,{department:e.department||"",affiliationUnit:e.affiliationUnit||"",cardType:e.cardType||1,cardCode:e.cardCode||"",optionName:e.optionName||"",telephone:e.telephone||"",optionId:e.optionId||"",cardStatus:e.cardStatus||1})}}},p=m,f=a("2877"),h=Object(f["a"])(p,r,o,!1,null,"efa5eaca",null);t["default"]=h.exports},5690:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"fill-h"},[a("el-form",{staticClass:"mar-t-xs mar-l-sm",attrs:{model:e.queryForm,inline:""}},[a("el-form-item",{attrs:{label:"单位："}},[a("el-input",{staticStyle:{width:"180px"},attrs:{clearable:"",placeholder:"请输入单位"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onQueryList()}},model:{value:e.queryForm.affiliationUnit,callback:function(t){e.$set(e.queryForm,"affiliationUnit",t)},expression:"queryForm.affiliationUnit"}})],1),a("el-form-item",{attrs:{label:"卡类型："}},[a("el-select",{model:{value:e.queryForm.cardType,callback:function(t){e.$set(e.queryForm,"cardType",t)},expression:"queryForm.cardType"}},[a("el-option",{attrs:{label:"全部",value:""}}),e._l(e.$enum.get("IC_CARD_TYPE"),(function(e,t){return a("el-option",{key:t,attrs:{value:e.value,label:e.label}})}))],2)],1),a("el-form-item",{attrs:{label:"卡号："}},[a("el-input",{staticStyle:{width:"180px"},attrs:{clearable:"",placeholder:"请输入卡号"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onQueryList()}},model:{value:e.queryForm.cardCode,callback:function(t){e.$set(e.queryForm,"cardCode",t)},expression:"queryForm.cardCode"}})],1),a("el-form-item",{attrs:{label:"状态："}},[a("el-select",{model:{value:e.queryForm.cardStatus,callback:function(t){e.$set(e.queryForm,"cardStatus",t)},expression:"queryForm.cardStatus"}},[a("el-option",{attrs:{label:"全部",value:""}}),e._l(e.$enum.get("IC_CARD_STATUS"),(function(e,t){return a("el-option",{key:t,attrs:{value:e.value,label:e.label}})}))],2)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"fas fa-search"},on:{click:e.onQueryList}},[e._v("查 询")])],1)],1),a("hr",{staticClass:"mar-b-xs"}),a("div",{staticClass:"mar-l-xs mar-b-xs"},[a("el-button",{attrs:{type:"primary",icon:"fas fa-plus"},on:{click:e.onClickAdd}},[e._v("新 增")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"","highlight-current-row":"",height:"calc(100% - 110px)",data:e.itemList},on:{"selection-change":e.onChangeSelected}},[a("el-table-column",{attrs:{align:"center",label:"No.","min-width":"50",type:"index",index:e.index}}),a("el-table-column",{attrs:{label:"操作",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{disabled:2===t.row.cardStatus,type:"danger",icon:"fas fa-sign-out-alt"},on:{click:function(a){return e.onClickDel(t.row)}}},[e._v("注销")]),a("el-button",{attrs:{disabled:2===t.row.cardStatus,type:"primary",icon:"fas fa-pencil-alt"},on:{click:function(a){return e.onClickEdit(t.row)}}},[e._v("编辑")])]}}])}),a("el-table-column",{attrs:{label:"单位名称",prop:"affiliationUnit","min-width":"120","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"部门",prop:"department","min-width":"130","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"卡类型",prop:"cardType","min-width":"120","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n        "+e._s(e.$enum.getLabel("IC_CARD_TYPE",a.cardType))+"\n      ")]}}])}),a("el-table-column",{attrs:{label:"IC卡卡号",prop:"cardCode","min-width":"90","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"持卡人",prop:"optionName","min-width":"90","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"联系电话",prop:"telephone","min-width":"90","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"卡状态",prop:"cardStatus","min-width":"80","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n        "+e._s(e.$enum.getLabel("IC_CARD_STATUS",a.cardStatus))+"\n      ")]}}])})],1),a("paging-query",{attrs:{pager:e.pager},on:{query:e.getItemList}}),a("dialog-form",{ref:"dialog",on:{query:e.getItemList}})],1)},o=[],i=a("0069"),n=a("73cb"),s=a("1a66"),l={name:"ManageCard",mixins:[n["c"]],components:{DialogForm:s["default"]},data:function(){var e=this.$store.getters["auth/orgGuid"]||"";return{isAuto:!1,url:"tpeci/iCManageCard",queryForm:{psId:e,affiliationUnit:"",cardType:"",cardStatus:"",cardCode:"",sort:"modifyDate-,affiliationUnit+,department"},itemModel:{},itemList:[],delLoading:!1}},methods:{onTabClick:function(){this.onQueryList()},onClickAdd:function(){this.$refs.dialog.openDialog()},onClickEdit:function(e){this.$refs.dialog.openDialog(e)},onClickDel:function(e){var t=this,a=this.$createElement;this.$msgbox({title:"警告     注销后无法恢复",message:a("div",null,[a("p",null,[a("span",{style:"width: 60px; display: inline-block"},"卡类型"),a("span",null,"："),a("i",{style:"color: teal",class:"mar-l-sm"},this.$enum.getLabel("IC_CARD_TYPE",e.cardType))]),a("p",null,[a("span",{style:"width: 60px; display: inline-block"},"持卡单位"),a("span",null,"："),a("i",{style:"color: teal",class:"mar-l-sm"},e.affiliationUnit)]),a("p",null,[a("span",{style:"width: 60px; display: inline-block"},"卡号"),a("span",null,"："),a("i",{style:"color: teal",class:"mar-l-sm"},e.cardCode)])]),type:"warning",showCancelButton:!0,closeOnClickModal:!1,confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(){return t.$http.delete(t.url,{data:[e.id]})})).then((function(e){200===e.status&&e.data.success?(t.$message.success({message:"注销成功",duration:3e3,showClose:!0}),t.getItemList()):t.$message.warning({message:e.data.msg,duration:3e3,showClose:!0})}),(function(e){var t=e.response;Object(i["a"])(t)}))}}},c=l,d=a("2877"),u=Object(d["a"])(c,r,o,!1,null,null,null);t["default"]=u.exports},"882d":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.onTabClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"用户卡",lazy:"",name:"userCard"}},[a("user-card",{ref:"userCard"})],1),a("el-tab-pane",{attrs:{label:"管理卡",lazy:"",name:"manageCard"}},[a("manage-card",{ref:"manageCard"})],1)],1)},o=[],i=(a("7f7f"),a("cabd")),n=a("5690"),s={name:"ICUserCard",components:{UserCard:i["default"],ManageCard:n["default"]},data:function(){return{activeName:""}},created:function(){var e=this;this.activeName="userCard",this.$nextTick((function(){e.$refs.userCard.onTabClick()}))},methods:{onTabClick:function(e){var t=this;this.$nextTick((function(){t.$refs[e.name].onTabClick()}))}}},l=s,c=a("2877"),d=Object(c["a"])(l,r,o,!1,null,null,null);t["default"]=d.exports}}]);