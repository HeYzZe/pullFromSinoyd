(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-540aa64a"],{"6c87":function(e,t,i){"use strict";i.r(t);var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("dialog-modal",{ref:"dialog",attrs:{type:"title",size:"mini",maxScrollbar:"",title:(e.isEdit?"编辑":"新增")+"排污核定"},on:{close:e.closeDialog}},[i("el-form",{ref:"form",staticClass:"mar-t-xs pad-x-sm item-space el-box",attrs:{rules:e.rules,"label-width":"100px",model:e.itemModel}},[i("el-form-item",{attrs:{label:"企业名称：",prop:"psId","hint-down":""}},[i("select-table",{attrs:{label:e.itemModel.psName,disable:e.isEdit},on:{change:e.getPSDate},model:{value:e.itemModel.psId,callback:function(t){e.$set(e.itemModel,"psId",t)},expression:"itemModel.psId"}})],1),i("el-form-item",{attrs:{label:"核定年份：",prop:"approvedYear"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"year","value-format":"yyyy",format:"yyyy",clearable:!1,editable:!1},on:{change:e.getYearDate},model:{value:e.itemModel.approvedYear,callback:function(t){e.$set(e.itemModel,"approvedYear",t)},expression:"itemModel.approvedYear"}})],1),i("el-form-item",{attrs:{label:"站点名称：",prop:"portId"}},[i("el-select",{directives:[{name:"loading",rawName:"v-loading",value:e.fploading,expression:"fploading"}],attrs:{filterable:""},on:{change:e.getPortDate},model:{value:e.itemModel.portId,callback:function(t){e.$set(e.itemModel,"portId",t)},expression:"itemModel.portId"}},e._l(e.select.portList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.portName,value:e.id}})})),1)],1),i("el-form-item",{attrs:{label:"因子名称：",prop:"factorId"}},[i("el-select",{directives:[{name:"loading",rawName:"v-loading",value:e.fploading,expression:"fploading"}],staticStyle:{width:"100%"},attrs:{filterable:"",clearable:""},on:{change:e.getFactorDate},model:{value:e.itemModel.factorId,callback:function(t){e.$set(e.itemModel,"factorId",t)},expression:"itemModel.factorId"}},e._l(e.select.factorList,(function(e){return i("el-option",{key:e.factorId,attrs:{label:e.factorName,value:e.factorId}})})),1)],1),i("el-form-item",{attrs:{label:"单位：",prop:"unit"}},[i("el-input",{attrs:{disabled:"",clearable:""},model:{value:e.itemModel.unit,callback:function(t){e.$set(e.itemModel,"unit",t)},expression:"itemModel.unit"}})],1),i("el-form-item",{attrs:{prop:"emissions"}},[i("template",{slot:"label"},[e._v("\n        排放量\n        "),i("span",[i("el-tooltip",{attrs:{effect:"dark",content:"提示：许可排放量："+e.permittedEmissions+" "+e.unit+"\n              | 剩余排放量："+("0.00"===e.notPermittedEmissions.toString()?0:e.notPermittedEmissions)+" "+e.unit,placement:"top"}},[i("i",{staticClass:"el-tooltip el-icon-info"})])],1),i("span",[e._v(" ：")])]),i("el-input",{attrs:{clearable:""},model:{value:e.itemModel.emissions,callback:function(t){e.$set(e.itemModel,"emissions",t)},expression:"itemModel.emissions"}})],2),i("el-form-item",{attrs:{label:"备注：",prop:"remark"}},[i("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.itemModel.remark,callback:function(t){e.$set(e.itemModel,"remark",t)},expression:"itemModel.remark"}})],1)],1),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary",icon:"fas fa-save",loading:e.saveLoading},on:{click:function(t){return e.onSaveCheck(e.saveCallback)}}},[e._v("保 存\n    ")]),i("el-button",{attrs:{icon:"fas fa-times"},on:{click:function(t){return e.$refs.dialog.closeDialog()}}},[e._v("关 闭\n    ")])],1)],1)},a=[],r=(i("7514"),i("6b54"),i("2ef0")),s=i.n(r),l=i("0069"),n=i("73cb"),d=i("9b4e"),c={mixins:[n["d"]],components:{SelectTable:d["a"]},data:function(){return{saveLoading:!1,url:"tpeci/pollutantDischargeApproved",fploading:!1,once:!0,itemModel:{psName:"",psId:"",portId:"",portName:"",factorId:"",factorName:"",factorCode:"",unit:"",emissions:"",approvedTime:"",approvedYear:"",remark:""},select:{portList:[],factorList:[]},notPermittedEmissions:"",permittedEmissions:"",unit:"",rules:{psId:[{required:!0,message:"请选择企业名称",trigger:["blur","change"]}],portId:[{required:!0,message:"请选择站点",trigger:["blur","change"]}],factorId:[{required:!0,message:"请选择因子",trigger:["blur","change"]}],emissions:[{required:!0,message:"请输入排放量",trigger:["blur","change"]},{pattern:/(^[0-9][0-9]*(.[0-9]+)?)$/,message:"请输入数字,且不能为负数"}],approvedYear:[{required:!0,message:"请输入核定年份",trigger:["blur","change"]}]}}},computed:{isEdit:function(){return this.itemModel.id}},watch:{"itemModel.psId":{handler:function(){""===this.itemModel.approvedYear||""===this.itemModel.psId||this.once||(this.getSelectList(),this.itemModel.portId="",this.itemModel.portName="",this.itemModel.factorId="",this.itemModel.factorName="",this.itemModel.factorCode="",this.itemModel.unit="")},deep:!0},"itemModel.approvedYear":{handler:function(){""===this.itemModel.approvedYear||""===this.itemModel.psId||this.once||(this.getSelectList(),this.itemModel.portId="",this.itemModel.portName="",this.itemModel.factorId="",this.itemModel.factorName="",this.itemModel.factorCode="",this.itemModel.unit="")},deep:!0}},methods:{openDialog:function(e){var t=this;this.itemModel.approvedYear=(new Date).getFullYear().toString(),this.getYearDate();var i=e;e&&(i=s.a.cloneDeep(e),this.itemModel.psName=i.psName||"",this.permittedEmissions=e.permittedEmissions||"",this.notPermittedEmissions=e.notPermittedEmissions||"",this.unit=e.unit||"",this.itemModel=this.setEmptyItem(i),this.getSelectList()),this.$refs.dialog.openDialog(),this.$nextTick((function(){t.once=!1,t.$refs.form.clearValidate()}))},getSelectList:function(){var e=this;this.select.factorList=[],this.select.portList=[],this.fploading=!0,this.$http.get("tpeci/pollutantDischargeApproved/factor",{params:{psId:this.itemModel.psId,approvedYear:this.itemModel.approvedYear}}).then((function(t){if(200===t.status&&t.data.success){var i=t.data.data||{};e.select.factorList=i.factorList||[],e.select.portList=i.portList||[]}else e.$message.warning({message:t.data.msg,duration:3e3,showClose:!0})}),(function(e){var t=e.response;Object(l["a"])(t)})).finally((function(){e.fploading=!1}))},getPSDate:function(e){this.itemModel.psName=e},getFactorDate:function(e){var t={};t=this.select.factorList.find((function(t){return t.factorId===e}))||{},this.itemModel.factorName=t.factorName||"",this.itemModel.factorCode=t.factorCode||"",this.itemModel.unit=t.unit||"",this.notPermittedEmissions=t.notPermittedEmissions||"",this.permittedEmissions=t.permittedEmissions||"",this.unit=t.unit||""},getYearDate:function(){this.itemModel.approvedTime=this.$tools.formatDate(new Date,"Y-m-d H:i:s")},getPortDate:function(e){var t={};t=this.select.portList.find((function(t){return t.id===e})),this.itemModel.portName=t.portName||"",this.itemModel.regionCodeId=t.regionCodeId||"",this.itemModel.regionName=t.regionName||""},onSaveCheck:function(e){var t=this;this.$refs.form.validate((function(i){i&&t.onSaveItem(e)}))},saveCallback:function(){this.once=!0,this.$refs.dialog.closeDialog(),this.$emit("query")},closeDialog:function(){this.once=!0,this.select={portList:[],factorList:[]},this.notPermittedEmissions="",this.permittedEmissions="",this.unit="",this.psName="",this.itemModel=this.getEmptyItem()},getEmptyItem:function(){return{psName:"",psId:"",portId:"",portName:"",factorId:"",factorName:"",factorCode:"",unit:"",emissions:"",approvedTime:"",approvedYear:"",remark:""}},setEmptyItem:function(e){var t=(e.approvedYear||"").toString();return{id:e.id||"",psName:e.psName||"",psId:e.psId||"",portId:e.portId||"",factorId:e.factorId||"",factorName:e.factorName||"",factorCode:e.factorCode||"",unit:e.unit||"",emissions:e.emissions||"",approvedTime:e.approvedTime||"",approvedYear:t,remark:e.remark||""}}}},m=c,p=i("2877"),u=Object(p["a"])(m,o,a,!1,null,null,null);t["default"]=u.exports},"9b4e":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-tooltip",{attrs:{effect:"dark",placement:"top-start",disabled:e.labelModel.length<9,content:e.labelModel}},[i("el-input",{staticClass:"z-pointer",attrs:{readonly:"",size:e.size},model:{value:e.labelModel,callback:function(t){e.labelModel=t},expression:"labelModel"}},[i("el-button",{attrs:{slot:"append",size:e.size},on:{click:function(t){return e.openDialog()}},slot:"append"},[i("i",{staticClass:"fas fa-th-list"})])],1)],1),i("dialog-modal",{ref:"dialog",attrs:{title:e.title,"append-to-body":"",scrollbar:""},on:{close:e.closeDialog}},[i("el-form",{attrs:{inline:"",model:e.queryForm}},[i("el-form-item",{attrs:{label:"企业名称："}},[i("el-input",{attrs:{clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getItemList()}},model:{value:e.queryForm.psName,callback:function(t){e.$set(e.queryForm,"psName",t)},expression:"queryForm.psName"}})],1),i("el-form-item",{attrs:{label:"行政区域："}},[i("select-tree",{staticStyle:{width:"130px"},attrs:{lazy:"",joint:"",rootKey:"0",url:"sys/area",props:{label:"areaName"}},model:{value:e.queryForm.regionCodeId,callback:function(t){e.$set(e.queryForm,"regionCodeId",t)},expression:"queryForm.regionCodeId"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"fas fa-search"},on:{click:e.getItemList}},[e._v("查 询")])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",height:"calc(70vh - 115px)","highlight-current-row":"",data:e.itemList}},[i("el-table-column",{attrs:{align:"center",label:"No.",width:"50",type:"index",index:e.index}}),i("el-table-column",{attrs:{align:"center",label:"操作",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:function(i){return e.onClickCheck(t.row)}}},[e._v("确认")])]}}])}),i("el-table-column",{attrs:{property:"psName",label:"企业名称","min-width":"180","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{property:"psShortName",label:"企业简称","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{property:"regionName",label:"行政区域","show-overflow-tooltip":""}})],1),i("paging-query",{attrs:{pager:e.pager},on:{query:e.getItemList}})],1)],1)},a=[],r=(i("8e6e"),i("ac6a"),i("456d"),i("bd86")),s=i("2f62"),l=i("0069");function n(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function d(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?n(i,!0).forEach((function(t){Object(r["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var c={name:"SelectTable",model:{prop:"value",event:"selected"},props:{value:String,label:String,url:{type:String,required:!1,default:"bas/psBaseInfo"},size:{type:String,required:!1,default:"mini"},title:{type:String,required:!1,default:"选择企业"}},data:function(){return{loading:!1,valueModel:"",labelModel:"",queryForm:{psName:"",psType:1,industryTypeCodeId:"",regionCodeId:"",attentionDegree:-1,psBaseInfoType:-1,sort:"psName"},itemList:[],pager:{page:1,rows:15,count:0}}},watch:{label:{handler:function(e){this.labelModel=this.value?e:""},deep:!0,immediate:!0}},computed:d({},Object(s["c"])("auth",["userType","orgGuid"])),created:function(){"ent"===this.userType&&this.$set(this.queryForm,"psId",this.orgGuid)},methods:{index:function(e){return(this.pager.page-1)*this.pager.rows+e+1},openDialog:function(){this.getItemList(),this.$refs.dialog.openDialog()},closeDialog:function(){this.$refs.dialog.closeDialog()},getItemList:function(){var e=this;this.loading=!0;var t=this.pager,i=t.page,o=t.rows;this.$http.get(this.url,{params:d({page:i,rows:o},this.queryForm)}).then((function(t){t.data.success?(e.itemList=t.data.data,e.pager.count=t.data.count):e.$message.warning({message:t.data.msg,duration:3e3,showClose:!0})}),(function(e){var t=e.response;Object(l["a"])(t)})).finally((function(){e.loading=!1}))},onClickCheck:function(e){this.$emit("selected",e.psId),this.labelModel=e.psName,this.$emit("change",e.psName),this.closeDialog()}}},m=c,p=i("2877"),u=Object(p["a"])(m,o,a,!1,null,null,null);t["a"]=u.exports}}]);