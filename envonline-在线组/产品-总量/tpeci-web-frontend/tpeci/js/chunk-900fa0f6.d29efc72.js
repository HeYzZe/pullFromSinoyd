(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-900fa0f6","chunk-2d0a441a"],{"0653":function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("dialog-modal",{ref:"dialog",attrs:{type:"title",size:"mini",maxScrollbar:"",title:(e.itemModel.id?"编辑":"新增")+"配置方案"},on:{close:e.closeDialog}},[o("el-form",{ref:"form",staticClass:"mar-t-xs pad-x-sm item-space el-box",attrs:{rules:e.rules,"label-width":"100px",model:e.itemModel}},[o("el-form-item",{attrs:{label:"方案名称：",prop:"schemeName","hint-down":""}},[o("el-input",{attrs:{clearable:""},model:{value:e.itemModel.schemeName,callback:function(t){e.$set(e.itemModel,"schemeName",t)},expression:"itemModel.schemeName"}})],1),o("el-form-item",{attrs:{label:"方案编号：",prop:"schemeCode"}},[o("el-input",{attrs:{clearable:""},model:{value:e.itemModel.schemeCode,callback:function(t){e.$set(e.itemModel,"schemeCode",t)},expression:"itemModel.schemeCode"}})],1),o("el-form-item",{attrs:{label:"备注：",prop:"remark"}},[o("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.itemModel.remark,callback:function(t){e.$set(e.itemModel,"remark",t)},expression:"itemModel.remark"}})],1)],1),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary",icon:"fas fa-save",loading:e.saveLoading},on:{click:function(t){return e.onSaveCheck(e.saveCallback)}}},[e._v("保 存\n    ")]),o("el-button",{attrs:{icon:"fas fa-times"},on:{click:function(t){return e.$refs.dialog.closeDialog()}}},[e._v("关 闭\n    ")])],1)],1)},a=[],i=o("2ef0"),s=o.n(i),n=o("73cb"),l={mixins:[n["d"]],data:function(){return{saveLoading:!1,url:"tpeci/valveScheme",itemModel:{schemeName:"",schemeCode:"",remark:""},rules:{schemeName:[{required:!0,message:"请选择方案名称",trigger:["blur","change"]}],schemeCode:[{required:!0,message:"请输入方案编码",trigger:["blur","change"]}]}}},computed:{isEdit:function(){return this.itemModel.id}},methods:{openDialog:function(e){var t=this,o=e;e&&(o=s.a.cloneDeep(e),this.psName=o.psName||"",this.itemModel=this.setEmptyItem(o)),this.$refs.dialog.openDialog(),this.$nextTick((function(){t.$refs.form.clearValidate()}))},onSaveCheck:function(e){var t=this;this.$refs.form.validate((function(o){o&&t.onSaveItem(e)}))},saveCallback:function(){this.$refs.dialog.closeDialog(),this.$emit("query")},closeDialog:function(){this.itemModel=this.getEmptyItem()},getEmptyItem:function(){return{schemeName:"",schemeCode:"",remark:""}},setEmptyItem:function(e){return{id:e.id||"",schemeName:e.schemeName||"",schemeCode:e.schemeCode||"",remark:e.remark||""}}}},c=l,d=o("2877"),u=Object(d["a"])(c,r,a,!1,null,null,null);t["default"]=u.exports},b5d6:function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-card",[o("template",{slot:"header"},[o("el-form",{attrs:{model:e.queryForm,inline:""}},[o("el-form-item",{attrs:{label:"配置方案名称："}},[o("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"配置方案名称",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onQueryList()}},model:{value:e.queryForm.schemeName,callback:function(t){e.$set(e.queryForm,"schemeName",t)},expression:"queryForm.schemeName"}})],1),o("el-form-item",[o("el-button",{attrs:{type:"primary",icon:"fas fa-search"},on:{click:e.onQueryList}},[e._v("查 询")])],1)],1)],1),e.isShow?o("div",{staticClass:"mar-l-sm mar-y-xs"},[o("el-button",{attrs:{type:"primary",icon:"fas fa-plus"},on:{click:e.onClickAdd}},[e._v("新 增")]),o("el-button",{attrs:{type:"danger",icon:"fas fa-trash-alt",disabled:!e.selectedIds.length},on:{click:function(t){return e.onDeleteItem()}}},[e._v("删 除\n    ")])],1):e._e(),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"","highlight-current-row":"",height:e.isShow?"calc(100% - 69px)":"calc(100% - 31px)",data:e.itemList},on:{"selection-change":e.onChangeSelected}},[e.isShow?o("el-table-column",{attrs:{align:"center",type:"selection",width:"37"}}):e._e(),o("el-table-column",{attrs:{align:"center",label:"No.",width:"50",type:"index",index:e.index}}),o("el-table-column",{attrs:{label:"操作",align:"center",width:e.isShow?127:76},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isShow?o("el-button",{attrs:{type:"primary",icon:"fas fa-pencil-alt"},on:{click:function(o){return e.onClickEdit(t.row)}}},[e._v("编辑")]):e._e(),o("el-button",{attrs:{type:"primary",icon:e.isShow?"fas fa-file-invoice":"fas fa-eye"},on:{click:function(o){return e.onClickConfig(t.row)}}},[e._v("\n          "+e._s(e.isShow?"配置":"查看")+"\n        ")])]}}])}),o("el-table-column",{attrs:{label:"配置方案名称",prop:"schemeName","min-width":"140","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"备注",prop:"remark","min-width":"140","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"方案对应站点",prop:"portNames","min-width":"120","show-overflow-tooltip":""}})],1),o("paging-query",{attrs:{pager:e.pager},on:{query:e.getItemList}}),o("dialog-form",{ref:"dialog",on:{query:e.getItemList}}),o("dialog-config",{ref:"config"})],2)},a=[],i=(o("8e6e"),o("ac6a"),o("456d"),o("bd86")),s=o("2f62"),n=o("73cb"),l=o("0653"),c=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("dialog-modal",{ref:"dialog",attrs:{title:"配置方案详情",scrollbar:"",size:"middle"},on:{close:e.onCloseDialog}},[o("el-tabs",{staticStyle:{margin:"0 -10px"},attrs:{fill:"",type:"border-card"},on:{"tab-click":e.onTabClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[o("el-tab-pane",{attrs:{label:"配置站点列表",name:"first"}},[o("port-list-config",{ref:"first",attrs:{mainrow:e.mainrow}})],1),o("el-tab-pane",{attrs:{label:"总量阈值",name:"second"}},[o("total-threshold",{ref:"second",attrs:{mainrow:e.mainrow}})],1),o("el-tab-pane",{attrs:{label:"浓度阈值",name:"three"}},[o("concentration-threshold",{ref:"three",attrs:{mainrow:e.mainrow}})],1)],1)],1)},d=[],u=(o("7f7f"),o("2ef0")),m=o.n(u),p=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"main-box"},[o("el-form",{staticClass:"mar-x-sm mar-t-xs",attrs:{inline:""}},[o("el-form-item",{attrs:{label:"因子："}},[o("el-input",{staticStyle:{width:"180px"},attrs:{clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onQueryList()}},model:{value:e.queryForm.factorName,callback:function(t){e.$set(e.queryForm,"factorName",t)},expression:"queryForm.factorName"}})],1),o("el-form-item",[o("el-button",{attrs:{type:"primary",icon:"fas fa-search"},on:{click:e.onQueryList}},[e._v("查 询")])],1)],1),e.isShow?o("div",{staticClass:"mar-b-xs mar-l-xs"},[o("el-button",{attrs:{type:"primary",icon:"fas fa-plus"},on:{click:e.onClickAdd}},[e._v("新 增")]),o("el-button",{attrs:{type:"danger",icon:"fas fa-trash-alt",disabled:!e.selectedIds.length},on:{click:function(t){return e.onDeleteItem(e.deleCallback)}}},[e._v("删 除")])],1):e._e(),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"","highlight-current-row":"",height:e.isShow?"calc(86vh - 194px)":"calc(86vh - 160px)",data:e.itemList},on:{"selection-change":e.onChangeSelected}},[e.isShow?o("el-table-column",{attrs:{align:"center",type:"selection",width:"37"}}):e._e(),o("el-table-column",{attrs:{align:"center",label:"No.",width:"50",type:"index"}}),e.isShow?o("el-table-column",{attrs:{align:"center",label:"操作",width:"67"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"primary",icon:"fas fa-pencil-alt"},on:{click:function(o){return e.onClickEdit(t.row)}}},[e._v("编辑")])]}}],null,!1,2843858238)}):e._e(),o("el-table-column",{attrs:{label:"因子名称",prop:"factorName","min-width":"90","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"上限值",prop:"alertUpper","min-width":"80","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"下限值",prop:"alertLow","min-width":"80","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"单位",prop:"unit","min-width":"90","show-overflow-tooltip":""}})],1),o("paging-query",{attrs:{pager:e.pager},on:{query:e.getItemList}}),o("dialog-form",{ref:"dialog",attrs:{mainrow:e.mainrow},on:{query:e.getItemList}})],1)},h=[],f=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("dialog-modal",{ref:"dialog",attrs:{type:"title",size:"mini",maxScrollbar:"","append-to-body":"",title:(e.isEdit?"编辑":"新增")+"浓度阈值"},on:{close:e.closeDialog}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",staticClass:"mar-t-xs pad-x-sm item-space el-box",attrs:{rules:e.rules,"label-width":"100px",model:e.itemModel}},[o("el-form-item",{attrs:{label:"因子名称：",prop:"factorCode","hint-down":""}},[o("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",filterable:""},on:{change:e.getFactorData},model:{value:e.itemModel.factorCode,callback:function(t){e.$set(e.itemModel,"factorCode",t)},expression:"itemModel.factorCode"}},e._l(e.select.factorsList,(function(e,t){return o("el-option",{key:t,attrs:{label:e.factorName,value:e.factorCode}})})),1)],1),o("el-form-item",{attrs:{label:"浓度上限值：",prop:"alertUpper"}},[o("el-input",{attrs:{clearable:""},model:{value:e.itemModel.alertUpper,callback:function(t){e.$set(e.itemModel,"alertUpper",t)},expression:"itemModel.alertUpper"}})],1),o("el-form-item",{attrs:{label:"浓度下限值：",prop:"alertLow"}},[o("el-input",{attrs:{clearable:""},model:{value:e.itemModel.alertLow,callback:function(t){e.$set(e.itemModel,"alertLow",t)},expression:"itemModel.alertLow"}})],1),o("el-form-item",{attrs:{label:"单位：",prop:"unit"}},[o("el-input",{attrs:{disabled:""},model:{value:e.itemModel.unit,callback:function(t){e.$set(e.itemModel,"unit",t)},expression:"itemModel.unit"}})],1)],1),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary",icon:"fas fa-save",loading:e.saveLoading},on:{click:function(t){return e.onSaveCheck(e.saveCallback)}}},[e._v("保 存\n    ")]),o("el-button",{attrs:{icon:"fas fa-times"},on:{click:function(t){return e.$refs.dialog.closeDialog()}}},[e._v("关 闭\n    ")])],1)],1)},g=[],b=o("0069"),y={mixins:[n["d"]],props:{mainrow:{type:Object,required:!0}},data:function(){return{saveLoading:!1,loading:!1,url:"tpeci/valveSchemeDetail",itemModel:{schemeId:"",type:2,factorId:"",factorName:"",unit:"",status:1,factorCode:"",alertUpper:"",alertLow:""},select:{factorsList:[]},rules:{factorCode:[{required:!0,message:"请选择因子名称",trigger:["blur","change"]}],alertUpper:[{required:!0,message:"请输入浓度上限值",trigger:["blur","change"]},{pattern:/(^[-0-9][0-9]*(.[0-9]+)?)$/,message:"请输入数字"}],alertLow:[{required:!0,message:"请输入浓度下限值",trigger:["blur","change"]},{pattern:/(^[-0-9][0-9]*(.[0-9]+)?)$/,message:"请输入数字"}]}}},computed:{isEdit:function(){return this.itemModel.id}},methods:{openDialog:function(e){var t=this;this.$refs.dialog.openDialog(),this.getFactorsList();var o=e;e&&(o=m.a.cloneDeep(e),this.psName=o.psName||"",this.itemModel=this.setEmptyItem(o)),this.itemModel.schemeId=this.mainrow.id||"",this.$nextTick((function(){t.$refs.form.clearValidate(),t.once=!1}))},getFactorsList:function(){var e=this;this.loading=!0,this.$http.get("cfg/factors/",{params:{page:1,rows:1e5,factorsType:1,category:1,sort:"factorName+"}}).then((function(t){200===t.status&&t.data.success&&(e.select.factorsList=t.data.data||[])}),(function(e){var t=e.response;Object(b["a"])(t)})).finally((function(){e.loading=!1}))},getFactorData:function(e){var t=this.select.factorsList.filter((function(t){return t.factorCode===e}))[0]||{};this.$set(this.itemModel,"factorId",t.id||""),this.$set(this.itemModel,"factorName",t.factorName||""),this.$set(this.itemModel,"unit",t.unit||"")},onSaveCheck:function(e){var t=this;+this.itemModel.alertUpper<+this.itemModel.alertLow?this.$message.warning({message:"下限值不能高于上限值",duration:3e3,showClose:!0}):this.$refs.form.validate((function(o){o&&t.onSaveItem(e)}))},saveCallback:function(){this.$refs.dialog.closeDialog(),this.$emit("query")},closeDialog:function(){this.once=!0,this.type="",this.psName="",this.select.factorsList=[],this.itemModel=this.getEmptyItem()},getEmptyItem:function(){return{schemeId:"",type:2,factorId:"",factorName:"",unit:"",status:1,factorCode:"",alertUpper:"",alertLow:""}},setEmptyItem:function(e){return{id:e.id||"",schemeId:e.schemeId||"",type:e.type||2,factorId:e.factorId||"",factorCode:e.factorCode||"",factorName:e.factorName||"",unit:e.unit||"",alertUpper:e.alertUpper||"",alertLow:e.alertLow||"",status:e.status||0}}}},v=y,w=o("2877"),k=Object(w["a"])(v,f,g,!1,null,null,null),x=k.exports;function $(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function C(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?$(o,!0).forEach((function(t){Object(i["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):$(o).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var N={mixins:[n["c"],n["b"]],components:{DialogForm:x},props:{mainrow:{type:Object,required:!0}},data:function(){return{url:"tpeci/valveSchemeDetail",isAuto:!1,loading:!1,isShow:!0,queryForm:{schemeId:"",type:2,status:"",factorName:"",sort:"modifyDate-,factorName"},itemList:[]}},computed:C({},Object(s["c"])("auth",["userType","orgGuid"])),created:function(){"ent"===this.userType&&(this.isShow=!1)},methods:{openDialog:function(){this.queryForm.schemeId=this.mainrow.id,this.onQueryList()},onClickAdd:function(){this.$refs.dialog.openDialog()},onClickEdit:function(e){this.$refs.dialog.openDialog(e)},deleCallback:function(){this.getItemList()},closeDialog:function(){this.selectedIds=[],this.queryForm={schemeId:"",type:2,status:"",factorName:"",sort:"modifyDate-,factorName"},this.itemList=[]}}},D=N,I=Object(w["a"])(D,p,h,!1,null,"a51867d8",null),O=I.exports,M=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"main-box"},[o("el-form",{staticClass:"mar-x-sm mar-t-xs",attrs:{inline:""}},[o("el-form-item",{attrs:{label:"阈值模式：",prop:"thresholdMode"}},[o("el-select",{staticStyle:{width:"90px"},attrs:{clearable:""},model:{value:e.queryForm.thresholdMode,callback:function(t){e.$set(e.queryForm,"thresholdMode",t)},expression:"queryForm.thresholdMode"}},[o("el-option",{attrs:{label:"全部",value:""}}),e._l(e.$enum.get("THRESHOLD_MODE"),(function(e,t){return o("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],2)],1),o("el-form-item",[o("el-button",{attrs:{type:"primary",icon:"fas fa-search"},on:{click:e.onQueryList}},[e._v("查 询")])],1)],1),e.isShow?o("div",{staticClass:"mar-b-xs mar-l-xs"},[o("el-button",{attrs:{type:"primary",icon:"fas fa-plus"},on:{click:e.onClickAdd}},[e._v("新 增")]),o("el-button",{attrs:{type:"danger",icon:"fas fa-trash-alt",disabled:!e.selectedIds.length},on:{click:function(t){return e.onDeleteItem(e.deleCallback)}}},[e._v("删 除")])],1):e._e(),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"","highlight-current-row":"",height:e.isShow?"calc(86vh - 194px)":"calc(86vh - 160px)",data:e.itemList},on:{"selection-change":e.onChangeSelected}},[e.isShow?o("el-table-column",{attrs:{align:"center",type:"selection",width:"37"}}):e._e(),o("el-table-column",{attrs:{align:"center",label:"No.",width:"50",type:"index"}}),e.isShow?o("el-table-column",{attrs:{align:"center",label:"操作",width:"67"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"primary",icon:"fas fa-pencil-alt"},on:{click:function(o){return e.onClickEdit(t.row)}}},[e._v("编辑")])]}}],null,!1,2843858238)}):e._e(),o("el-table-column",{attrs:{label:"阈值模式",prop:"thresholdMode",align:"center","min-width":"90","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[e._v("\n        "+e._s(e.$enum.getLabel("THRESHOLD_MODE",+o.thresholdMode))+"\n      ")]}}])}),o("el-table-column",{attrs:{label:"因子名称",prop:"factorName","min-width":"90","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"排放量阈预警值",prop:"warnAlertUpper","min-width":"120","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"排放量阈报警值",prop:"alertUpper","min-width":"120","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"单位",prop:"unit","min-width":"90","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"更新时间",prop:"modifyDate","min-width":"155","show-overflow-tooltip":""}})],1),o("paging-query",{attrs:{pager:e.pager},on:{query:e.getItemList}}),o("dialog-form",{ref:"dialog",attrs:{mainrow:e.mainrow},on:{query:e.getItemList}})],1)},L=[],S=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("dialog-modal",{ref:"dialog",attrs:{type:"title",size:"mini",maxScrollbar:"","append-to-body":"",title:(e.isEdit?"编辑":"新增")+"总量阈值"},on:{close:e.closeDialog}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",staticClass:"mar-t-xs pad-x-sm item-space el-box",attrs:{rules:e.rules,"label-width":"130px",model:e.itemModel}},[o("el-form-item",{attrs:{label:"阈值模式：",prop:"thresholdMode","hint-down":""}},[o("el-select",{staticStyle:{width:"100%"},attrs:{clearable:""},model:{value:e.itemModel.thresholdMode,callback:function(t){e.$set(e.itemModel,"thresholdMode",t)},expression:"itemModel.thresholdMode"}},e._l(e.$enum.get("THRESHOLD_MODE"),(function(e,t){return o("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),o("el-form-item",{attrs:{label:"因子名称：",prop:"factorCode"}},[o("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",clearable:""},on:{change:e.getFactorData},model:{value:e.itemModel.factorCode,callback:function(t){e.$set(e.itemModel,"factorCode",t)},expression:"itemModel.factorCode"}},e._l(e.select.factorsList,(function(e,t){return o("el-option",{key:t,attrs:{label:e.factorName,value:e.factorCode}})})),1)],1),o("el-form-item",{attrs:{label:"排放量阈报警值：",prop:"alertUpper"}},[o("el-input",{attrs:{clearable:""},model:{value:e.itemModel.alertUpper,callback:function(t){e.$set(e.itemModel,"alertUpper",t)},expression:"itemModel.alertUpper"}})],1),o("el-form-item",{attrs:{label:"排放量阈预警值：",prop:"warnAlertUpper"}},[o("el-input",{attrs:{clearable:""},model:{value:e.itemModel.warnAlertUpper,callback:function(t){e.$set(e.itemModel,"warnAlertUpper",t)},expression:"itemModel.warnAlertUpper"}})],1),o("el-form-item",{attrs:{label:"单位：",prop:"unit"}},[o("el-input",{attrs:{disabled:""},model:{value:e.itemModel.unit,callback:function(t){e.$set(e.itemModel,"unit",t)},expression:"itemModel.unit"}})],1)],1),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary",icon:"fas fa-save",loading:e.saveLoading},on:{click:function(t){return e.onSaveCheck(e.saveCallback)}}},[e._v("保 存\n    ")]),o("el-button",{attrs:{icon:"fas fa-times"},on:{click:function(t){return e.$refs.dialog.closeDialog()}}},[e._v("关 闭\n    ")])],1)],1)},q=[],j=(o("6b54"),{mixins:[n["d"]],components:{},props:{mainrow:{type:Object,required:!0}},data:function(){return{saveLoading:!1,loading:!1,once:!0,url:"tpeci/valveSchemeDetail",type:"",itemModel:{schemeId:"",type:1,thresholdMode:"",beginDate:"",endDate:"",factorId:"",factorCode:"",factorName:"",thresholdYear:"",alertUpper:"",warnAlertUpper:"",unit:"",status:1},select:{factorsList:[]},rules:{thresholdMode:[{required:!0,message:"请选择阈值模式",trigger:["blur","change"]}],factorCode:[{required:!0,message:"请选择因子名称",trigger:["blur","change"]}],alertUpper:[{required:!0,message:"请输入排放量阈报警值",trigger:["blur","change"]},{pattern:/(^[-0-9][0-9]*(.[0-9]+)?)$/,message:"请输入数字"}],warnAlertUpper:[{required:!0,message:"请输入排放量阈预警值",trigger:["blur","change"]},{pattern:/(^[-0-9][0-9]*(.[0-9]+)?)$/,message:"请输入数字"}]}}},computed:{isEdit:function(){return this.itemModel.id}},watch:{},methods:{openDialog:function(e){var t=this;this.$refs.dialog.openDialog(),this.getFactorsList();var o=e;e&&(o=m.a.cloneDeep(e),this.psName=o.psName||"",this.itemModel=this.setEmptyItem(o)),this.itemModel.schemeId=this.mainrow.id||"",this.$nextTick((function(){t.$refs.form.clearValidate(),t.once=!1}))},getFactorsList:function(){var e=this;this.loading=!0,this.$http.get("cfg/factors/",{params:{page:1,rows:1e5,factorsType:1,category:1,sort:"factorName+"}}).then((function(t){200===t.status&&t.data.success&&(e.select.factorsList=t.data.data||[])}),(function(e){var t=e.response;Object(b["a"])(t)})).finally((function(){e.loading=!1}))},getFactorData:function(e){var t=this.select.factorsList.filter((function(t){return t.factorCode===e}))[0]||{};this.$set(this.itemModel,"factorId",t.id||""),this.$set(this.itemModel,"factorName",t.factorName||""),this.$set(this.itemModel,"unit",t.unitCou||"")},onSaveCheck:function(e){var t=this;this.$refs.form.validate((function(o){o&&t.onSaveItem(e)}))},saveCallback:function(){this.$refs.dialog.closeDialog(),this.$emit("query")},closeDialog:function(){this.once=!0,this.type="",this.psName="",this.select.factorsList=[],this.itemModel=this.getEmptyItem()},getEmptyItem:function(){return{schemeId:"",type:1,thresholdMode:"",beginDate:"",endDate:"",factorId:"",factorCode:"",factorName:"",thresholdYear:"",alertUpper:"",warnAlertUpper:"",unit:"",status:1}},setEmptyItem:function(e){var t=(e.thresholdYear||"").toString();return{id:e.id||"",type:e.type||1,thresholdMode:e.thresholdMode||"",beginDate:e.beginDate||"",endDate:e.endDate||"",factorId:e.factorId||"",factorCode:e.factorCode||"",factorName:e.factorName||"",thresholdYear:t,alertUpper:e.alertUpper||"",warnAlertUpper:e.warnAlertUpper||"",unit:e.unit||"",status:e.status||0}}}}),_=j,P=Object(w["a"])(_,S,q,!1,null,null,null),E=P.exports;function F(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function T(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?F(o,!0).forEach((function(t){Object(i["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):F(o).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var U={mixins:[n["c"],n["b"]],components:{DialogForm:E},props:{mainrow:{type:Object,required:!0}},data:function(){return{url:"tpeci/valveSchemeDetail",isAuto:!1,loading:!1,isShow:!0,queryForm:{schemeId:"",thresholdYear:"",thresholdMode:"",status:"",type:1,factorName:"",sort:"modifyDate-,thresholdMode+,factorName"},itemList:[]}},computed:T({},Object(s["c"])("auth",["userType","orgGuid"])),created:function(){"ent"===this.userType&&(this.isShow=!1)},methods:{openDialog:function(){this.queryForm.schemeId=this.mainrow.id,this.onQueryList()},onClickAdd:function(){this.$refs.dialog.openDialog()},onClickEdit:function(e){this.$refs.dialog.openDialog(e)},onChangeCheck:function(e){e&&(this.queryForm.portIds=[])},openTransfer:function(){this.$refs.port.openDialog(this.queryPortForm.portIds)},getPortIdsList:function(e){this.queryForm.portIds=e||[],this.onQueryList()},deleCallback:function(){this.getItemList()},closeDialog:function(){this.selectedIds=[],this.queryForm={schemeId:"",thresholdYear:"",thresholdMode:"",status:"",type:1,factorName:"",sort:"modifyDate-,thresholdMode+,factorName"},this.itemList=[]}}},A=U,Q=Object(w["a"])(A,M,L,!1,null,"1a0a6e9a",null),z=Q.exports,H=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"main-box"},[o("el-form",{staticClass:"mar-x-sm mar-t-xs",attrs:{inline:""}},[o("el-form-item",{attrs:{label:"关键字："}},[o("el-input",{staticStyle:{width:"220px"},attrs:{clearable:"",placeholder:"请输入企业名称、站点名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onQueryList()}},model:{value:e.queryForm.key,callback:function(t){e.$set(e.queryForm,"key",t)},expression:"queryForm.key"}})],1),e.isShow?o("el-form-item",[o("el-button",{staticClass:"mar-l-xs",attrs:{type:"primary",icon:"fas fa-map"},on:{click:e.openTransfer}},[e._v("配置站点")])],1):e._e(),o("el-form-item",[o("el-button",{attrs:{type:"primary",icon:"fas fa-search"},on:{click:e.onQueryList}},[e._v("查 询")])],1)],1),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"","highlight-current-row":"",height:"calc(86vh - 161px)",data:e.itemList}},[o("el-table-column",{attrs:{align:"center",label:"No.",width:"50",type:"index",index:e.index}}),o("el-table-column",{attrs:{label:"企业名称",prop:"psName","min-width":"150","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"站点名称",prop:"portName","min-width":"150","show-overflow-tooltip":""}})],1),o("paging-query",{attrs:{pager:e.pager},on:{query:e.getItemList}}),o("Transfer-port",{ref:"port",on:{getQueryData:e.getPortIdsList}})],1)},B=[],G=(o("6762"),o("2fdb"),o("bc49"));function Y(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function R(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Y(o,!0).forEach((function(t){Object(i["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Y(o).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var W={mixins:[n["c"],n["b"]],components:{TransferPort:G["a"]},props:{mainrow:{type:Object,required:!0}},data:function(){return{url:"",isAuto:!1,loading:!1,isShow:!0,queryForm:{psId:"",schemeId:"",key:"",sort:"psName+,portName"},select:{portList:[]},itemList:[],portIds:[],bindPortIds:[]}},computed:R({},Object(s["c"])("auth",["userType","orgGuid"])),created:function(){"ent"===this.userType&&(this.isShow=!1,this.$set(this.queryForm,"psId",this.orgGuid))},methods:{openDialog:function(){this.queryForm.schemeId=this.mainrow.id,this.getPortList()},onClickAdd:function(){this.$refs.dialog.openDialog()},onClickEdit:function(e){this.$refs.dialog.openDialog(e)},openTransfer:function(){this.$refs.port.openDialog(this.portIds)},getPortIdsList:function(e){var t=this,o=this.select.portList.map((function(e){return{regionCodeId:e.regionCodeId,regionName:e.regionName,psId:e.psId,psName:e.psName,portId:e.id,portName:e.portName,schemeId:t.mainrow.id,isSend:0}})).filter((function(t){return e.includes(t.portId)}));this.isBindThreshold(o)},getItemList:function(){var e=this;this.loading=!0;var t=this.pager,o=t.page,r=t.rows;this.$http.get("tpeci/valveScheme2Port",{params:R({page:o,rows:r},this.queryForm)}).then((function(t){200===t.status&&t.data.success?(e.itemList=t.data.data||[],e.portIds=e.itemList.map((function(e){return e.portId})),e.pager.count=t.data.count):e.$message.warning({message:t.data.msg,duration:3e3,showClose:!0})}),(function(e){var t=e.response;Object(b["a"])(t)})).finally((function(){e.loading=!1}))},getPortList:function(){var e=this;this.loading=!0,this.select.portList=[],this.$http.get("bas/portInfo/queryAuthority",{params:{page:1,rows:1e6,childPortType:5,portType:1,sort:"psName-,portName"}}).then((function(t){200===t.status&&t.data.success?(e.select.portList=t.data.data||[],e.onQueryList()):(e.loading=!1,e.$message.warning({message:t.data.msg,duration:3e3,showClose:!0}))}),(function(t){var o=t.response;e.loading=!1,Object(b["a"])(o)}))},isBindThreshold:function(e){var t=this;this.$http.post("tpeci/valveScheme2Port/1",{schemeId:this.mainrow.id,valveScheme2PortList:e}).then((function(o){if(200===o.status&&o.data.success){t.bindPortIds=o.data.data||[];var r=t.bindPortIds.map((function(e){return e.portName})).join(",");t.bindPortIds.length?t.$confirm("站点".concat(r,"已经绑定了其他方案,是否更换此新方案?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.updateBindPort(e)})):t.updateBindPort(e)}else t.$message.warning({message:o.data.msg,duration:3e3,showClose:!0})}),(function(e){var t=e.response;Object(b["a"])(t)}))},updateBindPort:function(e){var t=this;this.$http.post("tpeci/valveScheme2Port/0",{schemeId:this.mainrow.id,valveScheme2PortList:e}).then((function(e){200===e.status&&e.data.success?t.getItemList():(t.loading=!1,t.$message.warning({message:e.data.msg,duration:3e3,showClose:!0}))}),(function(e){var t=e.response;Object(b["a"])(t)}))},closeDialog:function(){this.selectedIds=[],this.itemList=[],this.portIds=[],this.select={portList:[]},this.queryForm={schemeId:"",key:"",sort:"psName+,portName"}}}},V=W,J=Object(w["a"])(V,H,B,!1,null,"820929ee",null),K=J.exports,X={components:{ConcentrationThreshold:O,TotalThreshold:z,PortListConfig:K},data:function(){return{activeName:"first",mainrow:{}}},methods:{openDialog:function(e){var t=this;this.$refs.dialog.openDialog(),this.mainrow=m.a.cloneDeep(e),this.$nextTick((function(){t.$refs.first.openDialog()}))},onTabClick:function(e){this.$refs[e.name].openDialog()},onCloseDialog:function(){this.activeName="first",this.$refs.first.closeDialog(),this.$refs.second.closeDialog(),this.$refs.three.closeDialog(),this.$refs.dialog.closeDialog()}}},Z=X,ee=Object(w["a"])(Z,c,d,!1,null,"f8c00314",null),te=ee.exports;function oe(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function re(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?oe(o,!0).forEach((function(t){Object(i["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):oe(o).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var ae={name:"SewageThreshold",mixins:[n["c"],n["b"]],components:{DialogForm:l["default"],DialogConfig:te},data:function(){return{url:"tpeci/valveScheme",isAuto:!1,isShow:!0,loading:!1,queryForm:{psId:"",schemeName:"",sort:"schemeName"},itemList:[]}},computed:re({},Object(s["c"])("auth",["userType","orgGuid"])),created:function(){"ent"===this.userType&&(this.isShow=!1,this.$set(this.queryForm,"psId",this.orgGuid)),this.onQueryList()},methods:{onClickAdd:function(){this.$refs.dialog.openDialog()},onClickEdit:function(e){this.$refs.dialog.openDialog(e)},onClickConfig:function(e){this.$refs.config.openDialog(e)}}},ie=ae,se=Object(w["a"])(ie,r,a,!1,null,"3b3eab59",null);t["default"]=se.exports},bc49:function(e,t,o){"use strict";var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("dialog-modal",{ref:"dialog",attrs:{title:"站点选择","append-to-body":""}},[o("div",{staticClass:"mar-l-sm mar-y-xs"},[o("el-form",{attrs:{inline:"",model:e.queryForm}},[o("el-form-item",{attrs:{label:"所属区域："}},[o("area-select",{attrs:{placeholder:"请选择",label:e.queryForm.regionName},on:{setLabel:e.setLabel},model:{value:e.queryForm.regionCodeId,callback:function(t){e.$set(e.queryForm,"regionCodeId",t)},expression:"queryForm.regionCodeId"}})],1),o("el-form-item",{staticStyle:{float:"right"}},[o("el-button",{attrs:{type:"primary",icon:"fas fa-check"},on:{click:e.onClickCheck}},[e._v("确 定")])],1)],1)],1),o("el-transfer",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{height:"400px"},attrs:{filterable:"",titles:["待选","已选"],data:e.portList,props:{key:"id",label:"portName"}},model:{value:e.queryForm.portIds,callback:function(t){e.$set(e.queryForm,"portIds",t)},expression:"queryForm.portIds"}}),o("div",{staticClass:"pad-b-xs"})],1)},a=[],i=o("75fc"),s=o("0069"),n=o("c90e"),l={name:"TransferPort",components:{AreaSelect:n["a"]},props:{psName:{type:String,default:""}},data:function(){return{loading:!1,queryForm:{regionCodeId:"",regionName:"",portIds:[]},portList:[]}},computed:{},created:function(){},watch:{"queryForm.regionCodeId":function(e,t){this.getPortList()}},methods:{getPortList:function(){var e=this;this.loading=!0,this.$http.get("bas/portInfo/queryAuthority",{params:{page:1,rows:1e5,childPortType:5,portType:1,psName:"",portName:"",sort:"psName+,portName",regionCodeId:this.queryForm.regionCodeId}}).then((function(t){t.data.success?e.portList=t.data.data||[]:e.$message({type:"warning",message:t.data.msg,duration:3e3,showClose:!0})}),(function(e){Object(s["a"])(e)})).finally((function(){e.loading=!1}))},openDialog:function(e){this.$set(this.queryForm,"portIds",e),this.$refs.dialog.openDialog(),this.getPortList()},closeDialog:function(){this.$refs.dialog.closeDialog()},onClickCheck:function(){this.$emit("getQueryData",Object(i["a"])(this.queryForm.portIds)),this.closeDialog()},setLabel:function(e){this.queryForm.regionName=e}}},c=l,d=o("2877"),u=Object(d["a"])(c,r,a,!1,null,"674d4c0c",null);t["a"]=u.exports},c90e:function(e,t,o){"use strict";var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-popover",{ref:"popover",attrs:{placement:"bottom-start",trigger:"click"},on:{show:e.onShowMenu,hide:e.onHideMenu}},[o("el-tree",{ref:"tree",staticClass:"mod-select-tree",style:"min-width: "+e.treeWidth+";max-height:300px;overflow:auto",attrs:{"highlight-current":"",lazy:"",load:e.onLoadNodes,data:e.data,props:e.props,"expand-on-click-node":!1,"filter-node-method":e.filterNode,"default-expand-all":!1},on:{"node-click":e.onClickNode,"node-expand":e.onExtendNode}}),o("template",{slot:"reference"},[o("el-tooltip",{attrs:{effect:"dark",placement:"top-start",disabled:e.labelModel.length<9,content:e.labelModel}},[o("el-input",{ref:"input",class:{rotate:e.showStatus,"z-pointer":1},style:"width: "+e.width+"px",attrs:{clearable:"","suffix-icon":"el-icon-arrow-down",placeholder:e.placeholder||""},on:{"!clear":function(t){return e.onShrinkNode(t)}},model:{value:e.labelModel,callback:function(t){e.labelModel=t},expression:"labelModel"}})],1)],1)],2)},a=[],i=(o("ac6a"),o("c5f6"),{name:"SelectTreeLazy",model:{prop:"value",event:"selected"},props:{value:[Number,String],label:String,width:String,placeholder:String,props:{type:Object,required:!1,default:function(){return{parent:"parentId",value:"rowGuid",label:"areaName",children:"children"}}}},watch:{label:function(e){this.labelModel=e},labelModel:function(e){e||(this.valueModel="",this.$emit("setLabel",e)),this.$refs.tree.filter(e)}},data:function(){return{showStatus:!1,treeWidth:"auto",labelModel:"",valueModel:"",data:[]}},created:function(){var e=this;this.labelModel=this.label||"",this.valueModel=this.value||"",this.$nextTick((function(){e.treeWidth="".concat((e.width||e.$refs.input.$refs.input.clientWidth)-24,"px")}))},methods:{onClickNode:function(e){var t=this;this.labelModel=e[this.props.label],this.valueModel=e[this.props.value],this.$refs.popover.showPopper=!1,this.$nextTick((function(){t.$emit("setLabel",t.labelModel)}))},onShowMenu:function(){this.showStatus=!0,this.$refs.tree.filter(!1)},onHideMenu:function(){this.showStatus=!1,this.$emit("selected",this.valueModel)},onExtendNode:function(e,t,o){this.$set(o,"expanded",!o.expanded)},onShrinkNode:function(){var e=this;this.$emit("selected","");var t=this.$refs.tree;this.showStatus=!1,this.$nextTick((function(){e.$refs.popover.showPopper=!1})),t.$children.forEach((function(t){e.$set(t,"expanded",!1)}))},filterNode:function(e,t){return!e||-1!==t[this.props.label].indexOf(e)},onLoadNodes:function(e,t){this.getNodeList(e.data[this.props.value]).then((function(e){return t(e)}))},getNodeList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0";return new Promise((function(o){e.$http.get("sys/area/".concat(t)).then((function(e){o(e.data||[])}),(function(t){e.$hp.resp(t)}))}))}}}),s=i,n=o("2877"),l=Object(n["a"])(s,r,a,!1,null,null,null);t["a"]=l.exports}}]);