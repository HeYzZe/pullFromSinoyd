(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d21e5c5"],{d4dc:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticClass:"title-card",attrs:{type:"title"}},[a("el-form",{staticClass:"mar-t-xs mar-l-xs fn-no-wrap",attrs:{inline:"",model:e.queryForm}},[a("el-form-item",{attrs:{label:"配置名称："}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入配置名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onQueryList(t)}},model:{value:e.queryForm.configName,callback:function(t){e.$set(e.queryForm,"configName",t)},expression:"queryForm.configName"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"fas fa-search"},on:{click:e.onQueryList}},[e._v("查 询")])],1)],1),a("hr"),a("div",{staticClass:"mar-l-sm mar-y-xs"},[a("el-button",{attrs:{type:"primary",icon:"fas fa-plus"},on:{click:e.onClickAdd}},[e._v("新 增")]),a("el-button",{attrs:{type:"danger",icon:"fas fa-trash-alt",disabled:!e.selectedIds.length},on:{click:e.onDelItem}},[e._v("删 除\n    ")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",height:"calc(100% - 73px)",data:e.itemList,"highlight-current-row":"","row-class-name":e._rowClassName},on:{"selection-change":e.changeSelected}},[a("el-table-column",{attrs:{align:"center",type:"selection",width:"37"}}),a("el-table-column",{attrs:{align:"center",label:"No.",type:"index",width:"50",index:e.index}}),a("el-table-column",{attrs:{align:"center",prop:"waterStorageStatus","min-width":"69px",label:"操作","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",icon:"fas fa-file-invoice"},on:{click:function(a){return e.onClickEdit(t.row.id)}}},[e._v("\n          编辑\n        ")])]}}])}),a("el-table-column",{attrs:{property:"configName",label:"配置名称","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{property:"alarmTypeName",label:"报警类型","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{align:"center",label:"每日发送时间","show-overflow-tooltip":""}},[a("el-table-column",{attrs:{property:"beginTime",label:"开始时间","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{property:"endTime",label:"结束时间","show-overflow-tooltip":""}})],1),a("el-table-column",{attrs:{property:"sendTimeSpan",label:"发送时间间隔(分)","min-width":"100","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{property:"sendFrequency",label:"最大发送次数","show-overflow-tooltip":""}})],1),a("paging-query",{attrs:{pager:e.pager},on:{query:e.getItemList}}),a("dialog-modal",{ref:"dialog",attrs:{title:"发送方案配置","before-close":e.beforeClose,size:"mini"}},[a("el-form",{ref:"form",staticClass:"item-space pad-x-sm",attrs:{rules:e.rules,model:e.configForm,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"配置名称：",prop:"configName"}},[a("el-input",{model:{value:e.configForm.configName,callback:function(t){e.$set(e.configForm,"configName",t)},expression:"configForm.configName"}})],1),a("el-form-item",{attrs:{label:"报警类型：",prop:"alarmTypes"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:""},model:{value:e.alarmTypes,callback:function(t){e.alarmTypes=t},expression:"alarmTypes"}},e._l(e.alarmTypeList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.alarmTypeName,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"每日发送时间：",prop:"date"}},[a("el-time-picker",{staticStyle:{width:"100%"},attrs:{"is-range":"","arrow-control":"","value-format":"HH:mm","picker-options":{format:"HH:mm"},"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",placeholder:"选择时间范围"},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})],1),a("el-form-item",{attrs:{label:"时间间隔：",prop:"sendTimeSpan"}},[a("el-input",{model:{value:e.configForm.sendTimeSpan,callback:function(t){e.$set(e.configForm,"sendTimeSpan",t)},expression:"configForm.sendTimeSpan"}},[a("template",{slot:"append"},[e._v("(min)")])],2)],1),a("el-form-item",{attrs:{label:"发送方式：",prop:"sendTypes"}},[a("el-checkbox-group",{model:{value:e.configForm.sendTypes,callback:function(t){e.$set(e.configForm,"sendTypes",t)},expression:"configForm.sendTypes"}},[a("el-checkbox",{attrs:{label:1}},[e._v("短信")]),a("el-checkbox",{attrs:{label:2}},[e._v("APP")]),a("el-checkbox",{attrs:{label:4}},[e._v("微信")])],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"企业发送："}},[a("el-switch",{model:{value:e.configForm.psIsSend,callback:function(t){e.$set(e.configForm,"psIsSend",t)},expression:"configForm.psIsSend"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"运维单位："}},[a("el-switch",{model:{value:e.configForm.opMainIsSend,callback:function(t){e.$set(e.configForm,"opMainIsSend",t)},expression:"configForm.opMainIsSend"}})],1)],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",icon:"fas fa-save"},on:{click:e.onSaveItem}},[e._v("保 存")]),a("el-button",{attrs:{icon:"fa fa-times"},on:{click:e.beforeClose}},[e._v("关 闭")])],1)],1)],1)},r=[],n=(a("8e6e"),a("ac6a"),a("456d"),a("768b")),s=a("bd86");a("6762"),a("2fdb");function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,o)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(a,!0).forEach((function(t){Object(s["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var c={name:"AlarmSend",data:function(){var e=this.$store.getters["auth/orgGuid"]||"",t=function(e,t,a){!/^\d+$/.test(t)&&t?a(new Error("请输入正整数")):a()};return{loading:!1,queryForm:{psId:e,configName:""},selectedIds:[],pager:{rows:15,page:1,count:0},itemList:[],configForm:{alarmTypes:[],sendTypes:[],beginTime:"",endTime:"",psIsSend:!1,opMainIsSend:!1,sendFrequency:1},date:["",""],alarmTypeList:[],rules:{alarmTypes:[{required:!0,message:"请选择报警类型",trigger:"change"}],configName:[{required:!0,message:"请输入配置名称",trigger:"blur"}],sendTimeSpan:[{validator:t,trigger:["blur","change"]}],sendTypes:[{required:!0,message:"请输入发送方式",trigger:"change"}]}}},created:function(){this.getItemList()},computed:{alarmTypes:{get:function(){return this.configForm.alarmTypes.map((function(e){return e.id}))},set:function(e){this.configForm.alarmTypes=this.alarmTypeList.filter((function(t){return e.includes(t.id)}))}}},methods:{index:function(e){return(this.pager.page-1)*this.pager.rows+e+1},_rowClassName:function(e){var t=e.row,a="selected-row";return this.selectedIds.includes(t.id)?a:""},changeSelected:function(e){this.selectedIds=e.map((function(e){return e.id}))},onQueryList:function(){this.pager.page=1,this.getItemList()},beforeClose:function(){this.$refs.form.resetFields(),this.configForm.beginTime="",this.configForm.endTime="",this.configForm.id="",this.configForm.psIsSend=!1,this.configForm.opMainIsSend=!1,this.date=["",""],this.$refs.dialog.closeDialog()},onClickAdd:function(){0===this.alarmTypeList.length&&this.getAlarmTypeList(),delete this.configForm.id,this.configForm.sendFrequency=1,this.$refs.dialog.openDialog()},onClickEdit:function(e){var t=this;0===this.alarmTypeList.length&&this.getAlarmTypeList(),this.$refs.dialog.openDialog(),this.$http.get("alarm/alarmSendConfig/".concat(e)).then((function(e){e.data.success?(t.configForm=e.data.rows||e.data.data||e.data,t.date=[t.configForm.beginTime||"",t.configForm.endTime||""]):t.$message({type:"warning",message:e.data.msg,duration:3e3,showClose:!0})}),(function(e){t.$hp.resp(e)}))},getAlarmTypeList:function(){var e=this;this.$http.get("alarm/alarmType?page=1&rows=1000000&sort=alarmTypeName%2b,orderNum%2b").then((function(t){t.data.success?e.alarmTypeList=t.data.rows||t.data.data||t.data:e.$message({type:"warning",message:t.data.msg,duration:3e3,showClose:!0})}),(function(t){e.$hp.resp(t)}))},getItemList:function(){var e=this;this.loading=!0;var t=this.pager,a=t.rows,o=t.page;this.$http.get("alarm/alarmSendConfig",{params:l({rows:a,page:o},this.queryForm)}).then((function(t){t.data.success?(e.itemList=t.data.rows||t.data.data||t.data,e.pager.count=t.data.count):e.$message({type:"warning",message:t.data.msg,duration:3e3,showClose:!0})}),(function(t){e.$hp.resp(t)})).finally((function(){e.loading=!1}))},onDelItem:function(){var e=this;this.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return e.$http.delete("alarm/alarmSendConfig",{data:e.selectedIds})})).then((function(t){t.data.success?(e.$message.success({message:"删除成功",duration:3e3,showClose:!0}),e.getItemList()):e.$message.warning({message:t.data.msg,duration:3e3})}),(function(t){e.$hp.resp(t)}))},onSaveItem:function(){var e=this;this.$refs.form.validate((function(t){if(t){e.configForm.sendType=e.configForm.sendTypes.reduce((function(e,t){return e+t}),0);var a=e.date||["",""],o=Object(n["a"])(a,2);e.configForm.beginTime=o[0],e.configForm.endTime=o[1],e.$http[e.configForm.id?"put":"post"]("alarm/alarmSendConfig",l({},e.configForm)).then((function(t){t.data.success?(e.$message({type:"success",message:t.data.msg,duration:3e3,showClose:!0}),e.beforeClose(),e.onQueryList()):e.$message({type:"warning",message:t.data.msg,duration:3e3,showClose:!0})}),(function(t){e.$hp.resp(t)}))}}))}}},m=c,p=a("2877"),d=Object(p["a"])(m,o,r,!1,null,"91bebe7e",null);t["default"]=d.exports}}]);