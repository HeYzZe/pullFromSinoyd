(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e266d094","chunk-2d0c1d15"],{4812:function(e,t,o){},4850:function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("dialog-modal",{ref:"dialog",attrs:{type:"title",size:"mini",maxScrollbar:"",title:"开关阀详情"}},[o("el-form",{ref:"form",staticClass:"item-space pad-a-xs",attrs:{rules:e.formRules,model:e.itemModel,"label-width":"90px"}},[o("el-form-item",{attrs:{label:"站点名称：",prop:"portId","hint-down":""}},[o("el-select",{attrs:{clearable:""},on:{change:e.onChangePort},model:{value:e.itemModel.portId,callback:function(t){e.$set(e.itemModel,"portId",t)},expression:"itemModel.portId"}},e._l(e.portList,(function(e){return o("el-option",{key:e.id,attrs:{value:e.id,label:e.portName}})})),1)],1),o("el-form-item",{attrs:{label:"申报人："}},[o("el-input",{attrs:{readonly:""},model:{value:e.userName,callback:function(t){e.userName=t},expression:"userName"}})],1),o("el-form-item",{attrs:{label:"关阀记录：",prop:"closeRecord"}},[o("el-input",{attrs:{readonly:"",type:"textarea",rows:4},model:{value:e.itemModel.closeRecord,callback:function(t){e.$set(e.itemModel,"closeRecord",t)},expression:"itemModel.closeRecord"}})],1),o("el-form-item",{attrs:{label:"申报时间："}},[o("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.itemModel.applyTime,callback:function(t){e.$set(e.itemModel,"applyTime",t)},expression:"itemModel.applyTime"}})],1),o("el-form-item",{attrs:{label:"申报原因："}},[o("el-input",{attrs:{type:"textarea",rows:4},model:{value:e.itemModel.applyReason,callback:function(t){e.$set(e.itemModel,"applyReason",t)},expression:"itemModel.applyReason"}})],1)],1),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"success",disabled:[1,2,"1","2"].includes(e.itemModel.status),icon:"fas fa-cloud-upload-alt",loading:e.saveLoading},on:{click:function(t){return e.onSaveCheck(1,e.saveCallback)}}},[e._v("提 交\n    ")]),o("el-button",{attrs:{type:"primary",disabled:[1,2,"1","2"].includes(e.itemModel.status),icon:"fas fa-save",loading:e.saveLoading},on:{click:function(t){return e.onSaveCheck(0,e.saveCallback)}}},[e._v("保 存\n    ")]),o("el-button",{attrs:{icon:"fas fa-times"},on:{click:function(t){return e.$refs.dialog.closeDialog()}}},[e._v("关 闭")])],1)],1)},i=[],n=(o("8e6e"),o("ac6a"),o("456d"),o("768b")),l=o("bd86"),s=o("2f62"),r=o("73cb"),c=o("0069"),d=o("4161");function u(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function p(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?u(o,!0).forEach((function(t){Object(l["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):u(o).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var m={mixins:[r["d"]],data:function(){return{url:"tpeci/valveOpenApply",itemModel:{portId:"",applyTime:Object(d["formatDate"])(new Date,"Y-m-d H:i:s"),applyReason:"",closeRecord:"",status:0},portList:[],valveRecord:[],formRules:{portId:[{required:!0,message:"请选择申报排口",trigger:["change","blur"]}],closeRecord:[{required:!0,message:"该排口未查询到关阀记录",trigger:["change"]}]}}},computed:p({},Object(s["c"])("auth",["userName"])),methods:{onChangePort:function(e){if(e){var t=this.portList.filter((function(t){return t.id===e})),o=Object(n["a"])(t,1),a=o[0];this.itemModel.regionCodeId=a.regionCodeId,this.itemModel.regionName=a.regionName,this.itemModel.psId=a.psId,this.itemModel.psName=a.psName,this.itemModel.portName=a.portName,this.getValveList([e])}else this.itemModel.closeRecord=""},openDialog:function(e){var t=this;this.$refs.dialog.openDialog(),this.itemModel=this.setEmptyItem(e),this.getPortList(),this.$nextTick((function(){t.$refs.form.clearValidate()}))},onSaveCheck:function(e,t){var o=this;this.isEmptyObj(this.formRules)?this.onSaveItem(e,t):this.$refs.form.validate((function(a){a&&o.onSaveItem(e,t)}))},getPortList:function(){var e=this;this.$http.get("tpeci/valveOpenApply/getClosedPort").then((function(t){t.data.success&&(e.portList=t.data.data||[])}),(function(e){var t=e.response;Object(c["a"])(t)}))},getValveList:function(e){var t=this;this.$http.post("tpeci/tPECIWaterValveStatus",{isAll:!1,portIds:e,type:["01","02","03","04","05","06","07"],sort:"Tstamp-"},{params:{page:1,rows:1}}).then((function(e){if(e.data.success){var o=e.data.data||[],a=Object(n["a"])(o,1),i=a[0];if(i){var l=i.psName,s=i.portName,r=i.tstamp,c=i.ctypeValue;t.valveRecord=i,t.itemModel.closeRecord="".concat(l," ").concat(s," 阀门从").concat(r).concat(c)}else t.itemModel.closeRecord=""}}),(function(e){var t=e.response;Object(c["a"])(t)}))},onSaveItem:function(e,t){var o=this;t(),this.saveLoading=!0;var a=this.itemModel.id;this.itemModel.status=e,this.$http[a?"put":"post"](this.url,this.itemModel).then((function(e){200===e.status&&e.data.success?(o.$message.success({message:"操作成功",duration:3e3,showClose:!0}),o.itemModel=e.data.data,t?t(e.data.data):o.$emit("query")):(o.$message.warning({message:e.data.msg,duration:3e3,showClose:!0}),o.itemModel.status=0)}),(function(e){var t=e.response;o.itemModel.status=0,Object(c["a"])(t)})).finally((function(){o.saveLoading=!1}))},saveCallback:function(){this.$refs.dialog.closeDialog(),this.$emit("query")},setEmptyItem:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};return e.id&&(t={id:e.id}),p({},t,{regionCodeId:e.regionCodeId||"",regionName:e.regionName||"",psId:e.psId||"",psName:e.psName||"",portId:e.portId||"",portName:e.portName||"",closeRecord:e.closeRecord||"",applyReason:e.applyReason||"",applyTime:e.applyTime||Object(d["formatDate"])(new Date,"Y-m-d H:i:s"),status:e.status||0})}}},f=m,h=o("2877"),g=Object(h["a"])(f,a,i,!1,null,"5a410150",null);t["default"]=g.exports},"514e":function(e,t,o){"use strict";var a=o("4812"),i=o.n(a);i.a},c2cd:function(e,t,o){"use strict";var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("dialog-modal",{ref:"dialog",attrs:{size:"small",scrollbar:"",view:!0,title:"上传附件"},on:{close:e.closeDialog}},[e.isShow?o("div",{staticClass:"mar-b-xs"},[o("el-button",{attrs:{type:"primary",icon:"fas fa-cloud-upload-alt"},on:{click:e.onClickUpload}},[e._v("上 传")]),o("el-button",{attrs:{type:"danger",icon:"fas fa-trash-alt",disabled:!e.selectedIds.length},on:{click:e.onClickDele}},[e._v("删 除\n    ")])],1):e._e(),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{height:e.isShow?"calc(100% - 64px)":"calc(100% - 31px)",data:e.itemList,border:"","highlight-current-row":""},on:{"selection-change":e.onSaveSelected}},[e.isShow?o("el-table-column",{attrs:{align:"center",type:"selection",width:"37"}}):e._e(),o("el-table-column",{attrs:{align:"center",label:"No.",type:"index",width:"50",index:e.index}}),o("el-table-column",{attrs:{align:"center",label:"操作",width:"67"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"primary",icon:"fas fa-pencil-alt"},on:{click:function(o){return e.onClickDown(t.row)}}},[e._v("下载")])]}}])}),o("el-table-column",{attrs:{prop:"docName","min-width":"160","show-overflow-tooltip":"",label:"名称"}}),o("el-table-column",{attrs:{prop:"uploadTime","min-width":"160","show-overflow-tooltip":"",label:"创建时间"}}),o("el-table-column",{attrs:{prop:"authorName","min-width":"120","show-overflow-tooltip":"",label:"作者"}})],1),o("paging-query",{attrs:{pager:e.pager},on:{query:e.getItemList}}),o("upload",{ref:"upload",attrs:{id:e.queryForm.objectId},on:{query:e.getItemList}})],1)},i=[],n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("dialog-modal",{ref:"dialog",attrs:{size:"mini",title:"上传附件",appendToBody:!0},on:{close:e.onCloseDialog}},[o("el-upload",{ref:"addFile",staticClass:"mar-t-xs mar-b-xs",attrs:{multiple:"",action:"","file-list":e.tempList,"auto-upload":!1,"on-change":e.onFileChange,"on-remove":e.handleRemove}},[o("el-button",{attrs:{size:"small"}},[e._v("选择文件")]),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传不超过 10MB 大小的文件, 且每次上传不超过 100MB 大小 ")])],1),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{type:"primary",icon:"fas fa-cloud-upload-alt"},on:{click:e.onClickUpload}},[e._v("上 传\n    ")]),o("el-button",{attrs:{icon:"fas fa-times"},on:{click:function(t){return e.$refs.dialog.closeDialog()}}},[e._v("关 闭")])],1)],1)},l=[],s=(o("5df3"),o("7f7f"),o("ac6a"),{props:{id:{type:String,required:!0}},data:function(){return{loading:!1,tempList:[]}},computed:{filesSize:function(){return this.tempList.map((function(e){return e.size/1024/1024}))},isFileSize:function(){return this.filesSize.every((function(e){return e<10}))},isFilesSize:function(){return this.filesSize.reduce((function(e,t){return e+t}),0)<100}},watch:{},methods:{openDialog:function(){this.$refs.dialog.openDialog()},handleRemove:function(e,t){this.tempList=t},onFileChange:function(e,t){this.tempList=t},beforeUpload:function(){var e=this,t=[];this.tempList.forEach((function(o){var a={param:{},config:{}};a.param=new FormData,a.param.append("file",o.raw,o.name),a.config={params:{objectId:e.id}},t.push(e.onCreateItem(a,o.name))})),this.loading=!0,Promise.all(t).then((function(){e.$message.success("上传成功"),e.$emit("query"),e.$refs.dialog.closeDialog()})).catch((function(t){e.$message.wraning({message:"文件".concat(t.join(","),"上传失败"),showClose:!0,duration:3e3})})).finally((function(){e.loading=!1}))},onCreateItem:function(e,t){var o=this;return new Promise((function(a,i){o.$http.post("res/document/upload",e.param,e.config).then((function(e){e.data.success?a():i(t)}),(function(){i(t)}))}))},onClickUpload:function(){this.tempList.length?this.isFileSize?this.isFilesSize?this.beforeUpload():this.$message.info("上传文件总大小不能超过100MB"):this.$message.info("单个文件大小不能超过10MB"):this.$message.info("请选择需要上传的附件")},onCloseDialog:function(){this.tempList=[]}}}),r=s,c=o("2877"),d=Object(c["a"])(r,n,l,!1,null,"a90fa5d8",null),u=d.exports,p=o("73cb"),m={mixins:[p["c"]],components:{Upload:u},props:{isShow:{type:Boolean}},data:function(){return{url:"res/document",isAuto:!1,loading:!1,itemList:[],queryForm:{objectId:"",sort:"uploadTime-"}}},computed:{},created:function(){},methods:{openDialog:function(e){this.queryForm.objectId=e.id||"",this.getItemList(),this.$refs.dialog.openDialog()},onSaveSelected:function(e){this.selectedIds=e.map((function(e){return e.id}))},onClickUpload:function(){this.$refs.upload.openDialog()},closeDialog:function(){this.queryList={objectId:"",sort:"uploadTime-"},this.itemList=[],this.loading=!1},onClickDele:function(){var e=this;0!==this.selectedIds.length?this.$confirm("是否删除选中的数据？","请确定",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return e.$http.delete("res/document",{data:e.selectedIds})})).then((function(t){t.data.success&&e.getItemList(),e.$message({showClose:!0,message:t.data.success?"删除成功":t.data.msg,type:t.data.success?"success":"error",duration:3e3})})):this.$message("请选择要删除的数据")},onClickDown:function(e){var t=this;this.$http.get("res/document/download?id=".concat(e.id),{responseType:"blob"}).then((function(o){var a="application/json;charset=UTF-8"===o.headers["content-type"];if(a){var i=new FileReader;i.onload=function(e){return t.$message.warning(JSON.parse(e.target.result).msg)},i.readAsText(o.data)}else{var n=e.docName,l=new Blob([o.data],{type:"application/x-xls"});if(window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(l,n);else{var s=document.createElement("a");s.href=window.URL.createObjectURL(l),s.download=n,s.click(),window.URL.revokeObjectURL(s.href)}}}),(function(e){t.$hp.resp(e)})).finally((function(){}))}}},f=m,h=(o("514e"),Object(c["a"])(f,a,i,!1,null,"df2918d4",null));t["a"]=h.exports},c926:function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-card",[o("template",{slot:"header"},[o("el-form",{attrs:{model:e.queryForm,inline:""}},[o("el-form-item",{attrs:{label:"申报时间："}},[o("el-date-picker",{staticStyle:{width:"135px"},attrs:{type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",clearable:!1,editable:!1},model:{value:e.queryForm.fromDate,callback:function(t){e.$set(e.queryForm,"fromDate",t)},expression:"queryForm.fromDate"}}),e._v(" ~\n        "),o("el-date-picker",{staticStyle:{width:"135px"},attrs:{type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",clearable:!1,editable:!1},model:{value:e.queryForm.toDate,callback:function(t){e.$set(e.queryForm,"toDate",t)},expression:"queryForm.toDate"}})],1),o("el-form-item",{attrs:{label:"申报状态："}},[o("el-select",{staticStyle:{width:"90px"},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},[o("el-option",{attrs:{value:"",label:"所有"}}),e._l(e.$enum.get("VALVE_CHECK_STATUS"),(function(e){return o("el-option",{key:e.value,attrs:{value:e.value,label:e.label}})}))],2)],1),o("el-form-item",[o("el-button",{attrs:{type:"primary",icon:"fas fa-search"},on:{click:e.onQueryList}},[e._v("查 询")])],1)],1)],1),o("div",{staticClass:"mar-l-sm mar-y-xs"},[o("el-button",{attrs:{type:"primary",icon:"fas fa-plus"},on:{click:e.onClickAdd}},[e._v("新 增")]),o("el-button",{attrs:{type:"danger",icon:"fas fa-trash-alt",disabled:!e.selectedIds.length},on:{click:function(t){return e.onDeleteItem(e.getItemList)}}},[e._v("删 除\n    ")])],1),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"","highlight-current-row":"",height:"calc(100% - 72px)",data:e.itemList,"row-class-name":e.rowClassName},on:{"selection-change":e.onChangeSelected}},[o("el-table-column",{attrs:{align:"center",type:"selection",width:"37"}}),o("el-table-column",{attrs:{align:"center",label:"No.",width:"50",type:"index",index:e.index}}),o("el-table-column",{attrs:{label:"操作",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"primary",icon:"fas fa-pencil-alt"},on:{click:function(o){return e.onClickEdit(t.row)}}},[e._v("编辑")]),o("el-button",{attrs:{type:"primary",icon:"fas fa-link"},on:{click:function(o){return e.onClickDoc(t.row)}}},[e._v("附件")])]}}])}),o("el-table-column",{attrs:{label:"企业名称",prop:"psName","min-width":"120","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"站点名称",prop:"portName","min-width":"120","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"关阀记录",prop:"closeRecord","min-width":"80","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"申报时间",prop:"applyTime","min-width":"160","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"申报人",prop:"applicantName","min-width":"100","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"申报原因",prop:"applyReason","min-width":"145","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"状态","min-width":"70","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[o("span",[e._v(e._s(e.$enum.getLabel("VALVE_CHECK_STATUS",a.status)))])]}}])}),o("el-table-column",{attrs:{label:"处理意见",prop:"dealRemark","min-width":"145","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"处理时间",prop:"dealTime","min-width":"160","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"当前阀门状态",prop:"currentStatus","min-width":"145","show-overflow-tooltip":""}})],1),o("paging-query",{attrs:{pager:e.pager},on:{query:e.getItemList}}),o("dialog-form",{ref:"dialog",on:{query:e.getItemList}}),o("upload-dialog",{ref:"upload",attrs:{isShow:e.isShow}})],2)},i=[],n=(o("8e6e"),o("456d"),o("6762"),o("2fdb"),o("ac6a"),o("bd86")),l=o("0069"),s=o("73cb"),r=o("c2cd"),c=o("4850"),d=o("90de");function u(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function p(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?u(o,!0).forEach((function(t){Object(n["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):u(o).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var m={name:"ValveOpeningCheckEnt",mixins:[s["c"],s["b"]],components:{dialogForm:c["default"],UploadDialog:r["a"]},data:function(){var e=this.$store.getters["auth/orgGuid"]||"";return{url:"tpeci/valveOpenApply",loading:!1,isShow:!0,queryForm:{psId:e,fromDate:Object(d["b"])(-1,!1,!1),toDate:Object(d["b"])(0,!1,!1),status:"",isManagement:!1,sort:"applyTime-"},itemList:[]}},methods:{onClickAdd:function(){this.openDialog()},onClickEdit:function(e){this.$refs.dialog.openDialog(e)},openDialog:function(){this.$refs.dialog.openDialog()},onClickDoc:function(e){this.isShow=2!==+e.status,this.$refs.upload.openDialog(e)},getItemList:function(){var e=this;this.loading=!0,this.selectedIndexs=[];var t=this.pager,o=t.page,a=t.rows;this.$http.get(this.url,{params:p({page:o,rows:a},this.queryForm)}).then((function(t){200===t.status&&t.data.success?(e.itemList=t.data.data,e.itemList.forEach((function(e){e.dealTime&&e.dealTime.includes("1753")&&(e.dealTime="")})),e.pager.count=t.data.count):e.$message.warning({message:t.data.msg,duration:3e3,showClose:!0})}),(function(e){var t=e.response;Object(l["a"])(t)})).finally((function(){e.loading=!1}))}}},f=m,h=o("2877"),g=Object(h["a"])(f,a,i,!1,null,"49eb50c4",null);t["default"]=g.exports}}]);