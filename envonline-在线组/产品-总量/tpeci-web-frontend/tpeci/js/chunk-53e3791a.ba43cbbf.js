(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-53e3791a"],{"9b4e":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tooltip",{attrs:{effect:"dark",placement:"top-start",disabled:e.labelModel.length<9,content:e.labelModel}},[a("el-input",{staticClass:"z-pointer",attrs:{readonly:"",size:e.size},model:{value:e.labelModel,callback:function(t){e.labelModel=t},expression:"labelModel"}},[a("el-button",{attrs:{slot:"append",size:e.size},on:{click:function(t){return e.openDialog()}},slot:"append"},[a("i",{staticClass:"fas fa-th-list"})])],1)],1),a("dialog-modal",{ref:"dialog",attrs:{title:e.title,"append-to-body":"",scrollbar:""},on:{close:e.closeDialog}},[a("el-form",{attrs:{inline:"",model:e.queryForm}},[a("el-form-item",{attrs:{label:"企业名称："}},[a("el-input",{attrs:{clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getItemList()}},model:{value:e.queryForm.psName,callback:function(t){e.$set(e.queryForm,"psName",t)},expression:"queryForm.psName"}})],1),a("el-form-item",{attrs:{label:"行政区域："}},[a("select-tree",{staticStyle:{width:"130px"},attrs:{lazy:"",joint:"",rootKey:"0",url:"sys/area",props:{label:"areaName"}},model:{value:e.queryForm.regionCodeId,callback:function(t){e.$set(e.queryForm,"regionCodeId",t)},expression:"queryForm.regionCodeId"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"fas fa-search"},on:{click:e.getItemList}},[e._v("查 询")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",height:"calc(70vh - 115px)","highlight-current-row":"",data:e.itemList}},[a("el-table-column",{attrs:{align:"center",label:"No.",width:"50",type:"index",index:e.index}}),a("el-table-column",{attrs:{align:"center",label:"操作",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:function(a){return e.onClickCheck(t.row)}}},[e._v("确认")])]}}])}),a("el-table-column",{attrs:{property:"psName",label:"企业名称","min-width":"180","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{property:"psShortName",label:"企业简称","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{property:"regionName",label:"行政区域","show-overflow-tooltip":""}})],1),a("paging-query",{attrs:{pager:e.pager},on:{query:e.getItemList}})],1)],1)},i=[],l=(a("8e6e"),a("ac6a"),a("456d"),a("bd86")),o=a("2f62"),n=a("0069");function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(a,!0).forEach((function(t){Object(l["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var m={name:"SelectTable",model:{prop:"value",event:"selected"},props:{value:String,label:String,url:{type:String,required:!1,default:"bas/psBaseInfo"},size:{type:String,required:!1,default:"mini"},title:{type:String,required:!1,default:"选择企业"}},data:function(){return{loading:!1,valueModel:"",labelModel:"",queryForm:{psName:"",psType:1,industryTypeCodeId:"",regionCodeId:"",attentionDegree:-1,psBaseInfoType:-1,sort:"psName"},itemList:[],pager:{page:1,rows:15,count:0}}},watch:{label:{handler:function(e){this.labelModel=this.value?e:""},deep:!0,immediate:!0}},computed:p({},Object(o["c"])("auth",["userType","orgGuid"])),created:function(){"ent"===this.userType&&this.$set(this.queryForm,"psId",this.orgGuid)},methods:{index:function(e){return(this.pager.page-1)*this.pager.rows+e+1},openDialog:function(){this.getItemList(),this.$refs.dialog.openDialog()},closeDialog:function(){this.$refs.dialog.closeDialog()},getItemList:function(){var e=this;this.loading=!0;var t=this.pager,a=t.page,r=t.rows;this.$http.get(this.url,{params:p({page:a,rows:r},this.queryForm)}).then((function(t){t.data.success?(e.itemList=t.data.data,e.pager.count=t.data.count):e.$message.warning({message:t.data.msg,duration:3e3,showClose:!0})}),(function(e){var t=e.response;Object(n["a"])(t)})).finally((function(){e.loading=!1}))},onClickCheck:function(e){this.$emit("selected",e.psId),this.labelModel=e.psName,this.$emit("change",e.psName),this.closeDialog()}}},c=m,d=a("2877"),u=Object(d["a"])(c,r,i,!1,null,null,null);t["a"]=u.exports},af32:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("dialog-modal",{ref:"dialog",attrs:{type:"title",size:"mini",maxScrollbar:"",title:(e.itemModel.id?"编辑":"新增")+"许可证"},on:{close:e.closeDialog}},[a("el-form",{ref:"form",staticClass:"mar-t-xs pad-x-sm item-space el-box",attrs:{rules:e.rules,"label-width":"100px",model:e.itemModel}},[a("el-form-item",{attrs:{label:"企业名称：",prop:"psId","hint-down":""}},[a("select-table",{attrs:{label:e.psName,disable:e.isEdit},on:{change:e.getPsNameValue},model:{value:e.itemModel.psId,callback:function(t){e.$set(e.itemModel,"psId",t)},expression:"itemModel.psId"}})],1),a("el-form-item",{attrs:{label:"许可证编号：",prop:"permitCode"}},[a("el-input",{attrs:{clearable:""},model:{value:e.itemModel.permitCode,callback:function(t){e.$set(e.itemModel,"permitCode",t)},expression:"itemModel.permitCode"}})],1),a("el-form-item",{attrs:{label:"开始时间：",prop:"permitStartDate"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"yyyy-MM-dd 00:00:00",clearable:!1},model:{value:e.itemModel.permitStartDate,callback:function(t){e.$set(e.itemModel,"permitStartDate",t)},expression:"itemModel.permitStartDate"}})],1),a("el-form-item",{attrs:{label:"结束时间：",prop:"permitEndDate"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"yyyy-MM-dd 00:00:00",clearable:!1},model:{value:e.itemModel.permitEndDate,callback:function(t){e.$set(e.itemModel,"permitEndDate",t)},expression:"itemModel.permitEndDate"}})],1),a("el-form-item",{attrs:{label:"签发日期：",prop:"permitSignDate"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"yyyy-MM-dd 00:00:00",clearable:!1},model:{value:e.itemModel.permitSignDate,callback:function(t){e.$set(e.itemModel,"permitSignDate",t)},expression:"itemModel.permitSignDate"}})],1),a("el-form-item",{attrs:{label:"审批单位：",prop:"signDepartment"}},[a("el-input",{attrs:{clearable:""},model:{value:e.itemModel.signDepartment,callback:function(t){e.$set(e.itemModel,"signDepartment",t)},expression:"itemModel.signDepartment"}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",icon:"fas fa-save",loading:e.saveLoading},on:{click:function(t){return e.onSaveCheck(e.saveCallback)}}},[e._v("保 存\n    ")]),a("el-button",{attrs:{icon:"fas fa-times"},on:{click:function(t){return e.$refs.dialog.closeDialog()}}},[e._v("关 闭\n    ")])],1)],1)},i=[],l=(a("a481"),a("2ef0")),o=a.n(l),n=a("73cb"),s=a("9b4e"),p={mixins:[n["d"]],components:{SelectTable:s["a"]},data:function(){return{saveLoading:!1,url:"bas/pollutantDischargePermit",psName:"",itemModel:{psId:"",permitCode:"",permitStartDate:"".concat((new Date).getFullYear(),"-01-01 00:00:00"),permitEndDate:"".concat((new Date).getFullYear(),"-12-31 00:00:00"),permitSignDate:"".concat((new Date).getFullYear(),"-01-01 00:00:00"),permitStatus:1,signDepartment:""},rules:{psId:[{required:!0,message:"请选择企业名称",trigger:["blur","change"]}],permitCode:[{required:!0,message:"请输入许可证编码",trigger:["blur","change"]}],permitStartDate:[{required:!0,message:"请选择开始日期",trigger:["blur","change"]}],permitEndDate:[{required:!0,message:"请选择结束日期",trigger:["blur","change"]}],permitSignDate:[{required:!0,message:"请选择签发日期",trigger:["blur","change"]}],signDepartment:[{required:!0,message:"请输入审核部门",trigger:["blur","change"]}]}}},computed:{isEdit:function(){return this.itemModel.id}},methods:{openDialog:function(e){var t=this;this.$refs.dialog.openDialog();var a=e;this.psName=a?a.psName:"",e&&(a=o.a.cloneDeep(e),this.itemModel=this.setEmptyItem(a)),this.$nextTick((function(){t.$refs.form.clearValidate()}))},getPsNameValue:function(e){this.psName=e},onSaveCheck:function(e){var t=this;this.$refs.form.validate((function(a){if(a){var r=new Date(t.itemModel.permitStartDate.replace(/-/g,"/")).getTime(),i=new Date(t.itemModel.permitEndDate.replace(/-/g,"/")).getTime();r>i?t.$message({type:"warning",message:"开始时间大于结束时间",showClose:!0,duration:3e3}):t.onSaveItem(e)}}))},saveCallback:function(){this.$refs.dialog.closeDialog(),this.$emit("query")},closeDialog:function(){this.psName="",this.itemModel=this.getEmptyItem()},getEmptyItem:function(){return{psId:"",permitCode:"",permitStartDate:"".concat((new Date).getFullYear(),"-01-01 00:00:00"),permitEndDate:"".concat((new Date).getFullYear(),"-12-31 00:00:00"),permitSignDate:"".concat((new Date).getFullYear(),"-01-01 00:00:00"),permitStatus:1,signDepartment:""}},setEmptyItem:function(e){return{id:e.id,psId:e.psId||"",permitCode:e.permitCode||"",permitStartDate:e.permitStartDate||"",permitEndDate:e.permitEndDate||"",permitSignDate:e.permitSignDate||"",permitStatus:e.permitStatus||"",signDepartment:e.signDepartment||""}}}},m=p,c=a("2877"),d=Object(c["a"])(m,r,i,!1,null,null,null);t["default"]=d.exports}}]);