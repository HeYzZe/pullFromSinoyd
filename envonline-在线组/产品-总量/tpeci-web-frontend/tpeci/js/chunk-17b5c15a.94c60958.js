(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-17b5c15a","chunk-53e3791a"],{4812:function(e,t,i){},"514e":function(e,t,i){"use strict";var a=i("4812"),o=i.n(a);o.a},"5ecd":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-card",[i("template",{slot:"header"},[i("el-form",{attrs:{model:e.queryForm,inline:""}},[i("el-form-item",{attrs:{label:"企业名称："}},[i("el-input",{staticStyle:{width:"180px"},attrs:{clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onQueryList()}},model:{value:e.queryForm.psName,callback:function(t){e.$set(e.queryForm,"psName",t)},expression:"queryForm.psName"}})],1),i("el-form-item",{attrs:{label:"许可证编号："}},[i("el-input",{staticStyle:{width:"180px"},attrs:{clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onQueryList()}},model:{value:e.queryForm.permitCode,callback:function(t){e.$set(e.queryForm,"permitCode",t)},expression:"queryForm.permitCode"}})],1),i("el-form-item",{attrs:{label:"状态："}},[i("el-select",{staticStyle:{width:"90px"},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},[i("el-option",{attrs:{value:"",label:"全部"}}),e._l(e.$enum.get("LICENCE_STATUS"),(function(e,t){return i("el-option",{key:t,attrs:{value:e.value,label:e.label}})}))],2)],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"fas fa-search"},on:{click:e.onQueryList}},[e._v("查 询")])],1)],1)],1),e.isShow?i("div",{staticClass:"mar-l-sm mar-y-xs"},[i("el-button",{attrs:{type:"primary",icon:"fas fa-plus"},on:{click:e.onClickAdd}},[e._v("新 增")]),i("el-button",{attrs:{type:"danger",icon:"fas fa-trash-alt",disabled:!e.selectedIds.length},on:{click:function(t){return e.onDeleteItem()}}},[e._v("删 除\n    ")])],1):e._e(),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"","highlight-current-row":"",height:e.isShow?"calc(100% - 69px)":"calc(100% - 31px)",data:e.itemList},on:{"selection-change":e.onChangeSelected}},[e.isShow?i("el-table-column",{attrs:{align:"center",type:"selection",width:"37"}}):e._e(),i("el-table-column",{attrs:{align:"center",label:"No.",width:"50",type:"index",index:e.index}}),i("el-table-column",{attrs:{label:"操作",align:"center",width:e.isShow?165:116},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isShow?i("el-button",{attrs:{type:"primary",icon:"fas fa-pencil-alt"},on:{click:function(i){return e.onClickEdit(t.row)}}},[e._v("编辑")]):e._e(),i("el-button",{attrs:{type:"primary",icon:"fas fa-link"},on:{click:function(i){return e.onClickDoc(t.row)}}},[e._v("附件")]),i("el-button",{attrs:{type:"primary",icon:"fas fa-file-invoice"},on:{click:function(i){return e.onClickConfig(t.row)}}},[e._v("配置")])]}}])}),i("el-table-column",{attrs:{label:"企业名称",prop:"psName","min-width":"120","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{label:"许可证编号",prop:"permitCode","min-width":"120","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{label:"许可时间（有效期）","min-width":"307","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("span",[e._v(e._s(a.permitStartDate.split(" ")[0]+" ~ "+a.permitEndDate.split(" ")[0]))])]}}])}),i("el-table-column",{attrs:{label:"签发日期",prop:"permitSignDate","min-width":"152","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{label:"状态",prop:"status","min-width":"80","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{label:"审批单位",prop:"signDepartment","min-width":"120","show-overflow-tooltip":""}})],1),i("paging-query",{attrs:{pager:e.pager},on:{query:e.getItemList}}),i("upload-dialog",{ref:"upload",attrs:{isShow:e.isShow}}),i("dialog-form",{ref:"dialog",on:{query:e.getItemList}}),i("sewage-factor",{ref:"config"})],2)},o=[],r=(i("8e6e"),i("ac6a"),i("456d"),i("bd86")),n=i("2f62"),l=i("73cb"),s=i("c2cd"),c=i("af32"),d=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("dialog-modal",{ref:"dialog",attrs:{size:"middle",title:"排污因子配置","append-to-body":!0},on:{close:e.closeDialog}},[e.isShow?i("div",{staticClass:"mar-l-xs mar-b-xs"},[i("el-button",{attrs:{type:"primary",icon:"fas fa-plus"},on:{click:e.onClickAdd}},[e._v("新 增")])],1):e._e(),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",data:e.itemList,height:e.isShow?"calc(86vh - 114px)":"calc(86vh - 80px)","highlight-current-row":""}},[i("el-table-column",{attrs:{align:"center",label:"No.",width:"45",type:"index",index:e.index}}),i("el-table-column",{attrs:{prop:"factorName",label:"许可因子","min-width":"120",align:"center","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{prop:"permittedEmissions",label:"许可排放量","min-width":"120",align:"center","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{prop:"unit",label:"单位","min-width":"120",align:"center","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{prop:"remark",label:"备注","min-width":"160",align:"center","show-overflow-tooltip":""}})],1),i("paging-query",{attrs:{pager:e.pager},on:{query:e.getItemList}}),i("dialog-form",{ref:"factor",attrs:{permitId:e.queryForm.permitId},on:{query:e.getItemList}})],1)},u=[],m=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("dialog-modal",{ref:"dialog",attrs:{type:"title",size:"mini","append-to-body":"",maxScrollbar:"",title:(e.isEdit?"编辑":"新增")+"排污许可因子"},on:{close:e.closeDialog}},[i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",staticClass:"mar-t-xs pad-x-sm item-space el-box",attrs:{rules:e.formRules,"label-position":"right","label-width":"100px",model:e.itemModel}},[i("el-form-item",{attrs:{label:"因子名称：",prop:"factorCode","hint-down":""}},[i("el-select",{attrs:{filterable:""},on:{change:e.getFactorData},model:{value:e.itemModel.factorCode,callback:function(t){e.$set(e.itemModel,"factorCode",t)},expression:"itemModel.factorCode"}},e._l(e.select.factorList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.factorName,value:e.factorCode}})})),1)],1),i("el-form-item",{attrs:{label:"单位：",prop:"unit"}},[i("el-input",{attrs:{disabled:""},model:{value:e.itemModel.unit,callback:function(t){e.$set(e.itemModel,"unit",t)},expression:"itemModel.unit"}})],1),i("el-form-item",{attrs:{label:"许可排放量：",prop:"permittedEmissions"}},[i("el-input",{attrs:{clearable:""},model:{value:e.itemModel.permittedEmissions,callback:function(t){e.$set(e.itemModel,"permittedEmissions",t)},expression:"itemModel.permittedEmissions"}})],1),i("el-form-item",{attrs:{label:"备注：",prop:"remark"}},[i("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.itemModel.remark,callback:function(t){e.$set(e.itemModel,"remark",t)},expression:"itemModel.remark"}})],1)],1),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary",icon:"fas fa-save",loading:e.saveLoading},on:{click:function(t){return e.onSaveCheck(e.saveCallback)}}},[e._v("保 存\n    ")]),i("el-button",{attrs:{icon:"fas fa-times"},on:{click:function(t){return e.$refs.dialog.closeDialog()}}},[e._v("关 闭")])],1)],1)},p=[],f=i("0069"),g={mixins:[l["d"]],props:{permitId:{type:String,required:!0}},data:function(){return{url:"bas/pollutantDischargePermitFactors",loading:!1,itemModel:{permitId:"",factorId:"",factorCode:"",factorName:"",permittedEmissions:"",remark:"",unit:""},select:{factorList:[]},formRules:{permittedEmissions:[{required:!0,message:"请输入许可排放量",trigger:["blur","change"]},{pattern:/(^[0-9][0-9]*(.[0-9]+)?)$/,message:"请输入数字,且不能为负数"}],factorCode:[{required:!0,message:"请选择因子",trigger:["blur","change"]}]}}},computed:{isEdit:function(){return this.itemModel.id}},methods:{openDialog:function(){var e=this;this.getFactorList(),this.$set(this.itemModel,"permitId",this.permitId),this.$refs.dialog.openDialog(),this.$nextTick((function(){e.$refs.form.clearValidate()}))},getFactorList:function(){var e=this;this.select.factorList=[],this.loading=!0,this.$http.get("cfg/factors",{params:{page:1,rows:1e5,category:1,factorName:"",factorCode:"",oldFactorCode:""}}).then((function(t){200===t.status&&t.data.success?e.select.factorList=t.data.data||[]:e.$message.warning({message:t.data.msg,duration:3e3,showClose:!0})}),(function(e){var t=e.response;Object(f["a"])(t)})).finally((function(){e.loading=!1}))},getFactorData:function(e){var t=this.select.factorList.filter((function(t){return t.factorCode===e}))[0]||{};this.$set(this.itemModel,"factorId",t.id||""),this.$set(this.itemModel,"factorName",t.factorName||""),this.$set(this.itemModel,"unit",t.unitCou||"")},saveCallback:function(){this.$refs.dialog.closeDialog(),this.$emit("query")},closeDialog:function(){this.psName="",this.select.factorList=[],this.itemModel=this.getEmptyItem()},getEmptyItem:function(){return{permitId:"",factorId:"",factorCode:"",factorName:"",permittedEmissions:"",remark:"",unit:""}}}},h=g,b=i("2877"),y=Object(b["a"])(h,m,p,!1,null,null,null),v=y.exports;function w(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function D(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?w(i,!0).forEach((function(t){Object(r["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):w(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var k={mixins:[l["c"],l["b"]],components:{DialogForm:v},data:function(){return{url:"bas/pollutantDischargePermitFactors",isAuto:!1,isShow:!0,queryForm:{permitId:"",permitCode:"",sort:"factorName"},itemList:[]}},computed:D({},Object(n["c"])("auth",["userType","orgGuid"])),created:function(){"ent"===this.userType&&(this.isShow=!1,this.$set(this.queryForm,"psId",this.orgGuid))},methods:{openDialog:function(e){this.queryForm.permitId=e.id||"",this.getItemList(),this.$refs.dialog.openDialog()},onClickAdd:function(){this.$refs.factor.openDialog()},getItemList:function(){var e=this;this.loading=!0;var t=this.pager,i=t.page,a=t.rows;this.$http.get(this.url,{params:D({page:i,rows:a},this.queryForm)}).then((function(t){200===t.status&&t.data.success?(e.itemList=t.data.data,e.pager.count=t.data.count):e.$message.warning({message:t.data.msg,duration:3e3,showClose:!0}),e.loading=!1}))},closeDialog:function(){this.itemList=[],this.selectedIds=[],this.$refs.dialog.closeDialog()}}},S=k,C=Object(b["a"])(S,d,u,!1,null,"49253e17",null),x=C.exports;function $(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function O(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?$(i,!0).forEach((function(t){Object(r["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):$(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var I={name:"SewageLicense",mixins:[l["c"],l["b"]],components:{UploadDialog:s["a"],DialogForm:c["default"],SewageFactor:x},data:function(){return{url:"bas/pollutantDischargePermit",isAuto:!1,isShow:!0,loading:!1,queryForm:{psId:"",psName:"",permitCode:"",status:"",sort:"psName+,permitCode+"},itemList:[]}},computed:O({},Object(n["c"])("auth",["userType","orgGuid"])),created:function(){"ent"===this.userType&&(this.isShow=!1,this.$set(this.queryForm,"psId",this.orgGuid)),this.onQueryList()},methods:{onClickAdd:function(){this.$refs.dialog.openDialog()},onClickEdit:function(e){this.$refs.dialog.openDialog(e)},onClickDoc:function(e){this.$refs.upload.openDialog(e)},onClickConfig:function(e){this.$refs.config.openDialog(e)}}},M=I,q=Object(b["a"])(M,a,o,!1,null,"3c118637",null);t["default"]=q.exports},"9b4e":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-tooltip",{attrs:{effect:"dark",placement:"top-start",disabled:e.labelModel.length<9,content:e.labelModel}},[i("el-input",{staticClass:"z-pointer",attrs:{readonly:"",size:e.size},model:{value:e.labelModel,callback:function(t){e.labelModel=t},expression:"labelModel"}},[i("el-button",{attrs:{slot:"append",size:e.size},on:{click:function(t){return e.openDialog()}},slot:"append"},[i("i",{staticClass:"fas fa-th-list"})])],1)],1),i("dialog-modal",{ref:"dialog",attrs:{title:e.title,"append-to-body":"",scrollbar:""},on:{close:e.closeDialog}},[i("el-form",{attrs:{inline:"",model:e.queryForm}},[i("el-form-item",{attrs:{label:"企业名称："}},[i("el-input",{attrs:{clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getItemList()}},model:{value:e.queryForm.psName,callback:function(t){e.$set(e.queryForm,"psName",t)},expression:"queryForm.psName"}})],1),i("el-form-item",{attrs:{label:"行政区域："}},[i("select-tree",{staticStyle:{width:"130px"},attrs:{lazy:"",joint:"",rootKey:"0",url:"sys/area",props:{label:"areaName"}},model:{value:e.queryForm.regionCodeId,callback:function(t){e.$set(e.queryForm,"regionCodeId",t)},expression:"queryForm.regionCodeId"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"fas fa-search"},on:{click:e.getItemList}},[e._v("查 询")])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",height:"calc(70vh - 115px)","highlight-current-row":"",data:e.itemList}},[i("el-table-column",{attrs:{align:"center",label:"No.",width:"50",type:"index",index:e.index}}),i("el-table-column",{attrs:{align:"center",label:"操作",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:function(i){return e.onClickCheck(t.row)}}},[e._v("确认")])]}}])}),i("el-table-column",{attrs:{property:"psName",label:"企业名称","min-width":"180","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{property:"psShortName",label:"企业简称","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{property:"regionName",label:"行政区域","show-overflow-tooltip":""}})],1),i("paging-query",{attrs:{pager:e.pager},on:{query:e.getItemList}})],1)],1)},o=[],r=(i("8e6e"),i("ac6a"),i("456d"),i("bd86")),n=i("2f62"),l=i("0069");function s(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function c(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?s(i,!0).forEach((function(t){Object(r["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var d={name:"SelectTable",model:{prop:"value",event:"selected"},props:{value:String,label:String,url:{type:String,required:!1,default:"bas/psBaseInfo"},size:{type:String,required:!1,default:"mini"},title:{type:String,required:!1,default:"选择企业"}},data:function(){return{loading:!1,valueModel:"",labelModel:"",queryForm:{psName:"",psType:1,industryTypeCodeId:"",regionCodeId:"",attentionDegree:-1,psBaseInfoType:-1,sort:"psName"},itemList:[],pager:{page:1,rows:15,count:0}}},watch:{label:{handler:function(e){this.labelModel=this.value?e:""},deep:!0,immediate:!0}},computed:c({},Object(n["c"])("auth",["userType","orgGuid"])),created:function(){"ent"===this.userType&&this.$set(this.queryForm,"psId",this.orgGuid)},methods:{index:function(e){return(this.pager.page-1)*this.pager.rows+e+1},openDialog:function(){this.getItemList(),this.$refs.dialog.openDialog()},closeDialog:function(){this.$refs.dialog.closeDialog()},getItemList:function(){var e=this;this.loading=!0;var t=this.pager,i=t.page,a=t.rows;this.$http.get(this.url,{params:c({page:i,rows:a},this.queryForm)}).then((function(t){t.data.success?(e.itemList=t.data.data,e.pager.count=t.data.count):e.$message.warning({message:t.data.msg,duration:3e3,showClose:!0})}),(function(e){var t=e.response;Object(l["a"])(t)})).finally((function(){e.loading=!1}))},onClickCheck:function(e){this.$emit("selected",e.psId),this.labelModel=e.psName,this.$emit("change",e.psName),this.closeDialog()}}},u=d,m=i("2877"),p=Object(m["a"])(u,a,o,!1,null,null,null);t["a"]=p.exports},af32:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("dialog-modal",{ref:"dialog",attrs:{type:"title",size:"mini",maxScrollbar:"",title:(e.itemModel.id?"编辑":"新增")+"许可证"},on:{close:e.closeDialog}},[i("el-form",{ref:"form",staticClass:"mar-t-xs pad-x-sm item-space el-box",attrs:{rules:e.rules,"label-width":"100px",model:e.itemModel}},[i("el-form-item",{attrs:{label:"企业名称：",prop:"psId","hint-down":""}},[i("select-table",{attrs:{label:e.psName,disable:e.isEdit},on:{change:e.getPsNameValue},model:{value:e.itemModel.psId,callback:function(t){e.$set(e.itemModel,"psId",t)},expression:"itemModel.psId"}})],1),i("el-form-item",{attrs:{label:"许可证编号：",prop:"permitCode"}},[i("el-input",{attrs:{clearable:""},model:{value:e.itemModel.permitCode,callback:function(t){e.$set(e.itemModel,"permitCode",t)},expression:"itemModel.permitCode"}})],1),i("el-form-item",{attrs:{label:"开始时间：",prop:"permitStartDate"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"yyyy-MM-dd 00:00:00",clearable:!1},model:{value:e.itemModel.permitStartDate,callback:function(t){e.$set(e.itemModel,"permitStartDate",t)},expression:"itemModel.permitStartDate"}})],1),i("el-form-item",{attrs:{label:"结束时间：",prop:"permitEndDate"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"yyyy-MM-dd 00:00:00",clearable:!1},model:{value:e.itemModel.permitEndDate,callback:function(t){e.$set(e.itemModel,"permitEndDate",t)},expression:"itemModel.permitEndDate"}})],1),i("el-form-item",{attrs:{label:"签发日期：",prop:"permitSignDate"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"yyyy-MM-dd 00:00:00",clearable:!1},model:{value:e.itemModel.permitSignDate,callback:function(t){e.$set(e.itemModel,"permitSignDate",t)},expression:"itemModel.permitSignDate"}})],1),i("el-form-item",{attrs:{label:"审批单位：",prop:"signDepartment"}},[i("el-input",{attrs:{clearable:""},model:{value:e.itemModel.signDepartment,callback:function(t){e.$set(e.itemModel,"signDepartment",t)},expression:"itemModel.signDepartment"}})],1)],1),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary",icon:"fas fa-save",loading:e.saveLoading},on:{click:function(t){return e.onSaveCheck(e.saveCallback)}}},[e._v("保 存\n    ")]),i("el-button",{attrs:{icon:"fas fa-times"},on:{click:function(t){return e.$refs.dialog.closeDialog()}}},[e._v("关 闭\n    ")])],1)],1)},o=[],r=(i("a481"),i("2ef0")),n=i.n(r),l=i("73cb"),s=i("9b4e"),c={mixins:[l["d"]],components:{SelectTable:s["a"]},data:function(){return{saveLoading:!1,url:"bas/pollutantDischargePermit",psName:"",itemModel:{psId:"",permitCode:"",permitStartDate:"".concat((new Date).getFullYear(),"-01-01 00:00:00"),permitEndDate:"".concat((new Date).getFullYear(),"-12-31 00:00:00"),permitSignDate:"".concat((new Date).getFullYear(),"-01-01 00:00:00"),permitStatus:1,signDepartment:""},rules:{psId:[{required:!0,message:"请选择企业名称",trigger:["blur","change"]}],permitCode:[{required:!0,message:"请输入许可证编码",trigger:["blur","change"]}],permitStartDate:[{required:!0,message:"请选择开始日期",trigger:["blur","change"]}],permitEndDate:[{required:!0,message:"请选择结束日期",trigger:["blur","change"]}],permitSignDate:[{required:!0,message:"请选择签发日期",trigger:["blur","change"]}],signDepartment:[{required:!0,message:"请输入审核部门",trigger:["blur","change"]}]}}},computed:{isEdit:function(){return this.itemModel.id}},methods:{openDialog:function(e){var t=this;this.$refs.dialog.openDialog();var i=e;this.psName=i?i.psName:"",e&&(i=n.a.cloneDeep(e),this.itemModel=this.setEmptyItem(i)),this.$nextTick((function(){t.$refs.form.clearValidate()}))},getPsNameValue:function(e){this.psName=e},onSaveCheck:function(e){var t=this;this.$refs.form.validate((function(i){if(i){var a=new Date(t.itemModel.permitStartDate.replace(/-/g,"/")).getTime(),o=new Date(t.itemModel.permitEndDate.replace(/-/g,"/")).getTime();a>o?t.$message({type:"warning",message:"开始时间大于结束时间",showClose:!0,duration:3e3}):t.onSaveItem(e)}}))},saveCallback:function(){this.$refs.dialog.closeDialog(),this.$emit("query")},closeDialog:function(){this.psName="",this.itemModel=this.getEmptyItem()},getEmptyItem:function(){return{psId:"",permitCode:"",permitStartDate:"".concat((new Date).getFullYear(),"-01-01 00:00:00"),permitEndDate:"".concat((new Date).getFullYear(),"-12-31 00:00:00"),permitSignDate:"".concat((new Date).getFullYear(),"-01-01 00:00:00"),permitStatus:1,signDepartment:""}},setEmptyItem:function(e){return{id:e.id,psId:e.psId||"",permitCode:e.permitCode||"",permitStartDate:e.permitStartDate||"",permitEndDate:e.permitEndDate||"",permitSignDate:e.permitSignDate||"",permitStatus:e.permitStatus||"",signDepartment:e.signDepartment||""}}}},d=c,u=i("2877"),m=Object(u["a"])(d,a,o,!1,null,null,null);t["default"]=m.exports},c2cd:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("dialog-modal",{ref:"dialog",attrs:{size:"small",scrollbar:"",view:!0,title:"上传附件"},on:{close:e.closeDialog}},[e.isShow?i("div",{staticClass:"mar-b-xs"},[i("el-button",{attrs:{type:"primary",icon:"fas fa-cloud-upload-alt"},on:{click:e.onClickUpload}},[e._v("上 传")]),i("el-button",{attrs:{type:"danger",icon:"fas fa-trash-alt",disabled:!e.selectedIds.length},on:{click:e.onClickDele}},[e._v("删 除\n    ")])],1):e._e(),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{height:e.isShow?"calc(100% - 64px)":"calc(100% - 31px)",data:e.itemList,border:"","highlight-current-row":""},on:{"selection-change":e.onSaveSelected}},[e.isShow?i("el-table-column",{attrs:{align:"center",type:"selection",width:"37"}}):e._e(),i("el-table-column",{attrs:{align:"center",label:"No.",type:"index",width:"50",index:e.index}}),i("el-table-column",{attrs:{align:"center",label:"操作",width:"67"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"primary",icon:"fas fa-pencil-alt"},on:{click:function(i){return e.onClickDown(t.row)}}},[e._v("下载")])]}}])}),i("el-table-column",{attrs:{prop:"docName","min-width":"160","show-overflow-tooltip":"",label:"名称"}}),i("el-table-column",{attrs:{prop:"uploadTime","min-width":"160","show-overflow-tooltip":"",label:"创建时间"}}),i("el-table-column",{attrs:{prop:"authorName","min-width":"120","show-overflow-tooltip":"",label:"作者"}})],1),i("paging-query",{attrs:{pager:e.pager},on:{query:e.getItemList}}),i("upload",{ref:"upload",attrs:{id:e.queryForm.objectId},on:{query:e.getItemList}})],1)},o=[],r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("dialog-modal",{ref:"dialog",attrs:{size:"mini",title:"上传附件",appendToBody:!0},on:{close:e.onCloseDialog}},[i("el-upload",{ref:"addFile",staticClass:"mar-t-xs mar-b-xs",attrs:{multiple:"",action:"","file-list":e.tempList,"auto-upload":!1,"on-change":e.onFileChange,"on-remove":e.handleRemove}},[i("el-button",{attrs:{size:"small"}},[e._v("选择文件")]),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传不超过 10MB 大小的文件, 且每次上传不超过 100MB 大小 ")])],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{type:"primary",icon:"fas fa-cloud-upload-alt"},on:{click:e.onClickUpload}},[e._v("上 传\n    ")]),i("el-button",{attrs:{icon:"fas fa-times"},on:{click:function(t){return e.$refs.dialog.closeDialog()}}},[e._v("关 闭")])],1)],1)},n=[],l=(i("5df3"),i("7f7f"),i("ac6a"),{props:{id:{type:String,required:!0}},data:function(){return{loading:!1,tempList:[]}},computed:{filesSize:function(){return this.tempList.map((function(e){return e.size/1024/1024}))},isFileSize:function(){return this.filesSize.every((function(e){return e<10}))},isFilesSize:function(){return this.filesSize.reduce((function(e,t){return e+t}),0)<100}},watch:{},methods:{openDialog:function(){this.$refs.dialog.openDialog()},handleRemove:function(e,t){this.tempList=t},onFileChange:function(e,t){this.tempList=t},beforeUpload:function(){var e=this,t=[];this.tempList.forEach((function(i){var a={param:{},config:{}};a.param=new FormData,a.param.append("file",i.raw,i.name),a.config={params:{objectId:e.id}},t.push(e.onCreateItem(a,i.name))})),this.loading=!0,Promise.all(t).then((function(){e.$message.success("上传成功"),e.$emit("query"),e.$refs.dialog.closeDialog()})).catch((function(t){e.$message.wraning({message:"文件".concat(t.join(","),"上传失败"),showClose:!0,duration:3e3})})).finally((function(){e.loading=!1}))},onCreateItem:function(e,t){var i=this;return new Promise((function(a,o){i.$http.post("res/document/upload",e.param,e.config).then((function(e){e.data.success?a():o(t)}),(function(){o(t)}))}))},onClickUpload:function(){this.tempList.length?this.isFileSize?this.isFilesSize?this.beforeUpload():this.$message.info("上传文件总大小不能超过100MB"):this.$message.info("单个文件大小不能超过10MB"):this.$message.info("请选择需要上传的附件")},onCloseDialog:function(){this.tempList=[]}}}),s=l,c=i("2877"),d=Object(c["a"])(s,r,n,!1,null,"a90fa5d8",null),u=d.exports,m=i("73cb"),p={mixins:[m["c"]],components:{Upload:u},props:{isShow:{type:Boolean}},data:function(){return{url:"res/document",isAuto:!1,loading:!1,itemList:[],queryForm:{objectId:"",sort:"uploadTime-"}}},computed:{},created:function(){},methods:{openDialog:function(e){this.queryForm.objectId=e.id||"",this.getItemList(),this.$refs.dialog.openDialog()},onSaveSelected:function(e){this.selectedIds=e.map((function(e){return e.id}))},onClickUpload:function(){this.$refs.upload.openDialog()},closeDialog:function(){this.queryList={objectId:"",sort:"uploadTime-"},this.itemList=[],this.loading=!1},onClickDele:function(){var e=this;0!==this.selectedIds.length?this.$confirm("是否删除选中的数据？","请确定",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return e.$http.delete("res/document",{data:e.selectedIds})})).then((function(t){t.data.success&&e.getItemList(),e.$message({showClose:!0,message:t.data.success?"删除成功":t.data.msg,type:t.data.success?"success":"error",duration:3e3})})):this.$message("请选择要删除的数据")},onClickDown:function(e){var t=this;this.$http.get("res/document/download?id=".concat(e.id),{responseType:"blob"}).then((function(i){var a="application/json;charset=UTF-8"===i.headers["content-type"];if(a){var o=new FileReader;o.onload=function(e){return t.$message.warning(JSON.parse(e.target.result).msg)},o.readAsText(i.data)}else{var r=e.docName,n=new Blob([i.data],{type:"application/x-xls"});if(window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(n,r);else{var l=document.createElement("a");l.href=window.URL.createObjectURL(n),l.download=r,l.click(),window.URL.revokeObjectURL(l.href)}}}),(function(e){t.$hp.resp(e)})).finally((function(){}))}}},f=p,g=(i("514e"),Object(c["a"])(f,a,o,!1,null,"df2918d4",null));t["a"]=g.exports}}]);