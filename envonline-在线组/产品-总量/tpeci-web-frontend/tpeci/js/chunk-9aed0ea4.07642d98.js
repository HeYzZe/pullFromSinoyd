(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9aed0ea4"],{"1a66":function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("dialog-modal",{ref:"dialog",attrs:{type:"title",width:"35%",maxScrollbar:"",title:(e.isEdit?"编辑":"新增")+"基本信息"}},[o("div",{staticClass:"title-info mar-b-xs"},[e._v("基本信息")]),o("el-form",{ref:"form",staticClass:"item-space pad-a-xs",attrs:{rules:e.formRules,model:e.itemModel,"label-width":"90px"}},[o("el-row",[o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"卡类型：","hint-down":"",prop:"cardType"}},[o("el-select",{model:{value:e.itemModel.cardType,callback:function(t){e.$set(e.itemModel,"cardType",t)},expression:"itemModel.cardType"}},e._l(e.$enum.get("IC_CARD_TYPE"),(function(e,t){return o("el-option",{key:t,attrs:{value:e.value,label:e.label}})})),1)],1),o("el-form-item",{attrs:{label:"卡号：",prop:"cardCode"}},[o("el-input",{attrs:{disabled:e.isEdit},model:{value:e.itemModel.cardCode,callback:function(t){e.$set(e.itemModel,"cardCode",t)},expression:"itemModel.cardCode"}},[o("el-button",{attrs:{slot:"append",icon:"fas fa-address-card"},on:{click:e.onReadCard},slot:"append"})],1)],1),o("el-form-item",{attrs:{label:"单位名称：",prop:"affiliationUnit"}},[o("el-input",{attrs:{clearable:""},model:{value:e.itemModel.affiliationUnit,callback:function(t){e.$set(e.itemModel,"affiliationUnit",t)},expression:"itemModel.affiliationUnit"}})],1)],1),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"部门名称："}},[o("el-input",{attrs:{clearable:""},model:{value:e.itemModel.department,callback:function(t){e.$set(e.itemModel,"department",t)},expression:"itemModel.department"}})],1),o("el-form-item",{attrs:{label:"持卡人：",prop:"optionName"}},[o("el-input",{attrs:{clearable:""},model:{value:e.itemModel.optionName,callback:function(t){e.$set(e.itemModel,"optionName",t)},expression:"itemModel.optionName"}})],1),o("el-form-item",{attrs:{label:"联系电话：",prop:"telephone"}},[o("el-input",{attrs:{clearable:""},model:{value:e.itemModel.telephone,callback:function(t){e.$set(e.itemModel,"telephone",t)},expression:"itemModel.telephone"}})],1)],1)],1)],1),o("div",{staticClass:"title-info mar-b-xs"},[e._v("关联站点")]),o("div",{staticClass:"pad-b-sm"},[o("div",{staticClass:"mar-l-sm mar-y-xs"},[o("el-form",{attrs:{inline:"",model:e.queryForm}},[o("el-form-item",{attrs:{label:"企业名称："}},[o("el-input",{attrs:{clearable:"",placeholder:"请输入企业名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getPortList(t)}},model:{value:e.queryForm.psName,callback:function(t){e.$set(e.queryForm,"psName",t)},expression:"queryForm.psName"}})],1),o("el-form-item",{attrs:{label:"所属区域："}},[o("area-select",{attrs:{placeholder:"请选择"},on:{setLabel:e.getPortList},model:{value:e.queryForm.regionCodeId,callback:function(t){e.$set(e.queryForm,"regionCodeId",t)},expression:"queryForm.regionCodeId"}})],1)],1)],1),e.isShow?o("el-transfer",{directives:[{name:"loading",rawName:"v-loading",value:e.transferLoading,expression:"transferLoading"}],ref:"transfer",staticStyle:{height:"380px"},attrs:{filterable:"",titles:["待选","已选"],data:e.select.portList,props:{key:"id",label:"portName"}},model:{value:e.portIds,callback:function(t){e.portIds=t},expression:"portIds"}}):e._e()],1),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary",icon:"fas fa-save",loading:e.saveLoading},on:{click:function(t){return e.onSaveCheck(e.saveCallback)}}},[e._v("保 存\n    ")]),o("el-button",{attrs:{icon:"fas fa-times"},on:{click:e.closeDialog}},[e._v("关 闭")])],1)],1)},r=[],i=(o("8e6e"),o("ac6a"),o("456d"),o("6762"),o("2fdb"),o("bd86")),s=o("2f62"),n=o("73cb"),l=o("0069"),d=o("c90e");function c(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function p(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?c(o,!0).forEach((function(t){Object(i["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):c(o).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var u={mixins:[n["d"]],components:{AreaSelect:d["a"]},data:function(){return{isShow:!1,url:"tpeci/iCManageCard",transferLoading:!1,queryForm:{cardId:"",psName:"",regionCodeId:""},itemModel:{cardCode:"",optionName:"",telephone:"",department:"",affiliationUnit:"",cardType:1,optionId:"",cardStatus:1},select:{portList:[]},portIds:[],formRules:{cardCode:[{required:!0,message:"请输入卡号",trigger:["change","blur"]}],cardType:[{required:!0,message:"请选择卡类型",trigger:["change","blur"]}],affiliationUnit:[{required:!0,message:"请输入单位名称",trigger:["change","blur"]}],optionName:[{required:!0,message:"请输入持卡人",trigger:["change","blur"]}],telephone:[{required:!0,message:"请输入联系电话",trigger:["change","blur"]},{max:15,message:"请输入合适联系电话",trigger:["change","blur"]}]},socket:{},dtoSend:{Order:"",Param:""}}},created:function(){this.init()},destroyed:function(){this.socket.close()},computed:p({},Object(s["c"])("auth",["userName"]),{isEdit:function(){return this.itemModel.id&&!0}}),methods:{init:function(){this.socket=new WebSocket("ws://127.0.0.1:10086/websocket"),this.socket.onopen=this.open,this.socket.onerror=this.error,this.socket.onmessage=this.getMessage,this.socket.onclose=this.close},open:function(){console.log("socket连接成功")},error:function(){console.log("连接错误")},getMessage:function(e){var t=JSON.parse(e.data);console.log(t),"selectCard"===t.Order&&(t.Success?this.itemModel.cardCode=t.Data.cardNum:this.$message.error(t.Message)),"initCard"===t.Order&&(t.Success?this.$message.success(t.Message):this.$message.error(t.Message))},onReadCard:function(){this.socket.readyState===WebSocket.OPEN&&(this.dtoSend.Order="selectCard",this.socket.send(JSON.stringify(this.dtoSend)))},openDialog:function(e){var t=this;this.isShow=!0,this.$refs.dialog.openDialog(),this.itemModel=this.setEmptyItem(e),this.queryForm={psName:"",regionCodeId:""},this.portIds=[],e&&e.id&&this.getItemList(),this.getPortList(),this.$nextTick((function(){t.$refs.form.clearValidate()}))},closeDialog:function(){this.isShow=!1,this.$refs.dialog.closeDialog()},saveCallback:function(e){var t=this;this.$refs.dialog.closeDialog(),this.$emit("query"),this.queryForm.cardId=this.itemModel.id;var o=this.select.portList.filter((function(e){return t.portIds.includes(e.id)})).map((function(t){return{portId:t.id,cardId:e.id,regionCodeId:t.id,regionName:t.regionName,psId:t.psId,psName:t.psName,portName:t.portName}}));if(this.setPortList(o),this.socket.readyState===WebSocket.OPEN){this.dtoSend.Order="initCard";var a={ICId:e.id,CardType:"0".concat(e.cardType)};this.dtoSend.Param=JSON.stringify(a),this.socket.send(JSON.stringify(this.dtoSend))}},getItemList:function(){var e=this;this.$http.get("tpeci/iCManageCard2Port",{params:{page:1,rows:1e6,cardId:this.queryForm.cardId}}).then((function(t){200===t.status&&t.data.success?e.portIds=t.data.data.map((function(e){return e.portId})):e.$message.warning({message:t.data.msg,duration:3e3,showClose:!0})}),(function(e){var t=e.response;Object(l["a"])(t)}))},getPortList:function(){var e=this;this.$http.get("bas/portInfo/queryAuthority",{params:{childPortType:5,page:1,rows:1e5,portType:1,psName:this.queryForm.psName,regionCodeId:this.queryForm.regionCodeId,sort:"psName+,portName"}}).then((function(t){200===t.status&&t.data.success&&(e.select.portList=t.data.data,e.queryForm.cardId&&e.getItemList())}),(function(e){var t=e.response;Object(l["a"])(t)})).finally((function(){e.transferLoading=!1}))},setPortList:function(e){var t=this;this.saveLoading=!0,this.$http.post("tpeci/iCManageCard2Port/".concat(this.queryForm.cardId),e).then((function(e){200===e.status&&e.data.success||t.$message.warning({message:e.data.msg||e.data.message,duration:3e3,showClose:!0})}),(function(e){var t=e.response;Object(l["a"])(t)})).finally((function(){t.saveLoading=!1}))},setEmptyItem:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};return e.id&&(t={id:e.id}),p({},t,{department:e.department||"",affiliationUnit:e.affiliationUnit||"",cardType:e.cardType||1,cardCode:e.cardCode||"",optionName:e.optionName||"",telephone:e.telephone||"",optionId:e.optionId||"",cardStatus:e.cardStatus||1})}}},m=u,h=o("2877"),f=Object(h["a"])(m,a,r,!1,null,"efa5eaca",null);t["default"]=f.exports},c90e:function(e,t,o){"use strict";var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-popover",{ref:"popover",attrs:{placement:"bottom-start",trigger:"click"},on:{show:e.onShowMenu,hide:e.onHideMenu}},[o("el-tree",{ref:"tree",staticClass:"mod-select-tree",style:"min-width: "+e.treeWidth+";max-height:300px;overflow:auto",attrs:{"highlight-current":"",lazy:"",load:e.onLoadNodes,data:e.data,props:e.props,"expand-on-click-node":!1,"filter-node-method":e.filterNode,"default-expand-all":!1},on:{"node-click":e.onClickNode,"node-expand":e.onExtendNode}}),o("template",{slot:"reference"},[o("el-tooltip",{attrs:{effect:"dark",placement:"top-start",disabled:e.labelModel.length<9,content:e.labelModel}},[o("el-input",{ref:"input",class:{rotate:e.showStatus,"z-pointer":1},style:"width: "+e.width+"px",attrs:{clearable:"","suffix-icon":"el-icon-arrow-down",placeholder:e.placeholder||""},on:{"!clear":function(t){return e.onShrinkNode(t)}},model:{value:e.labelModel,callback:function(t){e.labelModel=t},expression:"labelModel"}})],1)],1)],2)},r=[],i=(o("ac6a"),o("c5f6"),{name:"SelectTreeLazy",model:{prop:"value",event:"selected"},props:{value:[Number,String],label:String,width:String,placeholder:String,props:{type:Object,required:!1,default:function(){return{parent:"parentId",value:"rowGuid",label:"areaName",children:"children"}}}},watch:{label:function(e){this.labelModel=e},labelModel:function(e){e||(this.valueModel="",this.$emit("setLabel",e)),this.$refs.tree.filter(e)}},data:function(){return{showStatus:!1,treeWidth:"auto",labelModel:"",valueModel:"",data:[]}},created:function(){var e=this;this.labelModel=this.label||"",this.valueModel=this.value||"",this.$nextTick((function(){e.treeWidth="".concat((e.width||e.$refs.input.$refs.input.clientWidth)-24,"px")}))},methods:{onClickNode:function(e){var t=this;this.labelModel=e[this.props.label],this.valueModel=e[this.props.value],this.$refs.popover.showPopper=!1,this.$nextTick((function(){t.$emit("setLabel",t.labelModel)}))},onShowMenu:function(){this.showStatus=!0,this.$refs.tree.filter(!1)},onHideMenu:function(){this.showStatus=!1,this.$emit("selected",this.valueModel)},onExtendNode:function(e,t,o){this.$set(o,"expanded",!o.expanded)},onShrinkNode:function(){var e=this;this.$emit("selected","");var t=this.$refs.tree;this.showStatus=!1,this.$nextTick((function(){e.$refs.popover.showPopper=!1})),t.$children.forEach((function(t){e.$set(t,"expanded",!1)}))},filterNode:function(e,t){return!e||-1!==t[this.props.label].indexOf(e)},onLoadNodes:function(e,t){this.getNodeList(e.data[this.props.value]).then((function(e){return t(e)}))},getNodeList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0";return new Promise((function(o){e.$http.get("sys/area/".concat(t)).then((function(e){o(e.data||[])}),(function(t){e.$hp.resp(t)}))}))}}}),s=i,n=o("2877"),l=Object(n["a"])(s,a,r,!1,null,null,null);t["a"]=l.exports}}]);